\doxysection{align.\+py}
\hypertarget{pandas_2core_2computation_2align_8py_source}{}\label{pandas_2core_2computation_2align_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/pandas/core/computation/align.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/pandas/core/computation/align.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00001}\mbox{\hyperlink{namespacepandas_1_1core_1_1computation_1_1align}{00001}}\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00002}00002\ \textcolor{stringliteral}{Core\ eval\ alignment\ algorithms.}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00003}00003\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00004}00004\ \textcolor{keyword}{from}\ \_\_future\_\_\ \textcolor{keyword}{import}\ annotations}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00006}00006\ \textcolor{keyword}{from}\ functools\ \textcolor{keyword}{import}\ (}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00007}00007\ \ \ \ \ partial,}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00008}00008\ \ \ \ \ wraps,}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00009}00009\ )}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00010}00010\ \textcolor{keyword}{from}\ typing\ \textcolor{keyword}{import}\ (}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00011}00011\ \ \ \ \ TYPE\_CHECKING,}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00012}00012\ \ \ \ \ Callable,}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00013}00013\ )}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00014}00014\ \textcolor{keyword}{import}\ warnings}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00016}00016\ \textcolor{keyword}{import}\ numpy\ \textcolor{keyword}{as}\ np}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00018}00018\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacepandas_1_1errors}{pandas.errors}}\ \textcolor{keyword}{import}\ PerformanceWarning}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00019}00019\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacepandas_1_1util_1_1__exceptions}{pandas.util.\_exceptions}}\ \textcolor{keyword}{import}\ find\_stack\_level}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00020}00020\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00021}00021\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacepandas_1_1core_1_1dtypes_1_1generic}{pandas.core.dtypes.generic}}\ \textcolor{keyword}{import}\ (}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00022}00022\ \ \ \ \ ABCDataFrame,}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00023}00023\ \ \ \ \ ABCSeries,}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00024}00024\ )}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00025}00025\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00026}00026\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacepandas_1_1core_1_1base}{pandas.core.base}}\ \textcolor{keyword}{import}\ PandasObject}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00027}00027\ \textcolor{keyword}{import}\ \mbox{\hyperlink{namespacepandas_1_1core_1_1common}{pandas.core.common}}\ \textcolor{keyword}{as}\ com}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00028}00028\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacepandas_1_1core_1_1computation_1_1common}{pandas.core.computation.common}}\ \textcolor{keyword}{import}\ result\_type\_many}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00029}00029\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00030}00030\ \textcolor{keywordflow}{if}\ TYPE\_CHECKING:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00031}00031\ \ \ \ \ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacecollections_1_1abc}{collections.abc}}\ \textcolor{keyword}{import}\ Sequence}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00033}00033\ \ \ \ \ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacepandas_1_1__typing}{pandas.\_typing}}\ \textcolor{keyword}{import}\ F}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00035}00035\ \ \ \ \ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacepandas_1_1core_1_1generic}{pandas.core.generic}}\ \textcolor{keyword}{import}\ NDFrame}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00036}00036\ \ \ \ \ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacepandas_1_1core_1_1indexes_1_1api}{pandas.core.indexes.api}}\ \textcolor{keyword}{import}\ Index}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00039}00039\ \textcolor{keyword}{def\ }\_align\_core\_single\_unary\_op(}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00040}00040\ \ \ \ \ term,}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00041}00041\ )\ -\/>\ tuple[partial\ |\ type[NDFrame],\ dict[str,\ Index]\ |\ None]:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00042}00042\ \ \ \ \ typ:\ partial\ |\ type[NDFrame]}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00043}00043\ \ \ \ \ axes:\ dict[str,\ Index]\ |\ \textcolor{keywordtype}{None}\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00045}00045\ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(term.value,\ np.ndarray):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00046}00046\ \ \ \ \ \ \ \ \ typ\ =\ partial(np.asanyarray,\ dtype=term.value.dtype)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00047}00047\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ typ\ =\ type(term.value)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(term.value,\ \textcolor{stringliteral}{"{}axes"{}}):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ axes\ =\ \_zip\_axes\_from\_type(typ,\ term.value.axes)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00052}00052\ \ \ \ \ \textcolor{keywordflow}{return}\ typ,\ axes}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00055}00055\ \textcolor{keyword}{def\ }\_zip\_axes\_from\_type(}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00056}00056\ \ \ \ \ typ:\ type[NDFrame],\ new\_axes:\ Sequence[Index]}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00057}00057\ )\ -\/>\ dict[str,\ Index]:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00058}00058\ \ \ \ \ \textcolor{keywordflow}{return}\ \{name:\ new\_axes[i]\ \textcolor{keywordflow}{for}\ i,\ name\ \textcolor{keywordflow}{in}\ enumerate(typ.\_AXIS\_ORDERS)\}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00061}\mbox{\hyperlink{namespacepandas_1_1core_1_1computation_1_1align_add496a9e9796c12904469c58017a7bcd}{00061}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacepandas_1_1core_1_1computation_1_1align_add496a9e9796c12904469c58017a7bcd}{\_any\_pandas\_objects}}(terms)\ -\/>\ bool:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00062}00062\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00063}00063\ \textcolor{stringliteral}{\ \ \ \ Check\ a\ sequence\ of\ terms\ for\ instances\ of\ PandasObject.}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00064}00064\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00065}00065\ \ \ \ \ \textcolor{keywordflow}{return}\ any(isinstance(term.value,\ PandasObject)\ \textcolor{keywordflow}{for}\ term\ \textcolor{keywordflow}{in}\ terms)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00066}00066\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00067}00067\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00068}00068\ \textcolor{keyword}{def\ }\_filter\_special\_cases(f)\ -\/>\ Callable[[F],\ F]:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00069}00069\ \ \ \ \ \textcolor{preprocessor}{@wraps(f)}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00070}00070\ \ \ \ \ \textcolor{keyword}{def\ }wrapper(terms):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00071}00071\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ single\ unary\ operand}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00072}00072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(terms)\ ==\ 1:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_align\_core\_single\_unary\_op(terms[0])}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00075}00075\ \ \ \ \ \ \ \ \ term\_values\ =\ (term.value\ \textcolor{keywordflow}{for}\ term\ \textcolor{keywordflow}{in}\ terms)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00076}00076\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ we\ don't\ have\ any\ pandas\ objects}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ \mbox{\hyperlink{namespacepandas_1_1core_1_1computation_1_1align_add496a9e9796c12904469c58017a7bcd}{\_any\_pandas\_objects}}(terms):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result\_type\_many(*term\_values),\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00081}00081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ f(terms)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00082}00082\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00083}00083\ \ \ \ \ \textcolor{keywordflow}{return}\ wrapper}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00085}00085\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00086}00086\ \textcolor{preprocessor}{@\_filter\_special\_cases}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00087}00087\ \textcolor{keyword}{def\ }\_align\_core(terms):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00088}00088\ \ \ \ \ term\_index\ =\ [i\ \textcolor{keywordflow}{for}\ i,\ term\ \textcolor{keywordflow}{in}\ enumerate(terms)\ \textcolor{keywordflow}{if}\ hasattr(term.value,\ \textcolor{stringliteral}{"{}axes"{}})]}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00089}00089\ \ \ \ \ term\_dims\ =\ [terms[i].value.ndim\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ term\_index]}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00090}00090\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00091}00091\ \ \ \ \ \textcolor{keyword}{from}\ pandas\ \textcolor{keyword}{import}\ Series}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00092}00092\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00093}00093\ \ \ \ \ ndims\ =\ Series(dict(zip(term\_index,\ term\_dims)))}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00094}00094\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00095}00095\ \ \ \ \ \textcolor{comment}{\#\ initial\ axes\ are\ the\ axes\ of\ the\ largest-\/axis'd\ term}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00096}00096\ \ \ \ \ biggest\ =\ terms[ndims.idxmax()].value}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00097}00097\ \ \ \ \ typ\ =\ biggest.\_constructor}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00098}00098\ \ \ \ \ axes\ =\ biggest.axes}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00099}00099\ \ \ \ \ naxes\ =\ len(axes)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00100}00100\ \ \ \ \ gt\_than\_one\_axis\ =\ naxes\ >\ 1}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00101}00101\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00102}00102\ \ \ \ \ \textcolor{keywordflow}{for}\ value\ \textcolor{keywordflow}{in}\ (terms[i].value\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ term\_index):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ is\_series\ =\ isinstance(value,\ ABCSeries)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00104}00104\ \ \ \ \ \ \ \ \ is\_series\_and\_gt\_one\_axis\ =\ is\_series\ \textcolor{keywordflow}{and}\ gt\_than\_one\_axis}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00105}00105\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00106}00106\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ axis,\ items\ \textcolor{keywordflow}{in}\ enumerate(value.axes):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00107}00107\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ is\_series\_and\_gt\_one\_axis:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00108}00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ax,\ itm\ =\ naxes\ -\/\ 1,\ value.index}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00109}00109\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ax,\ itm\ =\ axis,\ items}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00111}00111\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ axes[ax].is\_(itm):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00113}00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ axes[ax]\ =\ axes[ax].union(itm)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00114}00114\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00115}00115\ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ ndim\ \textcolor{keywordflow}{in}\ ndims.items():}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00116}00116\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ axis,\ items\ \textcolor{keywordflow}{in}\ zip(range(ndim),\ axes):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00117}00117\ \ \ \ \ \ \ \ \ \ \ \ \ ti\ =\ terms[i].value}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00118}00118\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00119}00119\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(ti,\ \textcolor{stringliteral}{"{}reindex"{}}):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00120}00120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ transpose\ =\ isinstance(ti,\ ABCSeries)\ \textcolor{keywordflow}{and}\ naxes\ >\ 1}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reindexer\ =\ axes[naxes\ -\/\ 1]\ \textcolor{keywordflow}{if}\ transpose\ \textcolor{keywordflow}{else}\ items}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00122}00122\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00123}00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ term\_axis\_size\ =\ len(ti.axes[axis])}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reindexer\_size\ =\ len(reindexer)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00125}00125\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00126}00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ordm\ =\ np.log10(max(1,\ abs(reindexer\_size\ -\/\ term\_axis\_size)))}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00127}00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ordm\ >=\ 1\ \textcolor{keywordflow}{and}\ reindexer\_size\ >=\ 10000:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00128}00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\ =\ (}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00129}00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}Alignment\ difference\ on\ axis\ \{axis\}\ is\ larger\ "{}}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}than\ an\ order\ of\ magnitude\ on\ term\ \{repr(terms[i].name)\},\ "{}}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00131}00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}by\ more\ than\ \{ordm:.4g\};\ performance\ may\ suffer."{}}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00132}00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00133}00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ warnings.warn(}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00134}00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w,\ category=PerformanceWarning,\ stacklevel=find\_stack\_level()}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00135}00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00136}00136\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ obj\ =\ ti.reindex(reindexer,\ axis=axis,\ copy=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ terms[i].update(obj)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00139}00139\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00140}00140\ \ \ \ \ \ \ \ \ terms[i].update(terms[i].value.values)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00141}00141\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00142}00142\ \ \ \ \ \textcolor{keywordflow}{return}\ typ,\ \_zip\_axes\_from\_type(typ,\ axes)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00143}00143\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00144}00144\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00145}\mbox{\hyperlink{namespacepandas_1_1core_1_1computation_1_1align_a07e73f5a70db38e05600c1f32c838be5}{00145}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacepandas_1_1core_1_1computation_1_1align_a07e73f5a70db38e05600c1f32c838be5}{align\_terms}}(terms):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00146}00146\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00147}00147\ \textcolor{stringliteral}{\ \ \ \ Align\ a\ set\ of\ terms.}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00148}00148\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00149}00149\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00150}00150\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ flatten\ the\ parse\ tree\ (a\ nested\ list,\ really)}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00151}00151\ \ \ \ \ \ \ \ \ terms\ =\ list(com.flatten(terms))}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00152}00152\ \ \ \ \ \textcolor{keywordflow}{except}\ TypeError:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00153}00153\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ can't\ iterate\ so\ it\ must\ just\ be\ a\ constant\ or\ single\ variable}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00154}00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(terms.value,\ (ABCSeries,\ ABCDataFrame)):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00155}00155\ \ \ \ \ \ \ \ \ \ \ \ \ typ\ =\ type(terms.value)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00156}00156\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ typ,\ \_zip\_axes\_from\_type(typ,\ terms.value.axes)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00157}00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ np.result\_type(terms.type),\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00159}00159\ \ \ \ \ \textcolor{comment}{\#\ if\ all\ resolved\ variables\ are\ numeric\ scalars}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00160}00160\ \ \ \ \ \textcolor{keywordflow}{if}\ all(term.is\_scalar\ \textcolor{keywordflow}{for}\ term\ \textcolor{keywordflow}{in}\ terms):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00161}00161\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result\_type\_many(*(term.value\ \textcolor{keywordflow}{for}\ term\ \textcolor{keywordflow}{in}\ terms)).type,\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00162}00162\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00163}00163\ \ \ \ \ \textcolor{comment}{\#\ perform\ the\ main\ alignment}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00164}00164\ \ \ \ \ typ,\ axes\ =\ \_align\_core(terms)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00165}00165\ \ \ \ \ \textcolor{keywordflow}{return}\ typ,\ axes}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00166}00166\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00167}00167\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00168}\mbox{\hyperlink{namespacepandas_1_1core_1_1computation_1_1align_ad91f11e86bf19138f21edfa37bd967d7}{00168}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacepandas_1_1core_1_1computation_1_1align_ad91f11e86bf19138f21edfa37bd967d7}{reconstruct\_object}}(typ,\ obj,\ axes,\ dtype):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00169}00169\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00170}00170\ \textcolor{stringliteral}{\ \ \ \ Reconstruct\ an\ object\ given\ its\ type,\ raw\ value,\ and\ possibly\ empty}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00171}00171\ \textcolor{stringliteral}{\ \ \ \ (None)\ axes.}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00172}00172\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00173}00173\ \textcolor{stringliteral}{\ \ \ \ Parameters}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00174}00174\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00175}00175\ \textcolor{stringliteral}{\ \ \ \ typ\ :\ object}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00176}00176\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ A\ type}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00177}00177\ \textcolor{stringliteral}{\ \ \ \ obj\ :\ object}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00178}00178\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ The\ value\ to\ use\ in\ the\ type\ constructor}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00179}00179\ \textcolor{stringliteral}{\ \ \ \ axes\ :\ dict}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00180}00180\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ The\ axes\ to\ use\ to\ construct\ the\ resulting\ pandas\ object}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00181}00181\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00182}00182\ \textcolor{stringliteral}{\ \ \ \ Returns}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00183}00183\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00184}00184\ \textcolor{stringliteral}{\ \ \ \ ret\ :\ typ}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00185}00185\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ An\ object\ of\ type\ \`{}\`{}typ\`{}\`{}\ with\ the\ value\ \`{}obj\`{}\ and\ possible\ axes}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00186}00186\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \`{}axes\`{}.}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00187}00187\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00188}00188\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00189}00189\ \ \ \ \ \ \ \ \ typ\ =\ typ.type}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00190}00190\ \ \ \ \ \textcolor{keywordflow}{except}\ AttributeError:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00191}00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00193}00193\ \ \ \ \ res\_t\ =\ np.result\_type(obj.dtype,\ dtype)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00194}00194\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00195}00195\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ isinstance(typ,\ partial)\ \textcolor{keywordflow}{and}\ issubclass(typ,\ PandasObject):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00196}00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ typ(obj,\ dtype=res\_t,\ **axes)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00197}00197\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00198}00198\ \ \ \ \ \textcolor{comment}{\#\ special\ case\ for\ pathological\ things\ like\ \string~True/\string~False}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00199}00199\ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(res\_t,\ \textcolor{stringliteral}{"{}type"{}})\ \textcolor{keywordflow}{and}\ typ\ ==\ np.bool\_\ \textcolor{keywordflow}{and}\ res\_t\ !=\ np.bool\_:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00200}00200\ \ \ \ \ \ \ \ \ ret\_value\ =\ res\_t.type(obj)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00201}00201\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00202}00202\ \ \ \ \ \ \ \ \ ret\_value\ =\ typ(obj).astype(res\_t)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00203}00203\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ The\ condition\ is\ to\ distinguish\ 0-\/dim\ array\ (returned\ in\ case\ of}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00204}00204\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ scalar)\ and\ 1\ element\ array}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00205}00205\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ e.g.\ np.array(0)\ and\ np.array([0])}}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00206}00206\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00207}00207\ \ \ \ \ \ \ \ \ \ \ \ \ len(obj.shape)\ ==\ 1}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{and}\ len(obj)\ ==\ 1}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ isinstance(ret\_value,\ np.ndarray)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00210}00210\ \ \ \ \ \ \ \ \ ):}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00211}00211\ \ \ \ \ \ \ \ \ \ \ \ \ ret\_value\ =\ np.array([ret\_value]).astype(res\_t)}
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00212}00212\ }
\DoxyCodeLine{\Hypertarget{pandas_2core_2computation_2align_8py_source_l00213}00213\ \ \ \ \ \textcolor{keywordflow}{return}\ ret\_value}

\end{DoxyCode}
