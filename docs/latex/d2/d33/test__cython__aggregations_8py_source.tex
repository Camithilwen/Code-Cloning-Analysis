\doxysection{test\+\_\+cython\+\_\+aggregations.\+py}
\hypertarget{test__cython__aggregations_8py_source}{}\label{test__cython__aggregations_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/pandas/tests/window/test\_cython\_aggregations.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/pandas/tests/window/test\_cython\_aggregations.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00001}\mbox{\hyperlink{namespacepandas_1_1tests_1_1window_1_1test__cython__aggregations}{00001}}\ \textcolor{keyword}{from}\ functools\ \textcolor{keyword}{import}\ partial}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00002}00002\ \textcolor{keyword}{import}\ sys}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00004}00004\ \textcolor{keyword}{import}\ numpy\ \textcolor{keyword}{as}\ np}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00005}00005\ \textcolor{keyword}{import}\ pytest}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00007}00007\ \textcolor{keyword}{import}\ pandas.\_libs.window.aggregations\ \textcolor{keyword}{as}\ window\_aggregations}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00008}00008\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00009}00009\ \textcolor{keyword}{from}\ pandas\ \textcolor{keyword}{import}\ Series}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00010}00010\ \textcolor{keyword}{import}\ \mbox{\hyperlink{namespacepandas_1_1__testing}{pandas.\_testing}}\ \textcolor{keyword}{as}\ tm}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00013}00013\ \textcolor{keyword}{def\ }\_get\_rolling\_aggregations():}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00014}00014\ \ \ \ \ \textcolor{comment}{\#\ list\ pairs\ of\ name\ and\ function}}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00015}00015\ \ \ \ \ \textcolor{comment}{\#\ each\ function\ has\ this\ signature:}}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00016}00016\ \ \ \ \ \textcolor{comment}{\#\ (const\ float64\_t[:]\ values,\ ndarray[int64\_t]\ start,}}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00017}00017\ \ \ \ \ \textcolor{comment}{\#\ \ ndarray[int64\_t]\ end,\ int64\_t\ minp)\ -\/>\ np.ndarray}}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00018}00018\ \ \ \ \ named\_roll\_aggs\ =\ (}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00019}00019\ \ \ \ \ \ \ \ \ [}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00020}00020\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}roll\_sum"{}},\ window\_aggregations.roll\_sum),}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00021}00021\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}roll\_mean"{}},\ window\_aggregations.roll\_mean),}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00022}00022\ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00023}00023\ \ \ \ \ \ \ \ \ +\ [}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00024}00024\ \ \ \ \ \ \ \ \ \ \ \ \ (f\textcolor{stringliteral}{"{}roll\_var(\{ddof\})"{}},\ partial(window\_aggregations.roll\_var,\ ddof=ddof))}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00025}00025\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ ddof\ \textcolor{keywordflow}{in}\ [0,\ 1]}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00026}00026\ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00027}00027\ \ \ \ \ \ \ \ \ +\ [}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00028}00028\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}roll\_skew"{}},\ window\_aggregations.roll\_skew),}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00029}00029\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}roll\_kurt"{}},\ window\_aggregations.roll\_kurt),}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00030}00030\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}roll\_median\_c"{}},\ window\_aggregations.roll\_median\_c),}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00031}00031\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}roll\_max"{}},\ window\_aggregations.roll\_max),}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00032}00032\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}roll\_min"{}},\ window\_aggregations.roll\_min),}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00033}00033\ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00034}00034\ \ \ \ \ \ \ \ \ +\ [}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00035}00035\ \ \ \ \ \ \ \ \ \ \ \ \ (}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00036}00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}roll\_quantile(\{quantile\},\{interpolation\})"{}},}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00037}00037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ partial(}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00038}00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ window\_aggregations.roll\_quantile,}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00039}00039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ quantile=quantile,}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00040}00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interpolation=interpolation,}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00041}00041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00042}00042\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00043}00043\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ quantile\ \textcolor{keywordflow}{in}\ [0.0001,\ 0.5,\ 0.9999]}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00044}00044\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ interpolation\ \textcolor{keywordflow}{in}\ window\_aggregations.interpolation\_types}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00045}00045\ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00046}00046\ \ \ \ \ \ \ \ \ +\ [}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00047}00047\ \ \ \ \ \ \ \ \ \ \ \ \ (}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}roll\_rank(\{percentile\},\{method\},\{ascending\})"{}},}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ partial(}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ window\_aggregations.roll\_rank,}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ percentile=percentile,}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ method=method,}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ascending=ascending,}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ percentile\ \textcolor{keywordflow}{in}\ [\textcolor{keyword}{True},\ \textcolor{keyword}{False}]}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ method\ \textcolor{keywordflow}{in}\ window\_aggregations.rolling\_rank\_tiebreakers.keys()}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ ascending\ \textcolor{keywordflow}{in}\ [\textcolor{keyword}{True},\ \textcolor{keyword}{False}]}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00059}00059\ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00060}00060\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00061}00061\ \ \ \ \ \textcolor{comment}{\#\ unzip\ to\ a\ list\ of\ 2\ tuples,\ names\ and\ functions}}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00062}00062\ \ \ \ \ unzipped\ =\ list(zip(*named\_roll\_aggs))}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00063}00063\ \ \ \ \ \textcolor{keywordflow}{return}\ \{\textcolor{stringliteral}{"{}ids"{}}:\ unzipped[0],\ \textcolor{stringliteral}{"{}params"{}}:\ unzipped[1]\}}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00064}00064\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00066}00066\ \_rolling\_aggregations\ =\ \_get\_rolling\_aggregations()}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00067}00067\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00068}00068\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00069}00069\ \textcolor{preprocessor}{@pytest.fixture}(}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00070}00070\ \ \ \ \ params=\_rolling\_aggregations[\textcolor{stringliteral}{"{}params"{}}],\ ids=\_rolling\_aggregations[\textcolor{stringliteral}{"{}ids"{}}]}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00071}00071\ )}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00072}\mbox{\hyperlink{namespacepandas_1_1tests_1_1window_1_1test__cython__aggregations_a6cad66d707402b796e683d9d21b9684a}{00072}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacepandas_1_1tests_1_1window_1_1test__cython__aggregations_a6cad66d707402b796e683d9d21b9684a}{rolling\_aggregation}}(request):}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00073}00073\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Make\ a\ rolling\ aggregation\ function\ as\ fixture."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00074}00074\ \ \ \ \ \textcolor{keywordflow}{return}\ request.param}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00075}00075\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00076}00076\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00077}00077\ \textcolor{keyword}{def\ }test\_rolling\_aggregation\_boundary\_consistency(rolling\_aggregation):}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00078}00078\ \ \ \ \ \textcolor{comment}{\#\ GH-\/45647}}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00079}00079\ \ \ \ \ minp,\ step,\ width,\ size,\ selection\ =\ 0,\ 1,\ 3,\ 11,\ [2,\ 7]}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00080}00080\ \ \ \ \ values\ =\ np.arange(1,\ 1\ +\ size,\ dtype=np.float64)}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00081}00081\ \ \ \ \ end\ =\ np.arange(width,\ size,\ step,\ dtype=np.int64)}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00082}00082\ \ \ \ \ start\ =\ end\ -\/\ width}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00083}00083\ \ \ \ \ selarr\ =\ np.array(selection,\ dtype=np.int32)}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00084}00084\ \ \ \ \ result\ =\ Series(\mbox{\hyperlink{namespacepandas_1_1tests_1_1window_1_1test__cython__aggregations_a6cad66d707402b796e683d9d21b9684a}{rolling\_aggregation}}(values,\ start[selarr],\ end[selarr],\ minp))}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00085}00085\ \ \ \ \ expected\ =\ Series(\mbox{\hyperlink{namespacepandas_1_1tests_1_1window_1_1test__cython__aggregations_a6cad66d707402b796e683d9d21b9684a}{rolling\_aggregation}}(values,\ start,\ end,\ minp)[selarr])}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00086}00086\ \ \ \ \ tm.assert\_equal(expected,\ result)}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00088}00088\ }
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00089}00089\ \textcolor{keyword}{def\ }test\_rolling\_aggregation\_with\_unused\_elements(rolling\_aggregation):}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00090}00090\ \ \ \ \ \textcolor{comment}{\#\ GH-\/45647}}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00091}00091\ \ \ \ \ minp,\ width\ =\ 0,\ 5\ \ \textcolor{comment}{\#\ width\ at\ least\ 4\ for\ kurt}}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00092}00092\ \ \ \ \ size\ =\ 2\ *\ width\ +\ 5}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00093}00093\ \ \ \ \ values\ =\ np.arange(1,\ size\ +\ 1,\ dtype=np.float64)}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00094}00094\ \ \ \ \ values[width\ :\ width\ +\ 2]\ =\ sys.float\_info.min}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00095}00095\ \ \ \ \ values[width\ +\ 2]\ =\ np.nan}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00096}00096\ \ \ \ \ values[width\ +\ 3\ :\ width\ +\ 5]\ =\ sys.float\_info.max}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00097}00097\ \ \ \ \ start\ =\ np.array([0,\ size\ -\/\ width],\ dtype=np.int64)}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00098}00098\ \ \ \ \ end\ =\ np.array([width,\ size],\ dtype=np.int64)}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00099}00099\ \ \ \ \ loc\ =\ np.array(}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00100}00100\ \ \ \ \ \ \ \ \ [j\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(len(start))\ \textcolor{keywordflow}{for}\ j\ \textcolor{keywordflow}{in}\ range(start[i],\ end[i])],}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00101}00101\ \ \ \ \ \ \ \ \ dtype=np.int32,}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00102}00102\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00103}00103\ \ \ \ \ result\ =\ Series(\mbox{\hyperlink{namespacepandas_1_1tests_1_1window_1_1test__cython__aggregations_a6cad66d707402b796e683d9d21b9684a}{rolling\_aggregation}}(values,\ start,\ end,\ minp))}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00104}00104\ \ \ \ \ compact\_values\ =\ np.array(values[loc],\ dtype=np.float64)}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00105}00105\ \ \ \ \ compact\_start\ =\ np.arange(0,\ len(start)\ *\ width,\ width,\ dtype=np.int64)}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00106}00106\ \ \ \ \ compact\_end\ =\ compact\_start\ +\ width}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00107}00107\ \ \ \ \ expected\ =\ Series(}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00108}00108\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacepandas_1_1tests_1_1window_1_1test__cython__aggregations_a6cad66d707402b796e683d9d21b9684a}{rolling\_aggregation}}(compact\_values,\ compact\_start,\ compact\_end,\ minp)}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00109}00109\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00110}00110\ \ \ \ \ \textcolor{keyword}{assert}\ np.isfinite(expected.values).all(),\ \textcolor{stringliteral}{"{}Not\ all\ expected\ values\ are\ finite"{}}}
\DoxyCodeLine{\Hypertarget{test__cython__aggregations_8py_source_l00111}00111\ \ \ \ \ tm.assert\_equal(expected,\ result)}

\end{DoxyCode}
