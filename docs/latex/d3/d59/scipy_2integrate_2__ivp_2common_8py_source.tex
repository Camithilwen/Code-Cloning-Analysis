\doxysection{common.\+py}
\hypertarget{scipy_2integrate_2__ivp_2common_8py_source}{}\label{scipy_2integrate_2__ivp_2common_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/scipy/integrate/\_ivp/common.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/scipy/integrate/\_ivp/common.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00001}\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common}{00001}}\ \textcolor{keyword}{from}\ itertools\ \textcolor{keyword}{import}\ groupby}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00002}00002\ \textcolor{keyword}{from}\ warnings\ \textcolor{keyword}{import}\ warn}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00003}00003\ \textcolor{keyword}{import}\ numpy\ \textcolor{keyword}{as}\ np}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00004}00004\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacescipy_1_1sparse}{scipy.sparse}}\ \textcolor{keyword}{import}\ find,\ coo\_matrix}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00007}00007\ EPS\ =\ np.finfo(float).eps}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00008}00008\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00010}\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_aa028a0075b67bd9c7c10dc030e804528}{00010}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_aa028a0075b67bd9c7c10dc030e804528}{validate\_first\_step}}(first\_step,\ t0,\ t\_bound):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00011}00011\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Assert\ that\ first\_step\ is\ valid\ and\ return\ it."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00012}00012\ \ \ \ \ \textcolor{keywordflow}{if}\ first\_step\ <=\ 0:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00013}00013\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classValueError}{ValueError}}(\textcolor{stringliteral}{"{}\`{}first\_step`\ must\ be\ positive."{}})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00014}00014\ \ \ \ \ \textcolor{keywordflow}{if}\ first\_step\ >\ np.abs(t\_bound\ -\/\ t0):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00015}00015\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classValueError}{ValueError}}(\textcolor{stringliteral}{"{}\`{}first\_step`\ exceeds\ bounds."{}})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00016}00016\ \ \ \ \ \textcolor{keywordflow}{return}\ first\_step}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00019}\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_a469f4e852e90b35ef087ded6677de228}{00019}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_a469f4e852e90b35ef087ded6677de228}{validate\_max\_step}}(max\_step):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00020}00020\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Assert\ that\ max\_Step\ is\ valid\ and\ return\ it."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00021}00021\ \ \ \ \ \textcolor{keywordflow}{if}\ max\_step\ <=\ 0:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00022}00022\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classValueError}{ValueError}}(\textcolor{stringliteral}{"{}\`{}max\_step`\ must\ be\ positive."{}})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00023}00023\ \ \ \ \ \textcolor{keywordflow}{return}\ max\_step}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00025}00025\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00026}\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_a323627182fd010a78735697f4d87dfd2}{00026}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_a323627182fd010a78735697f4d87dfd2}{warn\_extraneous}}(extraneous):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00027}00027\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Display\ a\ warning\ for\ extraneous\ keyword\ arguments.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00028}00028\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00029}00029\ \textcolor{stringliteral}{\ \ \ \ The\ initializer\ of\ each\ solver\ class\ is\ expected\ to\ collect\ keyword}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00030}00030\ \textcolor{stringliteral}{\ \ \ \ arguments\ that\ it\ doesn't\ understand\ and\ warn\ about\ them.\ This\ function}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00031}00031\ \textcolor{stringliteral}{\ \ \ \ prints\ a\ warning\ for\ each\ key\ in\ the\ supplied\ dictionary.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00032}00032\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00033}00033\ \textcolor{stringliteral}{\ \ \ \ Parameters}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00034}00034\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00035}00035\ \textcolor{stringliteral}{\ \ \ \ extraneous\ :\ dict}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00036}00036\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Extraneous\ keyword\ arguments}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00037}00037\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00038}00038\ \ \ \ \ \textcolor{keywordflow}{if}\ extraneous:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00039}00039\ \ \ \ \ \ \ \ \ warn(\textcolor{stringliteral}{"{}The\ following\ arguments\ have\ no\ effect\ for\ a\ chosen\ solver:\ \{\}."{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00040}00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ .format(\textcolor{stringliteral}{"{},\ "{}}.join(f\textcolor{stringliteral}{"{}\`{}\{x\}`"{}}\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ extraneous)))}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00043}\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_a6828351fc511f9fe00e722bae893cc7a}{00043}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_a6828351fc511f9fe00e722bae893cc7a}{validate\_tol}}(rtol,\ atol,\ n):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00044}00044\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Validate\ tolerance\ values."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00045}00045\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00046}00046\ \ \ \ \ \textcolor{keywordflow}{if}\ np.any(rtol\ <\ 100\ *\ EPS):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00047}00047\ \ \ \ \ \ \ \ \ warn(\textcolor{stringliteral}{"{}At\ least\ one\ element\ of\ \`{}rtol`\ is\ too\ small.\ "{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}Setting\ \`{}rtol\ =\ np.maximum(rtol,\ \{100\ *\ EPS\})`."{}})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ rtol\ =\ np.maximum(rtol,\ 100\ *\ EPS)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00050}00050\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00051}00051\ \ \ \ \ atol\ =\ np.asarray(atol)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00052}00052\ \ \ \ \ \textcolor{keywordflow}{if}\ atol.ndim\ >\ 0\ \textcolor{keywordflow}{and}\ atol.shape\ !=\ (n,):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00053}00053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classValueError}{ValueError}}(\textcolor{stringliteral}{"{}\`{}atol`\ has\ wrong\ shape."{}})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00055}00055\ \ \ \ \ \textcolor{keywordflow}{if}\ np.any(atol\ <\ 0):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classValueError}{ValueError}}(\textcolor{stringliteral}{"{}\`{}atol`\ must\ be\ positive."{}})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00057}00057\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00058}00058\ \ \ \ \ \textcolor{keywordflow}{return}\ rtol,\ atol}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00061}\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_a13f810a27eaca51b874e1283aca96d73}{00061}}\ \textcolor{keyword}{def\ }norm(x):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00062}00062\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Compute\ RMS\ norm."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00063}00063\ \ \ \ \ \textcolor{keywordflow}{return}\ np.linalg.norm(x)\ /\ x.size\ **\ 0.5}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00064}00064\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00066}\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_ae1f51383a7204f566360554a837f42bd}{00066}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_ae1f51383a7204f566360554a837f42bd}{select\_initial\_step}}(fun,\ t0,\ y0,\ f0,\ direction,\ order,\ rtol,\ atol):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00067}00067\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Empirically\ select\ a\ good\ initial\ step.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00068}00068\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00069}00069\ \textcolor{stringliteral}{\ \ \ \ The\ algorithm\ is\ described\ in\ [1]\_.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00070}00070\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00071}00071\ \textcolor{stringliteral}{\ \ \ \ Parameters}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00072}00072\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00073}00073\ \textcolor{stringliteral}{\ \ \ \ fun\ :\ callable}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00074}00074\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Right-\/hand\ side\ of\ the\ system.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00075}00075\ \textcolor{stringliteral}{\ \ \ \ t0\ :\ float}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00076}00076\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Initial\ value\ of\ the\ independent\ variable.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00077}00077\ \textcolor{stringliteral}{\ \ \ \ y0\ :\ ndarray,\ shape\ (n,)}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00078}00078\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Initial\ value\ of\ the\ dependent\ variable.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00079}00079\ \textcolor{stringliteral}{\ \ \ \ f0\ :\ ndarray,\ shape\ (n,)}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00080}00080\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Initial\ value\ of\ the\ derivative,\ i.e.,\ \`{}\`{}fun(t0,\ y0)\`{}\`{}.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00081}00081\ \textcolor{stringliteral}{\ \ \ \ direction\ :\ float}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00082}00082\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Integration\ direction.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00083}00083\ \textcolor{stringliteral}{\ \ \ \ order\ :\ float}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00084}00084\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Error\ estimator\ order.\ It\ means\ that\ the\ error\ controlled\ by\ the}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00085}00085\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ algorithm\ is\ proportional\ to\ \`{}\`{}step\_size\ **\ (order\ +\ 1)\`{}.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00086}00086\ \textcolor{stringliteral}{\ \ \ \ rtol\ :\ float}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00087}00087\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Desired\ relative\ tolerance.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00088}00088\ \textcolor{stringliteral}{\ \ \ \ atol\ :\ float}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00089}00089\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Desired\ absolute\ tolerance.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00090}00090\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00091}00091\ \textcolor{stringliteral}{\ \ \ \ Returns}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00092}00092\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00093}00093\ \textcolor{stringliteral}{\ \ \ \ h\_abs\ :\ float}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00094}00094\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Absolute\ value\ of\ the\ suggested\ initial\ step.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00095}00095\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00096}00096\ \textcolor{stringliteral}{\ \ \ \ References}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00097}00097\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00098}00098\ \textcolor{stringliteral}{\ \ \ \ ..\ [1]\ E.\ Hairer,\ S.\ P.\ Norsett\ G.\ Wanner,\ "{}Solving\ Ordinary\ Differential}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00099}00099\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ Equations\ I:\ Nonstiff\ Problems"{},\ Sec.\ II.4.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00100}00100\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00101}00101\ \ \ \ \ \textcolor{keywordflow}{if}\ y0.size\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00102}00102\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ np.inf}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00104}00104\ \ \ \ \ scale\ =\ atol\ +\ np.abs(y0)\ *\ rtol}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00105}00105\ \ \ \ \ d0\ =\ norm(y0\ /\ scale)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00106}00106\ \ \ \ \ d1\ =\ norm(f0\ /\ scale)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00107}00107\ \ \ \ \ \textcolor{keywordflow}{if}\ d0\ <\ 1e-\/5\ \textcolor{keywordflow}{or}\ d1\ <\ 1e-\/5:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00108}00108\ \ \ \ \ \ \ \ \ h0\ =\ 1e-\/6}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00109}00109\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00110}00110\ \ \ \ \ \ \ \ \ h0\ =\ 0.01\ *\ d0\ /\ d1}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00111}00111\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00112}00112\ \ \ \ \ y1\ =\ y0\ +\ h0\ *\ direction\ *\ f0}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00113}00113\ \ \ \ \ f1\ =\ fun(t0\ +\ h0\ *\ direction,\ y1)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00114}00114\ \ \ \ \ d2\ =\ norm((f1\ -\/\ f0)\ /\ scale)\ /\ h0}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00115}00115\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00116}00116\ \ \ \ \ \textcolor{keywordflow}{if}\ d1\ <=\ 1e-\/15\ \textcolor{keywordflow}{and}\ d2\ <=\ 1e-\/15:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00117}00117\ \ \ \ \ \ \ \ \ h1\ =\ max(1e-\/6,\ h0\ *\ 1e-\/3)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00118}00118\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00119}00119\ \ \ \ \ \ \ \ \ h1\ =\ (0.01\ /\ max(d1,\ d2))\ **\ (1\ /\ (order\ +\ 1))}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00120}00120\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00121}00121\ \ \ \ \ \textcolor{keywordflow}{return}\ min(100\ *\ h0,\ h1)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00122}00122\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00123}00123\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00124}\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution}{00124}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution}{OdeSolution}}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00125}00125\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Continuous\ ODE\ solution.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00126}00126\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00127}00127\ \textcolor{stringliteral}{\ \ \ \ It\ is\ organized\ as\ a\ collection\ of\ \`{}DenseOutput\`{}\ objects\ which\ represent}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00128}00128\ \textcolor{stringliteral}{\ \ \ \ local\ interpolants.\ It\ provides\ an\ algorithm\ to\ select\ a\ right\ interpolant}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00129}00129\ \textcolor{stringliteral}{\ \ \ \ for\ each\ given\ point.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00130}00130\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00131}00131\ \textcolor{stringliteral}{\ \ \ \ The\ interpolants\ cover\ the\ range\ between\ \`{}t\_min\`{}\ and\ \`{}t\_max\`{}\ (see}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00132}00132\ \textcolor{stringliteral}{\ \ \ \ Attributes\ below).\ Evaluation\ outside\ this\ interval\ is\ not\ forbidden,\ but}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00133}00133\ \textcolor{stringliteral}{\ \ \ \ the\ accuracy\ is\ not\ guaranteed.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00134}00134\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00135}00135\ \textcolor{stringliteral}{\ \ \ \ When\ evaluating\ at\ a\ breakpoint\ (one\ of\ the\ values\ in\ \`{}ts\`{})\ a\ segment\ with}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00136}00136\ \textcolor{stringliteral}{\ \ \ \ the\ lower\ index\ is\ selected.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00137}00137\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00138}00138\ \textcolor{stringliteral}{\ \ \ \ Parameters}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00139}00139\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00140}00140\ \textcolor{stringliteral}{\ \ \ \ ts\ :\ array\_like,\ shape\ (n\_segments\ +\ 1,)}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00141}00141\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Time\ instants\ between\ which\ local\ interpolants\ are\ defined.\ Must}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00142}00142\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ be\ strictly\ increasing\ or\ decreasing\ (zero\ segment\ with\ two\ points\ is}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00143}00143\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ also\ allowed).}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00144}00144\ \textcolor{stringliteral}{\ \ \ \ interpolants\ :\ list\ of\ DenseOutput\ with\ n\_segments\ elements}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00145}00145\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Local\ interpolants.\ An\ i-\/th\ interpolant\ is\ assumed\ to\ be\ defined}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00146}00146\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ between\ \`{}\`{}ts[i]\`{}\`{}\ and\ \`{}\`{}ts[i\ +\ 1]\`{}\`{}.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00147}00147\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00148}00148\ \textcolor{stringliteral}{\ \ \ \ Attributes}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00149}00149\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00150}00150\ \textcolor{stringliteral}{\ \ \ \ t\_min,\ t\_max\ :\ float}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00151}00151\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Time\ range\ of\ the\ interpolation.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00152}00152\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00153}00153\ \ \ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(self,\ ts,\ interpolants):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00154}00154\ \ \ \ \ \ \ \ \ ts\ =\ np.asarray(ts)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00155}00155\ \ \ \ \ \ \ \ \ d\ =\ np.diff(ts)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00156}00156\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ The\ first\ case\ covers\ integration\ on\ zero\ segment.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00157}00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ ((ts.size\ ==\ 2\ \textcolor{keywordflow}{and}\ ts[0]\ ==\ ts[-\/1])}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00158}00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{or}\ np.all(d\ >\ 0)\ \textcolor{keywordflow}{or}\ np.all(d\ <\ 0)):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00159}00159\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classValueError}{ValueError}}(\textcolor{stringliteral}{"{}\`{}ts`\ must\ be\ strictly\ increasing\ or\ decreasing."{}})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00160}00160\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00161}00161\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a9ea9b8df57df881087d3818a23c3446b}{n\_segments}}\ =\ len(interpolants)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00162}00162\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ts.shape\ !=\ (self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a9ea9b8df57df881087d3818a23c3446b}{n\_segments}}\ +\ 1,):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00163}00163\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classValueError}{ValueError}}(\textcolor{stringliteral}{"{}Numbers\ of\ time\ stamps\ and\ interpolants\ "{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}don't\ match."{}})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00166}00166\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a2e28f2132eb1d46c8bab1dda2d1d62ee}{ts}}\ =\ ts}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00167}00167\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_aefbbdd708b659f149d286ba6f840eae4}{interpolants}}\ =\ interpolants}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00168}00168\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ts[-\/1]\ >=\ ts[0]:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00169}00169\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a05bb139af29a9f82a17c3112284f2eb7}{t\_min}}\ =\ ts[0]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00170}00170\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_ad7dc4d42e17f4454069a6e8bef959d18}{t\_max}}\ =\ ts[-\/1]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00171}00171\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a856faa3ca2ed5fa845dce725587eea3a}{ascending}}\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00172}00172\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a7d1442fdb360080b5f3751ac0353dc0b}{ts\_sorted}}\ =\ ts}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00173}00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a05bb139af29a9f82a17c3112284f2eb7}{t\_min}}\ =\ ts[-\/1]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_ad7dc4d42e17f4454069a6e8bef959d18}{t\_max}}\ =\ ts[0]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00176}00176\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a856faa3ca2ed5fa845dce725587eea3a}{ascending}}\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a7d1442fdb360080b5f3751ac0353dc0b}{ts\_sorted}}\ =\ ts[::-\/1]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00178}00178\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00179}00179\ \ \ \ \ \textcolor{keyword}{def\ }\_call\_single(self,\ t):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00180}00180\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Here\ we\ preserve\ a\ certain\ symmetry\ that\ when\ t\ is\ in\ self.ts,}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00181}00181\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ then\ we\ prioritize\ a\ segment\ with\ a\ lower\ index.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00182}00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a856faa3ca2ed5fa845dce725587eea3a}{ascending}}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00183}00183\ \ \ \ \ \ \ \ \ \ \ \ \ ind\ =\ np.searchsorted(self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a7d1442fdb360080b5f3751ac0353dc0b}{ts\_sorted}},\ t,\ side=\textcolor{stringliteral}{'left'})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00184}00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ ind\ =\ np.searchsorted(self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a7d1442fdb360080b5f3751ac0353dc0b}{ts\_sorted}},\ t,\ side=\textcolor{stringliteral}{'right'})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00186}00186\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00187}00187\ \ \ \ \ \ \ \ \ segment\ =\ min(max(ind\ -\/\ 1,\ 0),\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a9ea9b8df57df881087d3818a23c3446b}{n\_segments}}\ -\/\ 1)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00188}00188\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a856faa3ca2ed5fa845dce725587eea3a}{ascending}}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \ \ \ segment\ =\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a9ea9b8df57df881087d3818a23c3446b}{n\_segments}}\ -\/\ 1\ -\/\ segment}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00190}00190\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00191}00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_aefbbdd708b659f149d286ba6f840eae4}{interpolants}}[segment](t)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00193}\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_ad575447c6b94c44465dab4d571eb0b18}{00193}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_ad575447c6b94c44465dab4d571eb0b18}{\_\_call\_\_}}(self,\ t):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00194}00194\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Evaluate\ the\ solution.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00195}00195\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00196}00196\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Parameters}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00197}00197\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00198}00198\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ t\ :\ float\ or\ array\_like\ with\ shape\ (n\_points,)}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00199}00199\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ Points\ to\ evaluate\ at.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00200}00200\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00201}00201\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Returns}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00202}00202\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00203}00203\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ y\ :\ ndarray,\ shape\ (n\_states,)\ or\ (n\_states,\ n\_points)}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00204}00204\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ Computed\ values.\ Shape\ depends\ on\ whether\ \`{}t\`{}\ is\ a\ scalar\ or\ a}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00205}00205\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ 1-\/D\ array.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00206}00206\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00207}00207\ \ \ \ \ \ \ \ \ t\ =\ np.asarray(t)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00208}00208\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00209}00209\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ t.ndim\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00210}00210\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a43baf0639afb178d965a27f6a5ff54eb}{\_call\_single}}(t)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00211}00211\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00212}00212\ \ \ \ \ \ \ \ \ order\ =\ np.argsort(t)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00213}00213\ \ \ \ \ \ \ \ \ reverse\ =\ np.empty\_like(order)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00214}00214\ \ \ \ \ \ \ \ \ reverse[order]\ =\ np.arange(order.shape[0])}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00215}00215\ \ \ \ \ \ \ \ \ t\_sorted\ =\ t[order]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00216}00216\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00217}00217\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ See\ comment\ in\ self.\_call\_single.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00218}00218\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a856faa3ca2ed5fa845dce725587eea3a}{ascending}}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00219}00219\ \ \ \ \ \ \ \ \ \ \ \ \ segments\ =\ np.searchsorted(self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a7d1442fdb360080b5f3751ac0353dc0b}{ts\_sorted}},\ t\_sorted,\ side=\textcolor{stringliteral}{'left'})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00220}00220\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00221}00221\ \ \ \ \ \ \ \ \ \ \ \ \ segments\ =\ np.searchsorted(self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a7d1442fdb360080b5f3751ac0353dc0b}{ts\_sorted}},\ t\_sorted,\ side=\textcolor{stringliteral}{'right'})}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00222}00222\ \ \ \ \ \ \ \ \ segments\ -\/=\ 1}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00223}00223\ \ \ \ \ \ \ \ \ segments[segments\ <\ 0]\ =\ 0}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00224}00224\ \ \ \ \ \ \ \ \ segments[segments\ >\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a9ea9b8df57df881087d3818a23c3446b}{n\_segments}}\ -\/\ 1]\ =\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a9ea9b8df57df881087d3818a23c3446b}{n\_segments}}\ -\/\ 1}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00225}00225\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a856faa3ca2ed5fa845dce725587eea3a}{ascending}}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00226}00226\ \ \ \ \ \ \ \ \ \ \ \ \ segments\ =\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_a9ea9b8df57df881087d3818a23c3446b}{n\_segments}}\ -\/\ 1\ -\/\ segments}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00227}00227\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00228}00228\ \ \ \ \ \ \ \ \ ys\ =\ []}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00229}00229\ \ \ \ \ \ \ \ \ group\_start\ =\ 0}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00230}00230\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ segment,\ group\ \textcolor{keywordflow}{in}\ groupby(segments):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00231}00231\ \ \ \ \ \ \ \ \ \ \ \ \ group\_end\ =\ group\_start\ +\ len(list(group))}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00232}00232\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ self.\mbox{\hyperlink{classscipy_1_1integrate_1_1__ivp_1_1common_1_1OdeSolution_aefbbdd708b659f149d286ba6f840eae4}{interpolants}}[segment](t\_sorted[group\_start:group\_end])}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00233}00233\ \ \ \ \ \ \ \ \ \ \ \ \ ys.append(y)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00234}00234\ \ \ \ \ \ \ \ \ \ \ \ \ group\_start\ =\ group\_end}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00235}00235\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00236}00236\ \ \ \ \ \ \ \ \ ys\ =\ np.hstack(ys)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00237}00237\ \ \ \ \ \ \ \ \ ys\ =\ ys[:,\ reverse]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00238}00238\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00239}00239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ys}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00240}00240\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00241}00241\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00242}00242\ NUM\_JAC\_DIFF\_REJECT\ =\ EPS\ **\ 0.875}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00243}00243\ NUM\_JAC\_DIFF\_SMALL\ =\ EPS\ **\ 0.75}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00244}00244\ NUM\_JAC\_DIFF\_BIG\ =\ EPS\ **\ 0.25}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00245}00245\ NUM\_JAC\_MIN\_FACTOR\ =\ 1e3\ *\ EPS}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00246}00246\ NUM\_JAC\_FACTOR\_INCREASE\ =\ 10}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00247}00247\ NUM\_JAC\_FACTOR\_DECREASE\ =\ 0.1}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00248}00248\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00249}00249\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00250}\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_ad7afdad633d3b5f2d89915373dea34c2}{00250}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacescipy_1_1integrate_1_1__ivp_1_1common_ad7afdad633d3b5f2d89915373dea34c2}{num\_jac}}(fun,\ t,\ y,\ f,\ threshold,\ factor,\ sparsity=None):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00251}00251\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Finite\ differences\ Jacobian\ approximation\ tailored\ for\ ODE\ solvers.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00252}00252\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00253}00253\ \textcolor{stringliteral}{\ \ \ \ This\ function\ computes\ finite\ difference\ approximation\ to\ the\ Jacobian}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00254}00254\ \textcolor{stringliteral}{\ \ \ \ matrix\ of\ \`{}fun\`{}\ with\ respect\ to\ \`{}y\`{}\ using\ forward\ differences.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00255}00255\ \textcolor{stringliteral}{\ \ \ \ The\ Jacobian\ matrix\ has\ shape\ (n,\ n)\ and\ its\ element\ (i,\ j)\ is\ equal\ to}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00256}00256\ \textcolor{stringliteral}{\ \ \ \ \`{}\`{}d\ f\_i\ /\ d\ y\_j\`{}\`{}.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00257}00257\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00258}00258\ \textcolor{stringliteral}{\ \ \ \ A\ special\ feature\ of\ this\ function\ is\ the\ ability\ to\ correct\ the\ step}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00259}00259\ \textcolor{stringliteral}{\ \ \ \ size\ from\ iteration\ to\ iteration.\ The\ main\ idea\ is\ to\ keep\ the\ finite}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00260}00260\ \textcolor{stringliteral}{\ \ \ \ difference\ significantly\ separated\ from\ its\ round-\/off\ error\ which}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00261}00261\ \textcolor{stringliteral}{\ \ \ \ approximately\ equals\ \`{}\`{}EPS\ *\ np.abs(f)\`{}\`{}.\ It\ reduces\ a\ possibility\ of\ a}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00262}00262\ \textcolor{stringliteral}{\ \ \ \ huge\ error\ and\ assures\ that\ the\ estimated\ derivative\ are\ reasonably\ close}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00263}00263\ \textcolor{stringliteral}{\ \ \ \ to\ the\ true\ values\ (i.e.,\ the\ finite\ difference\ approximation\ is\ at\ least}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00264}00264\ \textcolor{stringliteral}{\ \ \ \ qualitatively\ reflects\ the\ structure\ of\ the\ true\ Jacobian).}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00265}00265\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00266}00266\ \textcolor{stringliteral}{\ \ \ \ Parameters}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00267}00267\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00268}00268\ \textcolor{stringliteral}{\ \ \ \ fun\ :\ callable}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00269}00269\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Right-\/hand\ side\ of\ the\ system\ implemented\ in\ a\ vectorized\ fashion.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00270}00270\ \textcolor{stringliteral}{\ \ \ \ t\ :\ float}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00271}00271\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Current\ time.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00272}00272\ \textcolor{stringliteral}{\ \ \ \ y\ :\ ndarray,\ shape\ (n,)}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00273}00273\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Current\ state.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00274}00274\ \textcolor{stringliteral}{\ \ \ \ f\ :\ ndarray,\ shape\ (n,)}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00275}00275\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Value\ of\ the\ right\ hand\ side\ at\ (t,\ y).}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00276}00276\ \textcolor{stringliteral}{\ \ \ \ threshold\ :\ float}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00277}00277\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Threshold\ for\ \`{}y\`{}\ value\ used\ for\ computing\ the\ step\ size\ as}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00278}00278\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \`{}\`{}factor\ *\ np.maximum(np.abs(y),\ threshold)\`{}\`{}.\ Typically,\ the\ value\ of}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00279}00279\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ absolute\ tolerance\ (atol)\ for\ a\ solver\ should\ be\ passed\ as\ \`{}threshold\`{}.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00280}00280\ \textcolor{stringliteral}{\ \ \ \ factor\ :\ ndarray\ with\ shape\ (n,)\ or\ None}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00281}00281\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Factor\ to\ use\ for\ computing\ the\ step\ size.\ Pass\ None\ for\ the\ very}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00282}00282\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ evaluation,\ then\ use\ the\ value\ returned\ from\ this\ function.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00283}00283\ \textcolor{stringliteral}{\ \ \ \ sparsity\ :\ tuple\ (structure,\ groups)\ or\ None}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00284}00284\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Sparsity\ structure\ of\ the\ Jacobian,\ \`{}structure\`{}\ must\ be\ csc\_matrix.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00285}00285\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00286}00286\ \textcolor{stringliteral}{\ \ \ \ Returns}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00287}00287\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00288}00288\ \textcolor{stringliteral}{\ \ \ \ J\ :\ ndarray\ or\ csc\_matrix,\ shape\ (n,\ n)}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00289}00289\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Jacobian\ matrix.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00290}00290\ \textcolor{stringliteral}{\ \ \ \ factor\ :\ ndarray,\ shape\ (n,)}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00291}00291\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Suggested\ \`{}factor\`{}\ for\ the\ next\ evaluation.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00292}00292\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00293}00293\ \ \ \ \ y\ =\ np.asarray(y)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00294}00294\ \ \ \ \ n\ =\ y.shape[0]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00295}00295\ \ \ \ \ \textcolor{keywordflow}{if}\ n\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00296}00296\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ np.empty((0,\ 0)),\ factor}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00297}00297\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00298}00298\ \ \ \ \ \textcolor{keywordflow}{if}\ factor\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00299}00299\ \ \ \ \ \ \ \ \ factor\ =\ np.full(n,\ EPS\ **\ 0.5)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00300}00300\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00301}00301\ \ \ \ \ \ \ \ \ factor\ =\ factor.copy()}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00302}00302\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00303}00303\ \ \ \ \ \textcolor{comment}{\#\ Direct\ the\ step\ as\ ODE\ dictates,\ hoping\ that\ such\ a\ step\ won't\ lead\ to}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00304}00304\ \ \ \ \ \textcolor{comment}{\#\ a\ problematic\ region.\ For\ complex\ ODEs\ it\ makes\ sense\ to\ use\ the\ real}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00305}00305\ \ \ \ \ \textcolor{comment}{\#\ part\ of\ f\ as\ we\ use\ steps\ along\ real\ axis.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00306}00306\ \ \ \ \ f\_sign\ =\ 2\ *\ (np.real(f)\ >=\ 0).astype(float)\ -\/\ 1}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00307}00307\ \ \ \ \ y\_scale\ =\ f\_sign\ *\ np.maximum(threshold,\ np.abs(y))}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00308}00308\ \ \ \ \ h\ =\ (y\ +\ factor\ *\ y\_scale)\ -\/\ y}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00309}00309\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00310}00310\ \ \ \ \ \textcolor{comment}{\#\ Make\ sure\ that\ the\ step\ is\ not\ 0\ to\ start\ with.\ Not\ likely\ it\ will\ be}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00311}00311\ \ \ \ \ \textcolor{comment}{\#\ executed\ often.}}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00312}00312\ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ np.nonzero(h\ ==\ 0)[0]:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00313}00313\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ h[i]\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00314}00314\ \ \ \ \ \ \ \ \ \ \ \ \ factor[i]\ *=\ 10}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00315}00315\ \ \ \ \ \ \ \ \ \ \ \ \ h[i]\ =\ (y[i]\ +\ factor[i]\ *\ y\_scale[i])\ -\/\ y[i]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00316}00316\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00317}00317\ \ \ \ \ \textcolor{keywordflow}{if}\ sparsity\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00318}00318\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_dense\_num\_jac(fun,\ t,\ y,\ f,\ h,\ factor,\ y\_scale)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00319}00319\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00320}00320\ \ \ \ \ \ \ \ \ structure,\ groups\ =\ sparsity}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00321}00321\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_sparse\_num\_jac(fun,\ t,\ y,\ f,\ h,\ factor,\ y\_scale,}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00322}00322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ structure,\ groups)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00323}00323\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00324}00324\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00325}00325\ \textcolor{keyword}{def\ }\_dense\_num\_jac(fun,\ t,\ y,\ f,\ h,\ factor,\ y\_scale):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00326}00326\ \ \ \ \ n\ =\ y.shape[0]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00327}00327\ \ \ \ \ h\_vecs\ =\ np.diag(h)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00328}00328\ \ \ \ \ f\_new\ =\ fun(t,\ y[:,\ \textcolor{keywordtype}{None}]\ +\ h\_vecs)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00329}00329\ \ \ \ \ diff\ =\ f\_new\ -\/\ f[:,\ \textcolor{keywordtype}{None}]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00330}00330\ \ \ \ \ max\_ind\ =\ np.argmax(np.abs(diff),\ axis=0)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00331}00331\ \ \ \ \ r\ =\ np.arange(n)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00332}00332\ \ \ \ \ max\_diff\ =\ np.abs(diff[max\_ind,\ r])}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00333}00333\ \ \ \ \ scale\ =\ np.maximum(np.abs(f[max\_ind]),\ np.abs(f\_new[max\_ind,\ r]))}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00334}00334\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00335}00335\ \ \ \ \ diff\_too\_small\ =\ max\_diff\ <\ NUM\_JAC\_DIFF\_REJECT\ *\ scale}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00336}00336\ \ \ \ \ \textcolor{keywordflow}{if}\ np.any(diff\_too\_small):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00337}00337\ \ \ \ \ \ \ \ \ ind,\ =\ np.nonzero(diff\_too\_small)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00338}00338\ \ \ \ \ \ \ \ \ new\_factor\ =\ NUM\_JAC\_FACTOR\_INCREASE\ *\ factor[ind]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00339}00339\ \ \ \ \ \ \ \ \ h\_new\ =\ (y[ind]\ +\ new\_factor\ *\ y\_scale[ind])\ -\/\ y[ind]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00340}00340\ \ \ \ \ \ \ \ \ h\_vecs[ind,\ ind]\ =\ h\_new}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00341}00341\ \ \ \ \ \ \ \ \ f\_new\ =\ fun(t,\ y[:,\ \textcolor{keywordtype}{None}]\ +\ h\_vecs[:,\ ind])}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00342}00342\ \ \ \ \ \ \ \ \ diff\_new\ =\ f\_new\ -\/\ f[:,\ \textcolor{keywordtype}{None}]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00343}00343\ \ \ \ \ \ \ \ \ max\_ind\ =\ np.argmax(np.abs(diff\_new),\ axis=0)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00344}00344\ \ \ \ \ \ \ \ \ r\ =\ np.arange(ind.shape[0])}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00345}00345\ \ \ \ \ \ \ \ \ max\_diff\_new\ =\ np.abs(diff\_new[max\_ind,\ r])}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00346}00346\ \ \ \ \ \ \ \ \ scale\_new\ =\ np.maximum(np.abs(f[max\_ind]),\ np.abs(f\_new[max\_ind,\ r]))}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00347}00347\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00348}00348\ \ \ \ \ \ \ \ \ update\ =\ max\_diff[ind]\ *\ scale\_new\ <\ max\_diff\_new\ *\ scale[ind]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00349}00349\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ np.any(update):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00350}00350\ \ \ \ \ \ \ \ \ \ \ \ \ update,\ =\ np.nonzero(update)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00351}00351\ \ \ \ \ \ \ \ \ \ \ \ \ update\_ind\ =\ ind[update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00352}00352\ \ \ \ \ \ \ \ \ \ \ \ \ factor[update\_ind]\ =\ new\_factor[update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00353}00353\ \ \ \ \ \ \ \ \ \ \ \ \ h[update\_ind]\ =\ h\_new[update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00354}00354\ \ \ \ \ \ \ \ \ \ \ \ \ diff[:,\ update\_ind]\ =\ diff\_new[:,\ update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00355}00355\ \ \ \ \ \ \ \ \ \ \ \ \ scale[update\_ind]\ =\ scale\_new[update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00356}00356\ \ \ \ \ \ \ \ \ \ \ \ \ max\_diff[update\_ind]\ =\ max\_diff\_new[update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00357}00357\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00358}00358\ \ \ \ \ diff\ /=\ h}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00359}00359\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00360}00360\ \ \ \ \ factor[max\_diff\ <\ NUM\_JAC\_DIFF\_SMALL\ *\ scale]\ *=\ NUM\_JAC\_FACTOR\_INCREASE}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00361}00361\ \ \ \ \ factor[max\_diff\ >\ NUM\_JAC\_DIFF\_BIG\ *\ scale]\ *=\ NUM\_JAC\_FACTOR\_DECREASE}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00362}00362\ \ \ \ \ factor\ =\ np.maximum(factor,\ NUM\_JAC\_MIN\_FACTOR)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00363}00363\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00364}00364\ \ \ \ \ \textcolor{keywordflow}{return}\ diff,\ factor}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00365}00365\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00366}00366\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00367}00367\ \textcolor{keyword}{def\ }\_sparse\_num\_jac(fun,\ t,\ y,\ f,\ h,\ factor,\ y\_scale,\ structure,\ groups):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00368}00368\ \ \ \ \ n\ =\ y.shape[0]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00369}00369\ \ \ \ \ n\_groups\ =\ np.max(groups)\ +\ 1}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00370}00370\ \ \ \ \ h\_vecs\ =\ np.empty((n\_groups,\ n))}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00371}00371\ \ \ \ \ \textcolor{keywordflow}{for}\ group\ \textcolor{keywordflow}{in}\ range(n\_groups):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00372}00372\ \ \ \ \ \ \ \ \ e\ =\ np.equal(group,\ groups)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00373}00373\ \ \ \ \ \ \ \ \ h\_vecs[group]\ =\ h\ *\ e}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00374}00374\ \ \ \ \ h\_vecs\ =\ h\_vecs.T}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00375}00375\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00376}00376\ \ \ \ \ f\_new\ =\ fun(t,\ y[:,\ \textcolor{keywordtype}{None}]\ +\ h\_vecs)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00377}00377\ \ \ \ \ df\ =\ f\_new\ -\/\ f[:,\ \textcolor{keywordtype}{None}]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00378}00378\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00379}00379\ \ \ \ \ i,\ j,\ \_\ =\ find(structure)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00380}00380\ \ \ \ \ diff\ =\ \mbox{\hyperlink{classscipy_1_1sparse_1_1__coo_1_1coo__matrix}{coo\_matrix}}((df[i,\ groups[j]],\ (i,\ j)),\ shape=(n,\ n)).tocsc()}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00381}00381\ \ \ \ \ max\_ind\ =\ np.array(abs(diff).argmax(axis=0)).ravel()}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00382}00382\ \ \ \ \ r\ =\ np.arange(n)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00383}00383\ \ \ \ \ max\_diff\ =\ np.asarray(np.abs(diff[max\_ind,\ r])).ravel()}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00384}00384\ \ \ \ \ scale\ =\ np.maximum(np.abs(f[max\_ind]),}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00385}00385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ np.abs(f\_new[max\_ind,\ groups[r]]))}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00386}00386\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00387}00387\ \ \ \ \ diff\_too\_small\ =\ max\_diff\ <\ NUM\_JAC\_DIFF\_REJECT\ *\ scale}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00388}00388\ \ \ \ \ \textcolor{keywordflow}{if}\ np.any(diff\_too\_small):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00389}00389\ \ \ \ \ \ \ \ \ ind,\ =\ np.nonzero(diff\_too\_small)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00390}00390\ \ \ \ \ \ \ \ \ new\_factor\ =\ NUM\_JAC\_FACTOR\_INCREASE\ *\ factor[ind]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00391}00391\ \ \ \ \ \ \ \ \ h\_new\ =\ (y[ind]\ +\ new\_factor\ *\ y\_scale[ind])\ -\/\ y[ind]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00392}00392\ \ \ \ \ \ \ \ \ h\_new\_all\ =\ np.zeros(n)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00393}00393\ \ \ \ \ \ \ \ \ h\_new\_all[ind]\ =\ h\_new}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00394}00394\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00395}00395\ \ \ \ \ \ \ \ \ groups\_unique\ =\ np.unique(groups[ind])}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00396}00396\ \ \ \ \ \ \ \ \ groups\_map\ =\ np.empty(n\_groups,\ dtype=int)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00397}00397\ \ \ \ \ \ \ \ \ h\_vecs\ =\ np.empty((groups\_unique.shape[0],\ n))}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00398}00398\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ k,\ group\ \textcolor{keywordflow}{in}\ enumerate(groups\_unique):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00399}00399\ \ \ \ \ \ \ \ \ \ \ \ \ e\ =\ np.equal(group,\ groups)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00400}00400\ \ \ \ \ \ \ \ \ \ \ \ \ h\_vecs[k]\ =\ h\_new\_all\ *\ e}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00401}00401\ \ \ \ \ \ \ \ \ \ \ \ \ groups\_map[group]\ =\ k}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00402}00402\ \ \ \ \ \ \ \ \ h\_vecs\ =\ h\_vecs.T}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00403}00403\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00404}00404\ \ \ \ \ \ \ \ \ f\_new\ =\ fun(t,\ y[:,\ \textcolor{keywordtype}{None}]\ +\ h\_vecs)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00405}00405\ \ \ \ \ \ \ \ \ df\ =\ f\_new\ -\/\ f[:,\ \textcolor{keywordtype}{None}]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00406}00406\ \ \ \ \ \ \ \ \ i,\ j,\ \_\ =\ find(structure[:,\ ind])}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00407}00407\ \ \ \ \ \ \ \ \ diff\_new\ =\ \mbox{\hyperlink{classscipy_1_1sparse_1_1__coo_1_1coo__matrix}{coo\_matrix}}((df[i,\ groups\_map[groups[ind[j]]]],}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00408}00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (i,\ j)),\ shape=(n,\ ind.shape[0])).tocsc()}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00409}00409\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00410}00410\ \ \ \ \ \ \ \ \ max\_ind\_new\ =\ np.array(abs(diff\_new).argmax(axis=0)).ravel()}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00411}00411\ \ \ \ \ \ \ \ \ r\ =\ np.arange(ind.shape[0])}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00412}00412\ \ \ \ \ \ \ \ \ max\_diff\_new\ =\ np.asarray(np.abs(diff\_new[max\_ind\_new,\ r])).ravel()}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00413}00413\ \ \ \ \ \ \ \ \ scale\_new\ =\ np.maximum(}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \ \ \ np.abs(f[max\_ind\_new]),}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00415}00415\ \ \ \ \ \ \ \ \ \ \ \ \ np.abs(f\_new[max\_ind\_new,\ groups\_map[groups[ind]]]))}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00416}00416\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00417}00417\ \ \ \ \ \ \ \ \ update\ =\ max\_diff[ind]\ *\ scale\_new\ <\ max\_diff\_new\ *\ scale[ind]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00418}00418\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ np.any(update):}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00419}00419\ \ \ \ \ \ \ \ \ \ \ \ \ update,\ =\ np.nonzero(update)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00420}00420\ \ \ \ \ \ \ \ \ \ \ \ \ update\_ind\ =\ ind[update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00421}00421\ \ \ \ \ \ \ \ \ \ \ \ \ factor[update\_ind]\ =\ new\_factor[update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00422}00422\ \ \ \ \ \ \ \ \ \ \ \ \ h[update\_ind]\ =\ h\_new[update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00423}00423\ \ \ \ \ \ \ \ \ \ \ \ \ diff[:,\ update\_ind]\ =\ diff\_new[:,\ update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00424}00424\ \ \ \ \ \ \ \ \ \ \ \ \ scale[update\_ind]\ =\ scale\_new[update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00425}00425\ \ \ \ \ \ \ \ \ \ \ \ \ max\_diff[update\_ind]\ =\ max\_diff\_new[update]}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00426}00426\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00427}00427\ \ \ \ \ diff.data\ /=\ np.repeat(h,\ np.diff(diff.indptr))}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00428}00428\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00429}00429\ \ \ \ \ factor[max\_diff\ <\ NUM\_JAC\_DIFF\_SMALL\ *\ scale]\ *=\ NUM\_JAC\_FACTOR\_INCREASE}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00430}00430\ \ \ \ \ factor[max\_diff\ >\ NUM\_JAC\_DIFF\_BIG\ *\ scale]\ *=\ NUM\_JAC\_FACTOR\_DECREASE}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00431}00431\ \ \ \ \ factor\ =\ np.maximum(factor,\ NUM\_JAC\_MIN\_FACTOR)}
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00432}00432\ }
\DoxyCodeLine{\Hypertarget{scipy_2integrate_2__ivp_2common_8py_source_l00433}00433\ \ \ \ \ \textcolor{keywordflow}{return}\ diff,\ factor}

\end{DoxyCode}
