\doxysection{test\+\_\+strings.\+py}
\hypertarget{numpy_2core_2tests_2test__strings_8py_source}{}\label{numpy_2core_2tests_2test__strings_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/numpy/core/tests/test\_strings.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/numpy/core/tests/test\_strings.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00001}\mbox{\hyperlink{namespacenumpy_1_1core_1_1tests_1_1test__strings}{00001}}\ \textcolor{keyword}{import}\ pytest}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00003}00003\ \textcolor{keyword}{import}\ operator}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00004}00004\ \textcolor{keyword}{import}\ numpy\ \textcolor{keyword}{as}\ np}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00006}00006\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacenumpy_1_1testing}{numpy.testing}}\ \textcolor{keyword}{import}\ assert\_array\_equal}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00008}00008\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00009}00009\ COMPARISONS\ =\ [}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00010}00010\ \ \ \ \ (operator.eq,\ np.equal,\ \textcolor{stringliteral}{"{}=="{}}),}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00011}00011\ \ \ \ \ (operator.ne,\ np.not\_equal,\ \textcolor{stringliteral}{"{}!="{}}),}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00012}00012\ \ \ \ \ (operator.lt,\ np.less,\ \textcolor{stringliteral}{"{}<"{}}),}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00013}00013\ \ \ \ \ (operator.le,\ np.less\_equal,\ \textcolor{stringliteral}{"{}<="{}}),}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00014}00014\ \ \ \ \ (operator.gt,\ np.greater,\ \textcolor{stringliteral}{"{}>"{}}),}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00015}00015\ \ \ \ \ (operator.ge,\ np.greater\_equal,\ \textcolor{stringliteral}{"{}>="{}}),}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00016}00016\ ]}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00019}00019\ \textcolor{preprocessor}{@pytest.mark.parametrize(["{}op"{},\ "{}ufunc"{},\ "{}sym"{}],\ COMPARISONS)}}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00020}00020\ \textcolor{keyword}{def\ }test\_mixed\_string\_comparison\_ufuncs\_fail(op,\ ufunc,\ sym):}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00021}00021\ \ \ \ \ arr\_string\ =\ np.array([\textcolor{stringliteral}{"{}a"{}},\ \textcolor{stringliteral}{"{}b"{}}],\ dtype=\textcolor{stringliteral}{"{}S"{}})}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00022}00022\ \ \ \ \ arr\_unicode\ =\ np.array([\textcolor{stringliteral}{"{}a"{}},\ \textcolor{stringliteral}{"{}c"{}}],\ dtype=\textcolor{stringliteral}{"{}U"{}})}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00023}00023\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00024}00024\ \ \ \ \ \textcolor{keyword}{with}\ pytest.raises(TypeError,\ match=\textcolor{stringliteral}{"{}did\ not\ contain\ a\ loop"{}}):}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00025}00025\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structufunc}{ufunc}}(arr\_string,\ arr\_unicode)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00027}00027\ \ \ \ \ \textcolor{keyword}{with}\ pytest.raises(TypeError,\ match=\textcolor{stringliteral}{"{}did\ not\ contain\ a\ loop"{}}):}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00028}00028\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structufunc}{ufunc}}(arr\_unicode,\ arr\_string)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00029}00029\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00030}00030\ \textcolor{preprocessor}{@pytest.mark.parametrize(["{}op"{},\ "{}ufunc"{},\ "{}sym"{}],\ COMPARISONS)}}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00031}00031\ \textcolor{keyword}{def\ }test\_mixed\_string\_comparisons\_ufuncs\_with\_cast(op,\ ufunc,\ sym):}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00032}00032\ \ \ \ \ arr\_string\ =\ np.array([\textcolor{stringliteral}{"{}a"{}},\ \textcolor{stringliteral}{"{}b"{}}],\ dtype=\textcolor{stringliteral}{"{}S"{}})}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00033}00033\ \ \ \ \ arr\_unicode\ =\ np.array([\textcolor{stringliteral}{"{}a"{}},\ \textcolor{stringliteral}{"{}c"{}}],\ dtype=\textcolor{stringliteral}{"{}U"{}})}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00035}00035\ \ \ \ \ \textcolor{comment}{\#\ While\ there\ is\ no\ loop,\ manual\ casting\ is\ acceptable:}}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00036}00036\ \ \ \ \ res1\ =\ \mbox{\hyperlink{structufunc}{ufunc}}(arr\_string,\ arr\_unicode,\ signature=\textcolor{stringliteral}{"{}UU-\/>?"{}},\ casting=\textcolor{stringliteral}{"{}unsafe"{}})}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00037}00037\ \ \ \ \ res2\ =\ \mbox{\hyperlink{structufunc}{ufunc}}(arr\_string,\ arr\_unicode,\ signature=\textcolor{stringliteral}{"{}SS-\/>?"{}},\ casting=\textcolor{stringliteral}{"{}unsafe"{}})}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00039}00039\ \ \ \ \ expected\ =\ op(arr\_string.astype(\textcolor{stringliteral}{'U'}),\ arr\_unicode)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00040}00040\ \ \ \ \ assert\_array\_equal(res1,\ expected)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00041}00041\ \ \ \ \ assert\_array\_equal(res2,\ expected)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00043}00043\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00044}00044\ \textcolor{preprocessor}{@pytest.mark.parametrize(["{}op"{},\ "{}ufunc"{},\ "{}sym"{}],\ COMPARISONS)}}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00045}00045\ \textcolor{preprocessor}{@pytest.mark.parametrize}(\textcolor{stringliteral}{"{}dtypes"{}},\ [}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00046}00046\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}S2"{}},\ \textcolor{stringliteral}{"{}S2"{}}),\ (\textcolor{stringliteral}{"{}S2"{}},\ \textcolor{stringliteral}{"{}S10"{}}),}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00047}00047\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}<U1"{}},\ \textcolor{stringliteral}{"{}<U1"{}}),\ (\textcolor{stringliteral}{"{}<U1"{}},\ \textcolor{stringliteral}{"{}>U1"{}}),\ (\textcolor{stringliteral}{"{}>U1"{}},\ \textcolor{stringliteral}{"{}>U1"{}}),}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}<U1"{}},\ \textcolor{stringliteral}{"{}<U10"{}}),\ (\textcolor{stringliteral}{"{}<U1"{}},\ \textcolor{stringliteral}{"{}>U10"{}})])}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00049}00049\ \textcolor{preprocessor}{@pytest.mark.parametrize("{}aligned"{},\ [True,\ False])}}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00050}00050\ \textcolor{keyword}{def\ }test\_string\_comparisons(op,\ ufunc,\ sym,\ dtypes,\ aligned):}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00051}00051\ \ \ \ \ \textcolor{comment}{\#\ ensure\ native\ byte-\/order\ for\ the\ first\ view\ to\ stay\ within\ unicode\ range}}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00052}00052\ \ \ \ \ native\_dt\ =\ np.dtype(dtypes[0]).newbyteorder(\textcolor{stringliteral}{"{}="{}})}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00053}00053\ \ \ \ \ arr\ =\ np.arange(2**15).view(native\_dt).astype(dtypes[0])}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00054}00054\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ aligned:}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Make\ \`{}arr`\ unaligned:}}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ new\ =\ np.zeros(arr.nbytes\ +\ 1,\ dtype=np.uint8)[1:].view(dtypes[0])}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00057}00057\ \ \ \ \ \ \ \ \ new[...]\ =\ arr}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00058}00058\ \ \ \ \ \ \ \ \ arr\ =\ new}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00060}00060\ \ \ \ \ arr2\ =\ arr.astype(dtypes[1],\ copy=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00061}00061\ \ \ \ \ np.random.shuffle(arr2)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00062}00062\ \ \ \ \ arr[0]\ =\ arr2[0]\ \ \textcolor{comment}{\#\ make\ sure\ one\ matches}}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00064}00064\ \ \ \ \ expected\ =\ [op(d1,\ d2)\ \textcolor{keywordflow}{for}\ d1,\ d2\ \textcolor{keywordflow}{in}\ zip(arr.tolist(),\ arr2.tolist())]}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00065}00065\ \ \ \ \ assert\_array\_equal(op(arr,\ arr2),\ expected)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00066}00066\ \ \ \ \ assert\_array\_equal(\mbox{\hyperlink{structufunc}{ufunc}}(arr,\ arr2),\ expected)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00067}00067\ \ \ \ \ assert\_array\_equal(np.compare\_chararrays(arr,\ arr2,\ sym,\ \textcolor{keyword}{False}),\ expected)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00068}00068\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00069}00069\ \ \ \ \ expected\ =\ [op(d2,\ d1)\ \textcolor{keywordflow}{for}\ d1,\ d2\ \textcolor{keywordflow}{in}\ zip(arr.tolist(),\ arr2.tolist())]}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00070}00070\ \ \ \ \ assert\_array\_equal(op(arr2,\ arr),\ expected)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00071}00071\ \ \ \ \ assert\_array\_equal(\mbox{\hyperlink{structufunc}{ufunc}}(arr2,\ arr),\ expected)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00072}00072\ \ \ \ \ assert\_array\_equal(np.compare\_chararrays(arr2,\ arr,\ sym,\ \textcolor{keyword}{False}),\ expected)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00073}00073\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00075}00075\ \textcolor{preprocessor}{@pytest.mark.parametrize(["{}op"{},\ "{}ufunc"{},\ "{}sym"{}],\ COMPARISONS)}}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00076}00076\ \textcolor{preprocessor}{@pytest.mark.parametrize}(\textcolor{stringliteral}{"{}dtypes"{}},\ [}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}S2"{}},\ \textcolor{stringliteral}{"{}S2"{}}),\ (\textcolor{stringliteral}{"{}S2"{}},\ \textcolor{stringliteral}{"{}S10"{}}),\ (\textcolor{stringliteral}{"{}<U1"{}},\ \textcolor{stringliteral}{"{}<U1"{}}),\ (\textcolor{stringliteral}{"{}<U1"{}},\ \textcolor{stringliteral}{"{}>U10"{}})])}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00078}00078\ \textcolor{keyword}{def\ }test\_string\_comparisons\_empty(op,\ ufunc,\ sym,\ dtypes):}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00079}00079\ \ \ \ \ arr\ =\ np.empty((1,\ 0,\ 1,\ 5),\ dtype=dtypes[0])}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00080}00080\ \ \ \ \ arr2\ =\ np.empty((100,\ 1,\ 0,\ 1),\ dtype=dtypes[1])}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00081}00081\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00082}00082\ \ \ \ \ expected\ =\ np.empty(np.broadcast\_shapes(arr.shape,\ arr2.shape),\ dtype=bool)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00083}00083\ \ \ \ \ assert\_array\_equal(op(arr,\ arr2),\ expected)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00084}00084\ \ \ \ \ assert\_array\_equal(\mbox{\hyperlink{structufunc}{ufunc}}(arr,\ arr2),\ expected)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00085}00085\ \ \ \ \ assert\_array\_equal(np.compare\_chararrays(arr,\ arr2,\ sym,\ \textcolor{keyword}{False}),\ expected)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00086}00086\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00088}00088\ \textcolor{preprocessor}{@pytest.mark.parametrize("{}str\_dt"{},\ ["{}S"{},\ "{}U"{}])}}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00089}00089\ \textcolor{preprocessor}{@pytest.mark.parametrize("{}float\_dt"{},\ np.typecodes["{}AllFloat"{}])}}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00090}00090\ \textcolor{keyword}{def\ }test\_float\_to\_string\_cast(str\_dt,\ float\_dt):}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00091}00091\ \ \ \ \ float\_dt\ =\ np.dtype(float\_dt)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00092}00092\ \ \ \ \ fi\ =\ np.finfo(float\_dt)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00093}00093\ \ \ \ \ arr\ =\ np.array([np.nan,\ np.inf,\ -\/np.inf,\ fi.max,\ fi.min],\ dtype=float\_dt)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00094}00094\ \ \ \ \ expected\ =\ [\textcolor{stringliteral}{"{}nan"{}},\ \textcolor{stringliteral}{"{}inf"{}},\ \textcolor{stringliteral}{"{}-\/inf"{}},\ repr(fi.max),\ repr(fi.min)]}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00095}00095\ \ \ \ \ \textcolor{keywordflow}{if}\ float\_dt.kind\ ==\ \textcolor{stringliteral}{'c'}:}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00096}00096\ \ \ \ \ \ \ \ \ expected\ =\ [f\textcolor{stringliteral}{"{}(\{r\}+0j)"{}}\ \textcolor{keywordflow}{for}\ r\ \textcolor{keywordflow}{in}\ expected]}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00097}00097\ }
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00098}00098\ \ \ \ \ res\ =\ arr.astype(str\_dt)}
\DoxyCodeLine{\Hypertarget{numpy_2core_2tests_2test__strings_8py_source_l00099}00099\ \ \ \ \ assert\_array\_equal(res,\ np.array(expected,\ dtype=str\_dt))}

\end{DoxyCode}
