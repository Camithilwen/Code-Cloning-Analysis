\doxysection{testing.\+py}
\hypertarget{joblib_2testing_8py_source}{}\label{joblib_2testing_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/joblib/testing.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/joblib/testing.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00001}\mbox{\hyperlink{namespacejoblib_1_1testing}{00001}}\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00002}00002\ \textcolor{stringliteral}{Helper\ for\ testing.}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00003}00003\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00005}00005\ \textcolor{keyword}{import}\ os.path}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00006}00006\ \textcolor{keyword}{import}\ re}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00007}00007\ \textcolor{keyword}{import}\ subprocess}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00008}00008\ \textcolor{keyword}{import}\ sys}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00009}00009\ \textcolor{keyword}{import}\ threading}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00010}00010\ \textcolor{keyword}{import}\ warnings}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00012}00012\ \textcolor{keyword}{import}\ \_pytest}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00013}00013\ \textcolor{keyword}{import}\ pytest}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00015}00015\ raises\ =\ pytest.raises}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00016}00016\ warns\ =\ pytest.warns}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00017}00017\ SkipTest\ =\ \_pytest.runner.Skipped}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00018}00018\ skipif\ =\ pytest.mark.skipif}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00019}00019\ fixture\ =\ pytest.fixture}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00020}00020\ parametrize\ =\ pytest.mark.parametrize}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00021}00021\ timeout\ =\ pytest.mark.timeout}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00022}00022\ xfail\ =\ pytest.mark.xfail}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00023}00023\ param\ =\ pytest.param}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00025}00025\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00026}\mbox{\hyperlink{namespacejoblib_1_1testing_ab9b814ad60e3a5c7215c53deab7478a5}{00026}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacejoblib_1_1testing_ab9b814ad60e3a5c7215c53deab7478a5}{warnings\_to\_stdout}}():}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00027}00027\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Redirect\ all\ warnings\ to\ stdout."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00028}00028\ \ \ \ \ showwarning\_orig\ =\ warnings.showwarning}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00029}00029\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00030}00030\ \ \ \ \ \textcolor{keyword}{def\ }showwarning(msg,\ cat,\ fname,\ lno,\ file=None,\ line=0):}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00031}00031\ \ \ \ \ \ \ \ \ showwarning\_orig(msg,\ cat,\ os.path.basename(fname),\ line,\ sys.stdout)}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00033}00033\ \ \ \ \ warnings.showwarning\ =\ showwarning}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00034}00034\ \ \ \ \ \textcolor{comment}{\#\ warnings.simplefilter('always')}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00037}\mbox{\hyperlink{namespacejoblib_1_1testing_a126a623d7fb6cdf8155bde46f33316eb}{00037}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacejoblib_1_1testing_a126a623d7fb6cdf8155bde46f33316eb}{check\_subprocess\_call}}(cmd,\ timeout=5,\ stdout\_regex=None,\ stderr\_regex=None):}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00038}00038\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Runs\ a\ command\ in\ a\ subprocess\ with\ timeout\ in\ seconds.}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00039}00039\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00040}00040\ \textcolor{stringliteral}{\ \ \ \ A\ SIGTERM\ is\ sent\ after\ \`{}timeout\`{}\ and\ if\ it\ does\ not\ terminate,\ a}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00041}00041\ \textcolor{stringliteral}{\ \ \ \ SIGKILL\ is\ sent\ after\ \`{}2\ *\ timeout\`{}.}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00042}00042\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00043}00043\ \textcolor{stringliteral}{\ \ \ \ Also\ checks\ returncode\ is\ zero,\ stdout\ if\ stdout\_regex\ is\ set,\ and}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00044}00044\ \textcolor{stringliteral}{\ \ \ \ stderr\ if\ stderr\_regex\ is\ set.}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00045}00045\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00046}00046\ \ \ \ \ proc\ =\ subprocess.Popen(cmd,\ stdout=subprocess.PIPE,\ stderr=subprocess.PIPE)}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00047}00047\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00048}00048\ \ \ \ \ \textcolor{keyword}{def\ }terminate\_process():\ \ \textcolor{comment}{\#\ pragma:\ no\ cover}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00050}00050\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Attempt\ to\ terminate\ a\ leftover\ process\ spawned\ during\ test\ execution:}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00051}00051\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ ideally\ this\ should\ not\ be\ needed\ but\ can\ help\ avoid\ clogging\ the\ CI}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00052}00052\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ workers\ in\ case\ of\ deadlocks.}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00053}00053\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00054}00054\ \ \ \ \ \ \ \ \ warnings.warn(f\textcolor{stringliteral}{"{}Timeout\ running\ \{cmd\}"{}})}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ proc.terminate()}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00057}00057\ \ \ \ \ \textcolor{keyword}{def\ }kill\_process():\ \ \textcolor{comment}{\#\ pragma:\ no\ cover}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00058}00058\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00059}00059\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Kill\ a\ leftover\ process\ spawned\ during\ test\ execution:\ ideally\ this}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00060}00060\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ should\ not\ be\ needed\ but\ can\ help\ avoid\ clogging\ the\ CI\ workers\ in}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00061}00061\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ case\ of\ deadlocks.}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00062}00062\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00063}00063\ \ \ \ \ \ \ \ \ warnings.warn(f\textcolor{stringliteral}{"{}Timeout\ running\ \{cmd\}"{}})}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00064}00064\ \ \ \ \ \ \ \ \ proc.kill()}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00066}00066\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ timeout\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ terminate\_timer\ =\ threading.Timer(timeout,\ terminate\_process)}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00069}00069\ \ \ \ \ \ \ \ \ \ \ \ \ terminate\_timer.start()}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ kill\_timer\ =\ threading.Timer(2\ *\ timeout,\ kill\_process)}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ kill\_timer.start()}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00072}00072\ \ \ \ \ \ \ \ \ stdout,\ stderr\ =\ proc.communicate()}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00073}00073\ \ \ \ \ \ \ \ \ stdout,\ stderr\ =\ stdout.decode(),\ stderr.decode()}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00074}00074\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ proc.returncode\ !=\ 0:}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ message\ =\ (\textcolor{stringliteral}{"{}Non-\/zero\ return\ code:\ \{\}.\(\backslash\)nStdout:\(\backslash\)n\{\}\(\backslash\)nStderr:\(\backslash\)n\{\}"{}}).format(}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ proc.returncode,\ stdout,\ stderr}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classValueError}{ValueError}}(message)}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00079}00079\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00080}00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ stdout\_regex\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ re.search(stdout\_regex,\ stdout):}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classValueError}{ValueError}}(}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Unexpected\ stdout:\ \{!r\}\ does\ not\ match:\(\backslash\)n\{!r\}"{}}.format(}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stdout\_regex,\ stdout}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00086}00086\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ stderr\_regex\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ re.search(stderr\_regex,\ stderr):}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classValueError}{ValueError}}(}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Unexpected\ stderr:\ \{!r\}\ does\ not\ match:\(\backslash\)n\{!r\}"{}}.format(}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stderr\_regex,\ stderr}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00092}00092\ }
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00093}00093\ \ \ \ \ \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00094}00094\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ timeout\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \ \ \ terminate\_timer.cancel()}
\DoxyCodeLine{\Hypertarget{joblib_2testing_8py_source_l00096}00096\ \ \ \ \ \ \ \ \ \ \ \ \ kill\_timer.cancel()}

\end{DoxyCode}
