\doxysection{test\+\_\+compare\+\_\+images.\+py}
\hypertarget{test__compare__images_8py_source}{}\label{test__compare__images_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/matplotlib/tests/test\_compare\_images.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/matplotlib/tests/test\_compare\_images.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00001}\mbox{\hyperlink{namespacematplotlib_1_1tests_1_1test__compare__images}{00001}}\ \textcolor{keyword}{from}\ pathlib\ \textcolor{keyword}{import}\ Path}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00002}00002\ \textcolor{keyword}{import}\ shutil}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00004}00004\ \textcolor{keyword}{import}\ pytest}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00005}00005\ \textcolor{keyword}{from}\ pytest\ \textcolor{keyword}{import}\ approx}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00007}00007\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacematplotlib_1_1testing_1_1compare}{matplotlib.testing.compare}}\ \textcolor{keyword}{import}\ compare\_images}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00008}00008\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacematplotlib_1_1testing_1_1decorators}{matplotlib.testing.decorators}}\ \textcolor{keyword}{import}\ \_image\_directories}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00010}00010\ }
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00011}00011\ \textcolor{comment}{\#\ Tests\ of\ the\ image\ comparison\ algorithm.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00012}00012\ \textcolor{preprocessor}{@pytest.mark.parametrize}(}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00013}00013\ \ \ \ \ \textcolor{stringliteral}{'im1,\ im2,\ tol,\ expect\_rms'},}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00014}00014\ \ \ \ \ [}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00015}00015\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Comparison\ of\ an\ image\ and\ the\ same\ image\ with\ minor\ differences.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00016}00016\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ This\ expects\ the\ images\ to\ compare\ equal\ under\ normal\ tolerance,\ and}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00017}00017\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ have\ a\ small\ RMS.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00018}00018\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{'basn3p02.png'},\ \textcolor{stringliteral}{'basn3p02-\/minorchange.png'},\ 10,\ \textcolor{keywordtype}{None}),}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00019}00019\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Now\ test\ with\ no\ tolerance.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00020}00020\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{'basn3p02.png'},\ \textcolor{stringliteral}{'basn3p02-\/minorchange.png'},\ 0,\ 6.50646),}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00021}00021\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Comparison\ with\ an\ image\ that\ is\ shifted\ by\ 1px\ in\ the\ X\ axis.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00022}00022\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{'basn3p02.png'},\ \textcolor{stringliteral}{'basn3p02-\/1px-\/offset.png'},\ 0,\ 90.15611),}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00023}00023\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Comparison\ with\ an\ image\ with\ half\ the\ pixels\ shifted\ by\ 1px\ in\ the\ X}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00024}00024\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ axis.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00025}00025\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{'basn3p02.png'},\ \textcolor{stringliteral}{'basn3p02-\/half-\/1px-\/offset.png'},\ 0,\ 63.75),}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00026}00026\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Comparison\ of\ an\ image\ and\ the\ same\ image\ scrambled.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00027}00027\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ This\ expects\ the\ images\ to\ compare\ completely\ different,\ with\ a\ very}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00028}00028\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ large\ RMS.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00029}00029\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Note:\ The\ image\ has\ been\ scrambled\ in\ a\ specific\ way,\ by\ having}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00030}00030\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ each\ color\ component\ of\ each\ pixel\ randomly\ placed\ somewhere\ in\ the}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00031}00031\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ image.\ It\ contains\ exactly\ the\ same\ number\ of\ pixels\ of\ each\ color}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00032}00032\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ value\ of\ R,\ G\ and\ B,\ but\ in\ a\ totally\ different\ position.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00033}00033\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Test\ with\ no\ tolerance\ to\ make\ sure\ that\ we\ pick\ up\ even\ a\ very\ small}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00034}00034\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ RMS\ error.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00035}00035\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{'basn3p02.png'},\ \textcolor{stringliteral}{'basn3p02-\/scrambled.png'},\ 0,\ 172.63582),}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00036}00036\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Comparison\ of\ an\ image\ and\ a\ slightly\ brighter\ image.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00037}00037\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ The\ two\ images\ are\ solid\ color,\ with\ the\ second\ image\ being\ exactly\ 1}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00038}00038\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ color\ value\ brighter.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00039}00039\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ This\ expects\ the\ images\ to\ compare\ equal\ under\ normal\ tolerance,\ and}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00040}00040\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ have\ an\ RMS\ of\ exactly\ 1.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00041}00041\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{'all127.png'},\ \textcolor{stringliteral}{'all128.png'},\ 0,\ 1),}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00042}00042\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Now\ test\ the\ reverse\ comparison.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00043}00043\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{'all128.png'},\ \textcolor{stringliteral}{'all127.png'},\ 0,\ 1),}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00044}00044\ \ \ \ \ ])}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00045}\mbox{\hyperlink{namespacematplotlib_1_1tests_1_1test__compare__images_a89b374ef787cea388205ccebf7b8a255}{00045}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacematplotlib_1_1tests_1_1test__compare__images_a89b374ef787cea388205ccebf7b8a255}{test\_image\_comparison\_expect\_rms}}(im1,\ im2,\ tol,\ expect\_rms,\ tmp\_path,}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00046}00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ monkeypatch):}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00047}00047\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00048}00048\ \textcolor{stringliteral}{\ \ \ \ Compare\ two\ images,\ expecting\ a\ particular\ RMS\ error.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00049}00049\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00050}00050\ \textcolor{stringliteral}{\ \ \ \ im1\ and\ im2\ are\ filenames\ relative\ to\ the\ baseline\_dir\ directory.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00051}00051\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00052}00052\ \textcolor{stringliteral}{\ \ \ \ tol\ is\ the\ tolerance\ to\ pass\ to\ compare\_images.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00053}00053\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00054}00054\ \textcolor{stringliteral}{\ \ \ \ expect\_rms\ is\ the\ expected\ RMS\ value,\ or\ None.\ If\ None,\ the\ test\ will}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00055}00055\ \textcolor{stringliteral}{\ \ \ \ succeed\ if\ compare\_images\ succeeds.\ Otherwise,\ the\ test\ will\ succeed\ if}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00056}00056\ \textcolor{stringliteral}{\ \ \ \ compare\_images\ fails\ and\ returns\ an\ RMS\ error\ almost\ equal\ to\ this\ value.}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00057}00057\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00058}00058\ \ \ \ \ \textcolor{comment}{\#\ Change\ the\ working\ directory\ using\ monkeypatch\ to\ use\ a\ temporary}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00059}00059\ \ \ \ \ \textcolor{comment}{\#\ test\ specific\ directory}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00060}00060\ \ \ \ \ monkeypatch.chdir(tmp\_path)}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00061}00061\ \ \ \ \ baseline\_dir,\ result\_dir\ =\ map(Path,\ \_image\_directories(\textcolor{keyword}{lambda}:\ \textcolor{stringliteral}{"{}dummy"{}}))}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00062}00062\ \ \ \ \ \textcolor{comment}{\#\ Copy\ "{}test"{}\ image\ to\ result\_dir,\ so\ that\ compare\_images\ writes}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00063}00063\ \ \ \ \ \textcolor{comment}{\#\ the\ diff\ to\ result\_dir,\ rather\ than\ to\ the\ source\ tree}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00064}00064\ \ \ \ \ result\_im2\ =\ result\_dir\ /\ im1}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00065}00065\ \ \ \ \ shutil.copyfile(baseline\_dir\ /\ im2,\ result\_im2)}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00066}00066\ \ \ \ \ results\ =\ compare\_images(}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ baseline\_dir\ /\ im1,\ result\_im2,\ tol=tol,\ in\_decorator=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00068}00068\ }
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00069}00069\ \ \ \ \ \textcolor{keywordflow}{if}\ expect\_rms\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ results\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00071}00071\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00072}00072\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ results\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{test__compare__images_8py_source_l00073}00073\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ results[\textcolor{stringliteral}{'rms'}]\ ==\ approx(expect\_rms,\ abs=1e-\/4)}

\end{DoxyCode}
