\doxysection{test\+\_\+factor\+\_\+analysis.\+py}
\hypertarget{test__factor__analysis_8py_source}{}\label{test__factor__analysis_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/sklearn/decomposition/tests/test\_factor\_analysis.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/sklearn/decomposition/tests/test\_factor\_analysis.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00001}\mbox{\hyperlink{namespacesklearn_1_1decomposition_1_1tests_1_1test__factor__analysis}{00001}}\ \textcolor{comment}{\#\ Authors:\ The\ scikit-\/learn\ developers}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00002}00002\ \textcolor{comment}{\#\ SPDX-\/License-\/Identifier:\ BSD-\/3-\/Clause}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00004}00004\ \textcolor{keyword}{from}\ itertools\ \textcolor{keyword}{import}\ combinations}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00006}00006\ \textcolor{keyword}{import}\ numpy\ \textcolor{keyword}{as}\ np}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00007}00007\ \textcolor{keyword}{import}\ pytest}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00008}00008\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00009}00009\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacesklearn_1_1decomposition}{sklearn.decomposition}}\ \textcolor{keyword}{import}\ FactorAnalysis}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00010}00010\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacesklearn_1_1decomposition_1_1__factor__analysis}{sklearn.decomposition.\_factor\_analysis}}\ \textcolor{keyword}{import}\ \_ortho\_rotation}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00011}00011\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacesklearn_1_1exceptions}{sklearn.exceptions}}\ \textcolor{keyword}{import}\ ConvergenceWarning}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00012}00012\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacesklearn_1_1utils_1_1__testing}{sklearn.utils.\_testing}}\ \textcolor{keyword}{import}\ assert\_almost\_equal,\ assert\_array\_almost\_equal}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00015}00015\ \textcolor{keyword}{def\ }test\_factor\_analysis(global\_random\_seed):}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00016}00016\ \ \ \ \ \textcolor{comment}{\#\ Test\ FactorAnalysis\ ability\ to\ recover\ the\ data\ covariance\ structure}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00017}00017\ \ \ \ \ rng\ =\ np.random.RandomState(global\_random\_seed)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00018}00018\ \ \ \ \ n\_samples,\ n\_features,\ n\_components\ =\ 20,\ 5,\ 3}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00020}00020\ \ \ \ \ \textcolor{comment}{\#\ Some\ random\ settings\ for\ the\ generative\ model}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00021}00021\ \ \ \ \ W\ =\ rng.randn(n\_components,\ n\_features)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00022}00022\ \ \ \ \ \textcolor{comment}{\#\ latent\ variable\ of\ dim\ 3,\ 20\ of\ it}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00023}00023\ \ \ \ \ h\ =\ rng.randn(n\_samples,\ n\_components)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00024}00024\ \ \ \ \ \textcolor{comment}{\#\ using\ gamma\ to\ model\ different\ noise\ variance}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00025}00025\ \ \ \ \ \textcolor{comment}{\#\ per\ component}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00026}00026\ \ \ \ \ noise\ =\ rng.gamma(1,\ size=n\_features)\ *\ rng.randn(n\_samples,\ n\_features)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00028}00028\ \ \ \ \ \textcolor{comment}{\#\ generate\ observations}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00029}00029\ \ \ \ \ \textcolor{comment}{\#\ wlog,\ mean\ is\ 0}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00030}00030\ \ \ \ \ X\ =\ np.dot(h,\ W)\ +\ noise}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00032}00032\ \ \ \ \ fas\ =\ []}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00033}00033\ \ \ \ \ \textcolor{keywordflow}{for}\ method\ \textcolor{keywordflow}{in}\ [\textcolor{stringliteral}{"{}randomized"{}},\ \textcolor{stringliteral}{"{}lapack"{}}]:}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00034}00034\ \ \ \ \ \ \ \ \ fa\ =\ \mbox{\hyperlink{classsklearn_1_1decomposition_1_1__factor__analysis_1_1FactorAnalysis}{FactorAnalysis}}(n\_components=n\_components,\ svd\_method=method)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00035}00035\ \ \ \ \ \ \ \ \ fa.fit(X)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00036}00036\ \ \ \ \ \ \ \ \ fas.append(fa)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00038}00038\ \ \ \ \ \ \ \ \ X\_t\ =\ fa.transform(X)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00039}00039\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ X\_t.shape\ ==\ (n\_samples,\ n\_components)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00040}00040\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00041}00041\ \ \ \ \ \ \ \ \ assert\_almost\_equal(fa.loglike\_[-\/1],\ fa.score\_samples(X).sum())}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00042}00042\ \ \ \ \ \ \ \ \ assert\_almost\_equal(fa.score\_samples(X).mean(),\ fa.score(X))}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00043}00043\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00044}00044\ \ \ \ \ \ \ \ \ diff\ =\ np.all(np.diff(fa.loglike\_))}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00045}00045\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ diff\ >\ 0.0,\ \textcolor{stringliteral}{"{}Log\ likelihood\ dif\ not\ increase"{}}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00047}00047\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Sample\ Covariance}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ scov\ =\ np.cov(X,\ rowvar=0.0,\ bias=1.0)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00050}00050\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Model\ Covariance}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ mcov\ =\ fa.get\_covariance()}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00052}00052\ \ \ \ \ \ \ \ \ diff\ =\ np.sum(np.abs(scov\ -\/\ mcov))\ /\ W.size}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00053}00053\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ diff\ <\ 0.2,\ \textcolor{stringliteral}{"{}Mean\ absolute\ difference\ is\ \%f"{}}\ \%\ diff}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00054}00054\ \ \ \ \ \ \ \ \ fa\ =\ \mbox{\hyperlink{classsklearn_1_1decomposition_1_1__factor__analysis_1_1FactorAnalysis}{FactorAnalysis}}(}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ n\_components=n\_components,\ noise\_variance\_init=np.ones(n\_features)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00057}00057\ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pytest.raises(ValueError):}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ fa.fit(X[:,\ :2])}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00060}00060\ \ \ \ \ \textcolor{keyword}{def\ }f(x,\ y):}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00061}00061\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ np.abs(getattr(x,\ y))\ \ \textcolor{comment}{\#\ sign\ will\ not\ be\ equal}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00063}00063\ \ \ \ \ fa1,\ fa2\ =\ fas}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00064}00064\ \ \ \ \ \textcolor{keywordflow}{for}\ attr\ \textcolor{keywordflow}{in}\ [\textcolor{stringliteral}{"{}loglike\_"{}},\ \textcolor{stringliteral}{"{}components\_"{}},\ \textcolor{stringliteral}{"{}noise\_variance\_"{}}]:}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00065}00065\ \ \ \ \ \ \ \ \ assert\_almost\_equal(f(fa1,\ attr),\ f(fa2,\ attr))}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00066}00066\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00067}00067\ \ \ \ \ fa1.max\_iter\ =\ 1}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00068}00068\ \ \ \ \ fa1.verbose\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00069}00069\ \ \ \ \ \textcolor{keyword}{with}\ pytest.warns(ConvergenceWarning):}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ fa1.fit(X)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00071}00071\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00072}00072\ \ \ \ \ \textcolor{comment}{\#\ Test\ get\_covariance\ and\ get\_precision\ with\ n\_components\ ==\ n\_features}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00073}00073\ \ \ \ \ \textcolor{comment}{\#\ with\ n\_components\ <\ n\_features\ and\ with\ n\_components\ ==\ 0}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00074}00074\ \ \ \ \ \textcolor{keywordflow}{for}\ n\_components\ \textcolor{keywordflow}{in}\ [0,\ 2,\ X.shape[1]]:}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00075}00075\ \ \ \ \ \ \ \ \ fa.n\_components\ =\ n\_components}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00076}00076\ \ \ \ \ \ \ \ \ fa.fit(X)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ cov\ =\ fa.get\_covariance()}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ precision\ =\ fa.get\_precision()}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00079}00079\ \ \ \ \ \ \ \ \ assert\_array\_almost\_equal(np.dot(cov,\ precision),\ np.eye(X.shape[1]),\ 12)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00081}00081\ \ \ \ \ \textcolor{comment}{\#\ test\ rotation}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00082}00082\ \ \ \ \ n\_components\ =\ 2}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00083}00083\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00084}00084\ \ \ \ \ results,\ projections\ =\ \{\},\ \{\}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00085}00085\ \ \ \ \ \textcolor{keywordflow}{for}\ method\ \textcolor{keywordflow}{in}\ (\textcolor{keywordtype}{None},\ \textcolor{stringliteral}{"{}varimax"{}},\ \textcolor{stringliteral}{"{}quartimax"{}}):}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00086}00086\ \ \ \ \ \ \ \ \ fa\_var\ =\ \mbox{\hyperlink{classsklearn_1_1decomposition_1_1__factor__analysis_1_1FactorAnalysis}{FactorAnalysis}}(n\_components=n\_components,\ rotation=method)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00087}00087\ \ \ \ \ \ \ \ \ results[method]\ =\ fa\_var.fit\_transform(X)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00088}00088\ \ \ \ \ \ \ \ \ projections[method]\ =\ fa\_var.get\_covariance()}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00089}00089\ \ \ \ \ \textcolor{keywordflow}{for}\ rot1,\ rot2\ \textcolor{keywordflow}{in}\ combinations([\textcolor{keywordtype}{None},\ \textcolor{stringliteral}{"{}varimax"{}},\ \textcolor{stringliteral}{"{}quartimax"{}}],\ 2):}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00090}00090\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ \textcolor{keywordflow}{not}\ np.allclose(results[rot1],\ results[rot2])}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00091}00091\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ np.allclose(projections[rot1],\ projections[rot2],\ atol=3)}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00092}00092\ }
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00093}00093\ \ \ \ \ \textcolor{comment}{\#\ test\ against\ R's\ psych::principal\ with\ rotate="{}varimax"{}}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00094}00094\ \ \ \ \ \textcolor{comment}{\#\ (i.e.,\ the\ values\ below\ stem\ from\ rotating\ the\ components\ in\ R)}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00095}00095\ \ \ \ \ \textcolor{comment}{\#\ R's\ factor\ analysis\ returns\ quite\ different\ values;\ therefore,\ we\ only}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00096}00096\ \ \ \ \ \textcolor{comment}{\#\ test\ the\ rotation\ itself}}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00097}00097\ \ \ \ \ factors\ =\ np.array(}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00098}00098\ \ \ \ \ \ \ \ \ [}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ [0.89421016,\ -\/0.35854928,\ -\/0.27770122,\ 0.03773647],}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ [-\/0.45081822,\ -\/0.89132754,\ 0.0932195,\ -\/0.01787973],}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ [0.99500666,\ -\/0.02031465,\ 0.05426497,\ -\/0.11539407],}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00102}00102\ \ \ \ \ \ \ \ \ \ \ \ \ [0.96822861,\ -\/0.06299656,\ 0.24411001,\ 0.07540887],}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00104}00104\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00105}00105\ \ \ \ \ r\_solution\ =\ np.array(}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00106}00106\ \ \ \ \ \ \ \ \ [[0.962,\ 0.052],\ [-\/0.141,\ 0.989],\ [0.949,\ -\/0.300],\ [0.937,\ -\/0.251]]}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00107}00107\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00108}00108\ \ \ \ \ rotated\ =\ \_ortho\_rotation(factors[:,\ :n\_components],\ method=\textcolor{stringliteral}{"{}varimax"{}}).T}
\DoxyCodeLine{\Hypertarget{test__factor__analysis_8py_source_l00109}00109\ \ \ \ \ assert\_array\_almost\_equal(np.abs(rotated),\ np.abs(r\_solution),\ decimal=3)}

\end{DoxyCode}
