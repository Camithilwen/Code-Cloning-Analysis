\doxysection{test\+\_\+quantile.\+py}
\hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source}{}\label{sklearn_2linear__model_2tests_2test__quantile_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/sklearn/linear\_model/tests/test\_quantile.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/sklearn/linear\_model/tests/test\_quantile.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00001}\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1tests_1_1test__quantile}{00001}}\ \textcolor{comment}{\#\ Authors:\ The\ scikit-\/learn\ developers}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00002}00002\ \textcolor{comment}{\#\ SPDX-\/License-\/Identifier:\ BSD-\/3-\/Clause}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00004}00004\ \textcolor{keyword}{import}\ numpy\ \textcolor{keyword}{as}\ np}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00005}00005\ \textcolor{keyword}{import}\ pytest}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00006}00006\ \textcolor{keyword}{from}\ pytest\ \textcolor{keyword}{import}\ approx}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00007}00007\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacescipy_1_1optimize}{scipy.optimize}}\ \textcolor{keyword}{import}\ minimize}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00008}00008\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00009}00009\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacesklearn_1_1datasets}{sklearn.datasets}}\ \textcolor{keyword}{import}\ make\_regression}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00010}00010\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacesklearn_1_1exceptions}{sklearn.exceptions}}\ \textcolor{keyword}{import}\ ConvergenceWarning}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00011}00011\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacesklearn_1_1linear__model}{sklearn.linear\_model}}\ \textcolor{keyword}{import}\ HuberRegressor,\ QuantileRegressor}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00012}00012\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacesklearn_1_1metrics}{sklearn.metrics}}\ \textcolor{keyword}{import}\ mean\_pinball\_loss}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00013}00013\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacesklearn_1_1utils_1_1__testing}{sklearn.utils.\_testing}}\ \textcolor{keyword}{import}\ assert\_allclose}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00014}00014\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacesklearn_1_1utils_1_1fixes}{sklearn.utils.fixes}}\ \textcolor{keyword}{import}\ (}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00015}00015\ \ \ \ \ COO\_CONTAINERS,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00016}00016\ \ \ \ \ CSC\_CONTAINERS,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00017}00017\ \ \ \ \ CSR\_CONTAINERS,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00018}00018\ \ \ \ \ parse\_version,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00019}00019\ \ \ \ \ sp\_version,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00020}00020\ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00022}00022\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00023}00023\ \textcolor{preprocessor}{@pytest.fixture}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00024}00024\ \textcolor{keyword}{def\ }X\_y\_data():}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00025}00025\ \ \ \ \ X,\ y\ =\ make\_regression(n\_samples=10,\ n\_features=1,\ random\_state=0,\ noise=1)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00026}00026\ \ \ \ \ \textcolor{keywordflow}{return}\ X,\ y}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00029}00029\ \textcolor{preprocessor}{@pytest.mark.skipif}(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00030}00030\ \ \ \ \ parse\_version(sp\_version.base\_version)\ >=\ parse\_version(\textcolor{stringliteral}{"{}1.11"{}}),}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00031}00031\ \ \ \ \ reason=\textcolor{stringliteral}{"{}interior-\/point\ solver\ is\ not\ available\ in\ SciPy\ 1.11"{}},}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00032}00032\ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00033}00033\ \textcolor{preprocessor}{@pytest.mark.parametrize("{}solver"{},\ ["{}interior-\/point"{},\ "{}revised\ simplex"{}])}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00034}00034\ \textcolor{preprocessor}{@pytest.mark.parametrize("{}csc\_container"{},\ CSC\_CONTAINERS)}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00035}00035\ \textcolor{keyword}{def\ }test\_incompatible\_solver\_for\_sparse\_input(X\_y\_data,\ solver,\ csc\_container):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00036}00036\ \ \ \ \ X,\ y\ =\ X\_y\_data}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00037}00037\ \ \ \ \ X\_sparse\ =\ csc\_container(X)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00038}00038\ \ \ \ \ err\_msg\ =\ (}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00039}00039\ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}Solver\ \{solver\}\ does\ not\ support\ sparse\ X.\ Use\ solver\ 'highs'\ for\ example."{}}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00040}00040\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00041}00041\ \ \ \ \ \textcolor{keyword}{with}\ pytest.raises(ValueError,\ match=err\_msg):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00042}00042\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(solver=solver).fit(X\_sparse,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00043}00043\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00045}00045\ \textcolor{preprocessor}{@pytest.mark.parametrize}(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00046}00046\ \ \ \ \ \textcolor{stringliteral}{"{}quantile,\ alpha,\ intercept,\ coef"{}},}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00047}00047\ \ \ \ \ [}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ for\ 50\%\ quantile\ w/o\ regularization,\ any\ slope\ in\ [1,\ 10]\ is\ okay}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ [0.5,\ 0,\ 1,\ \textcolor{keywordtype}{None}],}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00050}00050\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ if\ positive\ error\ costs\ more,\ the\ slope\ is\ maximal}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ [0.51,\ 0,\ 1,\ 10],}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00052}00052\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ if\ negative\ error\ costs\ more,\ the\ slope\ is\ minimal}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00053}00053\ \ \ \ \ \ \ \ \ [0.49,\ 0,\ 1,\ 1],}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00054}00054\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ for\ a\ small\ lasso\ penalty,\ the\ slope\ is\ also\ minimal}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ [0.5,\ 0.01,\ 1,\ 1],}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ for\ a\ large\ lasso\ penalty,\ the\ model\ predicts\ the\ constant\ median}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00057}00057\ \ \ \ \ \ \ \ \ [0.5,\ 100,\ 2,\ 0],}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00058}00058\ \ \ \ \ ],}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00059}00059\ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00060}00060\ \textcolor{keyword}{def\ }test\_quantile\_toy\_example(quantile,\ alpha,\ intercept,\ coef):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00061}00061\ \ \ \ \ \textcolor{comment}{\#\ test\ how\ different\ parameters\ affect\ a\ small\ intuitive\ example}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00062}00062\ \ \ \ \ X\ =\ [[0],\ [1],\ [1]]}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00063}00063\ \ \ \ \ y\ =\ [1,\ 2,\ 11]}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00064}00064\ \ \ \ \ model\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(quantile=quantile,\ alpha=alpha).fit(X,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00065}00065\ \ \ \ \ assert\_allclose(model.intercept\_,\ intercept,\ atol=1e-\/2)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00066}00066\ \ \ \ \ \textcolor{keywordflow}{if}\ coef\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ assert\_allclose(model.coef\_[0],\ coef,\ atol=1e-\/2)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00068}00068\ \ \ \ \ \textcolor{keywordflow}{if}\ alpha\ <\ 100:}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00069}00069\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ model.coef\_[0]\ >=\ 1}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00070}00070\ \ \ \ \ \textcolor{keyword}{assert}\ model.coef\_[0]\ <=\ 10}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00071}00071\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00073}00073\ \textcolor{preprocessor}{@pytest.mark.parametrize("{}fit\_intercept"{},\ [True,\ False])}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00074}00074\ \textcolor{keyword}{def\ }test\_quantile\_equals\_huber\_for\_low\_epsilon(fit\_intercept):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00075}00075\ \ \ \ \ X,\ y\ =\ make\_regression(n\_samples=100,\ n\_features=20,\ random\_state=0,\ noise=1.0)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00076}00076\ \ \ \ \ alpha\ =\ 1e-\/4}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00077}00077\ \ \ \ \ huber\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__huber_1_1HuberRegressor}{HuberRegressor}}(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ epsilon=1\ +\ 1e-\/4,\ alpha=alpha,\ fit\_intercept=fit\_intercept}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00079}00079\ \ \ \ \ ).fit(X,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00080}00080\ \ \ \ \ quant\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(alpha=alpha,\ fit\_intercept=fit\_intercept).fit(X,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00081}00081\ \ \ \ \ assert\_allclose(huber.coef\_,\ quant.coef\_,\ atol=1e-\/1)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00082}00082\ \ \ \ \ \textcolor{keywordflow}{if}\ fit\_intercept:}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00083}00083\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ huber.intercept\_\ ==\ approx(quant.intercept\_,\ abs=1e-\/1)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00084}00084\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ check\ that\ we\ still\ predict\ fraction}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00085}00085\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ np.mean(y\ <\ quant.predict(X))\ ==\ approx(0.5,\ abs=1e-\/1)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00086}00086\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00088}00088\ \textcolor{preprocessor}{@pytest.mark.parametrize("{}q"{},\ [0.5,\ 0.9,\ 0.05])}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00089}00089\ \textcolor{keyword}{def\ }test\_quantile\_estimates\_calibration(q):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00090}00090\ \ \ \ \ \textcolor{comment}{\#\ Test\ that\ model\ estimates\ percentage\ of\ points\ below\ the\ prediction}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00091}00091\ \ \ \ \ X,\ y\ =\ make\_regression(n\_samples=1000,\ n\_features=20,\ random\_state=0,\ noise=1.0)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00092}00092\ \ \ \ \ quant\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(quantile=q,\ alpha=0).fit(X,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00093}00093\ \ \ \ \ \textcolor{keyword}{assert}\ np.mean(y\ <\ quant.predict(X))\ ==\ approx(q,\ abs=1e-\/2)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00094}00094\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00096}00096\ \textcolor{keyword}{def\ }test\_quantile\_sample\_weight():}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00097}00097\ \ \ \ \ \textcolor{comment}{\#\ test\ that\ with\ unequal\ sample\ weights\ we\ still\ estimate\ weighted\ fraction}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00098}00098\ \ \ \ \ n\ =\ 1000}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00099}00099\ \ \ \ \ X,\ y\ =\ make\_regression(n\_samples=n,\ n\_features=5,\ random\_state=0,\ noise=10.0)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00100}00100\ \ \ \ \ weight\ =\ np.ones(n)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00101}00101\ \ \ \ \ \textcolor{comment}{\#\ when\ we\ increase\ weight\ of\ upper\ observations,}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00102}00102\ \ \ \ \ \textcolor{comment}{\#\ estimate\ of\ quantile\ should\ go\ up}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00103}00103\ \ \ \ \ weight[y\ >\ y.mean()]\ =\ 100}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00104}00104\ \ \ \ \ quant\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(quantile=0.5,\ alpha=1e-\/8)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00105}00105\ \ \ \ \ quant.fit(X,\ y,\ sample\_weight=weight)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00106}00106\ \ \ \ \ fraction\_below\ =\ np.mean(y\ <\ quant.predict(X))}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00107}00107\ \ \ \ \ \textcolor{keyword}{assert}\ fraction\_below\ >\ 0.5}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00108}00108\ \ \ \ \ weighted\_fraction\_below\ =\ np.average(y\ <\ quant.predict(X),\ weights=weight)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00109}00109\ \ \ \ \ \textcolor{keyword}{assert}\ weighted\_fraction\_below\ ==\ approx(0.5,\ abs=3e-\/2)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00110}00110\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00111}00111\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00112}00112\ \textcolor{preprocessor}{@pytest.mark.parametrize("{}quantile"{},\ [0.2,\ 0.5,\ 0.8])}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00113}\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1tests_1_1test__quantile_a0d65f69f87e06742712980b55364a00a}{00113}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1tests_1_1test__quantile_a0d65f69f87e06742712980b55364a00a}{test\_asymmetric\_error}}(quantile):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00114}00114\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Test\ quantile\ regression\ for\ asymmetric\ distributed\ targets."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00115}00115\ \ \ \ \ n\_samples\ =\ 1000}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00116}00116\ \ \ \ \ rng\ =\ np.random.RandomState(42)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00117}00117\ \ \ \ \ X\ =\ np.concatenate(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00118}00118\ \ \ \ \ \ \ \ \ (}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00119}00119\ \ \ \ \ \ \ \ \ \ \ \ \ np.abs(rng.randn(n\_samples)[:,\ \textcolor{keywordtype}{None}]),}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00120}00120\ \ \ \ \ \ \ \ \ \ \ \ \ -\/rng.randint(2,\ size=(n\_samples,\ 1)),}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00121}00121\ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00122}00122\ \ \ \ \ \ \ \ \ axis=1,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00123}00123\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00124}00124\ \ \ \ \ intercept\ =\ 1.23}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00125}00125\ \ \ \ \ coef\ =\ np.array([0.5,\ -\/2])}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00126}00126\ \ \ \ \ \textcolor{comment}{\#\ \ Take\ care\ that\ X\ @\ coef\ +\ intercept\ >\ 0}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00127}00127\ \ \ \ \ \textcolor{keyword}{assert}\ np.min(X\ @\ coef\ +\ intercept)\ >\ 0}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00128}00128\ \ \ \ \ \textcolor{comment}{\#\ For\ an\ exponential\ distribution\ with\ rate\ lambda,\ e.g.\ exp(-\/lambda\ *\ x),}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00129}00129\ \ \ \ \ \textcolor{comment}{\#\ the\ quantile\ at\ level\ q\ is:}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00130}00130\ \ \ \ \ \textcolor{comment}{\#\ \ \ quantile(q)\ =\ -\/\ log(1\ -\/\ q)\ /\ lambda}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00131}00131\ \ \ \ \ \textcolor{comment}{\#\ \ \ scale\ =\ 1/lambda\ =\ -\/quantile(q)\ /\ log(1\ -\/\ q)}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00132}00132\ \ \ \ \ y\ =\ rng.exponential(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00133}00133\ \ \ \ \ \ \ \ \ scale=-\/(X\ @\ coef\ +\ intercept)\ /\ np.log(1\ -\/\ quantile),\ size=n\_samples}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00134}00134\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00135}00135\ \ \ \ \ model\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00136}00136\ \ \ \ \ \ \ \ \ quantile=quantile,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00137}00137\ \ \ \ \ \ \ \ \ alpha=0,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00138}00138\ \ \ \ \ ).fit(X,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00139}00139\ \ \ \ \ \textcolor{comment}{\#\ This\ test\ can\ be\ made\ to\ pass\ with\ any\ solver\ but\ in\ the\ interest}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00140}00140\ \ \ \ \ \textcolor{comment}{\#\ of\ sparing\ continuous\ integration\ resources,\ the\ test\ is\ performed}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00141}00141\ \ \ \ \ \textcolor{comment}{\#\ with\ the\ fastest\ solver\ only.}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00142}00142\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00143}00143\ \ \ \ \ \textcolor{keyword}{assert}\ model.intercept\_\ ==\ approx(intercept,\ rel=0.2)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00144}00144\ \ \ \ \ assert\_allclose(model.coef\_,\ coef,\ rtol=0.6)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00145}00145\ \ \ \ \ assert\_allclose(np.mean(model.predict(X)\ >\ y),\ quantile,\ atol=1e-\/2)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00146}00146\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00147}00147\ \ \ \ \ \textcolor{comment}{\#\ Now\ compare\ to\ Nelder-\/Mead\ optimization\ with\ L1\ penalty}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00148}00148\ \ \ \ \ alpha\ =\ 0.01}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00149}00149\ \ \ \ \ model.set\_params(alpha=alpha).fit(X,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00150}00150\ \ \ \ \ model\_coef\ =\ np.r\_[model.intercept\_,\ model.coef\_]}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00151}00151\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00152}00152\ \ \ \ \ \textcolor{keyword}{def\ }func(coef):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00153}00153\ \ \ \ \ \ \ \ \ loss\ =\ mean\_pinball\_loss(y,\ X\ @\ coef[1:]\ +\ coef[0],\ alpha=quantile)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00154}00154\ \ \ \ \ \ \ \ \ L1\ =\ np.sum(np.abs(coef[1:]))}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00155}00155\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ loss\ +\ alpha\ *\ L1}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00156}00156\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00157}00157\ \ \ \ \ res\ =\ minimize(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00158}00158\ \ \ \ \ \ \ \ \ fun=func,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00159}00159\ \ \ \ \ \ \ \ \ x0=[1,\ 0,\ -\/1],}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00160}00160\ \ \ \ \ \ \ \ \ method=\textcolor{stringliteral}{"{}Nelder-\/Mead"{}},}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00161}00161\ \ \ \ \ \ \ \ \ tol=1e-\/12,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00162}00162\ \ \ \ \ \ \ \ \ options=\{\textcolor{stringliteral}{"{}maxiter"{}}:\ 2000\},}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00163}00163\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00164}00164\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00165}00165\ \ \ \ \ \textcolor{keyword}{assert}\ func(model\_coef)\ ==\ approx(func(res.x))}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00166}00166\ \ \ \ \ assert\_allclose(model.intercept\_,\ res.x[0])}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00167}00167\ \ \ \ \ assert\_allclose(model.coef\_,\ res.x[1:])}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00168}00168\ \ \ \ \ assert\_allclose(np.mean(model.predict(X)\ >\ y),\ quantile,\ atol=1e-\/2)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00169}00169\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00170}00170\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00171}00171\ \textcolor{preprocessor}{@pytest.mark.parametrize("{}quantile"{},\ [0.2,\ 0.5,\ 0.8])}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00172}\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1tests_1_1test__quantile_aa5799f5f22b4421c94799d7bd3a80166}{00172}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1tests_1_1test__quantile_aa5799f5f22b4421c94799d7bd3a80166}{test\_equivariance}}(quantile):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00173}00173\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Test\ equivariace\ of\ quantile\ regression.}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00174}00174\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00175}00175\ \textcolor{stringliteral}{\ \ \ \ See\ Koenker\ (2005)\ Quantile\ Regression,\ Chapter\ 2.2.3.}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00176}00176\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00177}00177\ \ \ \ \ rng\ =\ np.random.RandomState(42)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00178}00178\ \ \ \ \ n\_samples,\ n\_features\ =\ 100,\ 5}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00179}00179\ \ \ \ \ X,\ y\ =\ make\_regression(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00180}00180\ \ \ \ \ \ \ \ \ n\_samples=n\_samples,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00181}00181\ \ \ \ \ \ \ \ \ n\_features=n\_features,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00182}00182\ \ \ \ \ \ \ \ \ n\_informative=n\_features,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00183}00183\ \ \ \ \ \ \ \ \ noise=0,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00184}00184\ \ \ \ \ \ \ \ \ random\_state=rng,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00185}00185\ \ \ \ \ \ \ \ \ shuffle=\textcolor{keyword}{False},}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00186}00186\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00187}00187\ \ \ \ \ \textcolor{comment}{\#\ make\ y\ asymmetric}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00188}00188\ \ \ \ \ y\ +=\ rng.exponential(scale=100,\ size=y.shape)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00189}00189\ \ \ \ \ params\ =\ dict(alpha=0)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00190}00190\ \ \ \ \ model1\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(quantile=quantile,\ **params).fit(X,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00191}00191\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00192}00192\ \ \ \ \ \textcolor{comment}{\#\ coef(q;\ a*y,\ X)\ =\ a\ *\ coef(q;\ y,\ X)}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00193}00193\ \ \ \ \ a\ =\ 2.5}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00194}00194\ \ \ \ \ model2\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(quantile=quantile,\ **params).fit(X,\ a\ *\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00195}00195\ \ \ \ \ \textcolor{keyword}{assert}\ model2.intercept\_\ ==\ approx(a\ *\ model1.intercept\_,\ rel=1e-\/5)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00196}00196\ \ \ \ \ assert\_allclose(model2.coef\_,\ a\ *\ model1.coef\_,\ rtol=1e-\/5)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00197}00197\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00198}00198\ \ \ \ \ \textcolor{comment}{\#\ coef(1-\/q;\ -\/a*y,\ X)\ =\ -\/a\ *\ coef(q;\ y,\ X)}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00199}00199\ \ \ \ \ model2\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(quantile=1\ -\/\ quantile,\ **params).fit(X,\ -\/a\ *\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00200}00200\ \ \ \ \ \textcolor{keyword}{assert}\ model2.intercept\_\ ==\ approx(-\/a\ *\ model1.intercept\_,\ rel=1e-\/5)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00201}00201\ \ \ \ \ assert\_allclose(model2.coef\_,\ -\/a\ *\ model1.coef\_,\ rtol=1e-\/5)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00202}00202\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00203}00203\ \ \ \ \ \textcolor{comment}{\#\ coef(q;\ y\ +\ X\ @\ g,\ X)\ =\ coef(q;\ y,\ X)\ +\ g}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00204}00204\ \ \ \ \ g\_intercept,\ g\_coef\ =\ rng.randn(),\ rng.randn(n\_features)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00205}00205\ \ \ \ \ model2\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(quantile=quantile,\ **params)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00206}00206\ \ \ \ \ model2.fit(X,\ y\ +\ X\ @\ g\_coef\ +\ g\_intercept)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00207}00207\ \ \ \ \ \textcolor{keyword}{assert}\ model2.intercept\_\ ==\ approx(model1.intercept\_\ +\ g\_intercept)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00208}00208\ \ \ \ \ assert\_allclose(model2.coef\_,\ model1.coef\_\ +\ g\_coef,\ rtol=1e-\/6)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00209}00209\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00210}00210\ \ \ \ \ \textcolor{comment}{\#\ coef(q;\ y,\ X\ @\ A)\ =\ A\string^-\/1\ @\ coef(q;\ y,\ X)}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00211}00211\ \ \ \ \ A\ =\ rng.randn(n\_features,\ n\_features)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00212}00212\ \ \ \ \ model2\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(quantile=quantile,\ **params)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00213}00213\ \ \ \ \ model2.fit(X\ @\ A,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00214}00214\ \ \ \ \ \textcolor{keyword}{assert}\ model2.intercept\_\ ==\ approx(model1.intercept\_,\ rel=1e-\/5)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00215}00215\ \ \ \ \ assert\_allclose(model2.coef\_,\ np.linalg.solve(A,\ model1.coef\_),\ rtol=1e-\/5)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00216}00216\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00217}00217\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00218}00218\ \textcolor{preprocessor}{@pytest.mark.skipif}(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00219}00219\ \ \ \ \ parse\_version(sp\_version.base\_version)\ >=\ parse\_version(\textcolor{stringliteral}{"{}1.11"{}}),}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00220}00220\ \ \ \ \ reason=\textcolor{stringliteral}{"{}interior-\/point\ solver\ is\ not\ available\ in\ SciPy\ 1.11"{}},}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00221}00221\ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00222}00222\ \textcolor{preprocessor}{@pytest.mark.filterwarnings("{}ignore:`method='interior-\/point'`\ is\ deprecated"{})}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00223}\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1tests_1_1test__quantile_a64bdfdcf47ad990fbb48382a0c5a7bad}{00223}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1tests_1_1test__quantile_a64bdfdcf47ad990fbb48382a0c5a7bad}{test\_linprog\_failure}}():}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00224}00224\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Test\ that\ linprog\ fails."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00225}00225\ \ \ \ \ X\ =\ np.linspace(0,\ 10,\ num=10).reshape(-\/1,\ 1)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00226}00226\ \ \ \ \ y\ =\ np.linspace(0,\ 10,\ num=10)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00227}00227\ \ \ \ \ reg\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00228}00228\ \ \ \ \ \ \ \ \ alpha=0,\ solver=\textcolor{stringliteral}{"{}interior-\/point"{}},\ solver\_options=\{\textcolor{stringliteral}{"{}maxiter"{}}:\ 1\}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00229}00229\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00230}00230\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00231}00231\ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}Linear\ programming\ for\ QuantileRegressor\ did\ not\ succeed."{}}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00232}00232\ \ \ \ \ \textcolor{keyword}{with}\ pytest.warns(ConvergenceWarning,\ match=msg):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00233}00233\ \ \ \ \ \ \ \ \ reg.fit(X,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00234}00234\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00235}00235\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00236}00236\ \textcolor{preprocessor}{@pytest.mark.parametrize}(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00237}00237\ \ \ \ \ \textcolor{stringliteral}{"{}sparse\_container"{}},\ CSC\_CONTAINERS\ +\ CSR\_CONTAINERS\ +\ COO\_CONTAINERS}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00238}00238\ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00239}00239\ \textcolor{preprocessor}{@pytest.mark.parametrize("{}solver"{},\ ["{}highs"{},\ "{}highs-\/ds"{},\ "{}highs-\/ipm"{}])}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00240}00240\ \textcolor{preprocessor}{@pytest.mark.parametrize("{}fit\_intercept"{},\ [True,\ False])}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00241}\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1tests_1_1test__quantile_a4f7fda5795d4119973f88d5b03a88666}{00241}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1tests_1_1test__quantile_a4f7fda5795d4119973f88d5b03a88666}{test\_sparse\_input}}(sparse\_container,\ solver,\ fit\_intercept,\ global\_random\_seed):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00242}00242\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Test\ that\ sparse\ and\ dense\ X\ give\ same\ results."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00243}00243\ \ \ \ \ n\_informative\ =\ 10}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00244}00244\ \ \ \ \ quantile\_level\ =\ 0.6}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00245}00245\ \ \ \ \ X,\ y\ =\ make\_regression(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00246}00246\ \ \ \ \ \ \ \ \ n\_samples=300,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00247}00247\ \ \ \ \ \ \ \ \ n\_features=20,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00248}00248\ \ \ \ \ \ \ \ \ n\_informative=10,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00249}00249\ \ \ \ \ \ \ \ \ random\_state=global\_random\_seed,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00250}00250\ \ \ \ \ \ \ \ \ noise=1.0,}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00251}00251\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00252}00252\ \ \ \ \ X\_sparse\ =\ sparse\_container(X)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00253}00253\ \ \ \ \ alpha\ =\ 0.1}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00254}00254\ \ \ \ \ quant\_dense\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00255}00255\ \ \ \ \ \ \ \ \ quantile=quantile\_level,\ alpha=alpha,\ fit\_intercept=fit\_intercept}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00256}00256\ \ \ \ \ ).fit(X,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00257}00257\ \ \ \ \ quant\_sparse\ =\ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00258}00258\ \ \ \ \ \ \ \ \ quantile=quantile\_level,\ alpha=alpha,\ fit\_intercept=fit\_intercept,\ solver=solver}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00259}00259\ \ \ \ \ ).fit(X\_sparse,\ y)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00260}00260\ \ \ \ \ assert\_allclose(quant\_sparse.coef\_,\ quant\_dense.coef\_,\ rtol=1e-\/2)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00261}00261\ \ \ \ \ sparse\_support\ =\ quant\_sparse.coef\_\ !=\ 0}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00262}00262\ \ \ \ \ dense\_support\ =\ quant\_dense.coef\_\ !=\ 0}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00263}00263\ \ \ \ \ \textcolor{keyword}{assert}\ dense\_support.sum()\ ==\ pytest.approx(n\_informative,\ abs=1)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00264}00264\ \ \ \ \ \textcolor{keyword}{assert}\ sparse\_support.sum()\ ==\ pytest.approx(n\_informative,\ abs=1)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00265}00265\ \ \ \ \ \textcolor{keywordflow}{if}\ fit\_intercept:}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00266}00266\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ quant\_sparse.intercept\_\ ==\ approx(quant\_dense.intercept\_)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00267}00267\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ check\ that\ we\ still\ predict\ fraction}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00268}00268\ \ \ \ \ \ \ \ \ empirical\_coverage\ =\ np.mean(y\ <\ quant\_sparse.predict(X\_sparse))}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00269}00269\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ empirical\_coverage\ ==\ approx(quantile\_level,\ abs=3e-\/2)}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00270}00270\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00271}00271\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00272}\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1tests_1_1test__quantile_a66bebfbc154984aa7f34746ac8b73799}{00272}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1tests_1_1test__quantile_a66bebfbc154984aa7f34746ac8b73799}{test\_error\_interior\_point\_future}}(X\_y\_data,\ monkeypatch):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00273}00273\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Check\ that\ we\ will\ raise\ a\ proper\ error\ when\ requesting}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00274}00274\ \textcolor{stringliteral}{\ \ \ \ \`{}solver='interior-\/point'\`{}\ in\ SciPy\ >=\ 1.11.}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00275}00275\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00276}00276\ \ \ \ \ X,\ y\ =\ X\_y\_data}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00277}00277\ \ \ \ \ \textcolor{keyword}{import}\ \mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1__quantile}{sklearn.linear\_model.\_quantile}}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00278}00278\ }
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00279}00279\ \ \ \ \ \textcolor{keyword}{with}\ monkeypatch.context()\ \textcolor{keyword}{as}\ m:}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00280}00280\ \ \ \ \ \ \ \ \ m.setattr(\mbox{\hyperlink{namespacesklearn_1_1linear__model_1_1__quantile}{sklearn.linear\_model.\_quantile}},\ \textcolor{stringliteral}{"{}sp\_version"{}},\ parse\_version(\textcolor{stringliteral}{"{}1.11.0"{}}))}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00281}00281\ \ \ \ \ \ \ \ \ err\_msg\ =\ \textcolor{stringliteral}{"{}Solver\ interior-\/point\ is\ not\ anymore\ available\ in\ SciPy\ >=\ 1.11.0."{}}}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00282}00282\ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pytest.raises(ValueError,\ match=err\_msg):}
\DoxyCodeLine{\Hypertarget{sklearn_2linear__model_2tests_2test__quantile_8py_source_l00283}00283\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsklearn_1_1linear__model_1_1__quantile_1_1QuantileRegressor}{QuantileRegressor}}(solver=\textcolor{stringliteral}{"{}interior-\/point"{}}).fit(X,\ y)}

\end{DoxyCode}
