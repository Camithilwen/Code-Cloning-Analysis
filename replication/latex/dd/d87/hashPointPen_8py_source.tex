\doxysection{hash\+Point\+Pen.\+py}
\hypertarget{hashPointPen_8py_source}{}\label{hashPointPen_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/fontTools/pens/hashPointPen.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/fontTools/pens/hashPointPen.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00001}\mbox{\hyperlink{namespacefontTools_1_1pens_1_1hashPointPen}{00001}}\ \textcolor{comment}{\#\ Modified\ from\ https://github.com/adobe-\/type-\/tools/psautohint/blob/08b346865710ed3c172f1eb581d6ef243b203f99/python/psautohint/ufoFont.py\#L800-\/L838}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00002}00002\ \textcolor{keyword}{import}\ hashlib}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00004}00004\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1pens_1_1basePen}{fontTools.pens.basePen}}\ \textcolor{keyword}{import}\ MissingComponentError}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00005}00005\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1pens_1_1pointPen}{fontTools.pens.pointPen}}\ \textcolor{keyword}{import}\ AbstractPointPen}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00008}\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen}{00008}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen}{HashPointPen}}(\mbox{\hyperlink{classfontTools_1_1pens_1_1pointPen_1_1AbstractPointPen}{AbstractPointPen}}):}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00009}00009\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00010}00010\ \textcolor{stringliteral}{\ \ \ \ This\ pen\ can\ be\ used\ to\ check\ if\ a\ glyph's\ contents\ (outlines\ plus}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00011}00011\ \textcolor{stringliteral}{\ \ \ \ components)\ have\ changed.}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00012}00012\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00013}00013\ \textcolor{stringliteral}{\ \ \ \ Components\ are\ added\ as\ the\ original\ outline\ plus\ each\ composite's}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00014}00014\ \textcolor{stringliteral}{\ \ \ \ transformation.}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00015}00015\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00016}00016\ \textcolor{stringliteral}{\ \ \ \ Example:\ You\ have\ some\ TrueType\ hinting\ code\ for\ a\ glyph\ which\ you\ want\ to}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00017}00017\ \textcolor{stringliteral}{\ \ \ \ compile.\ The\ hinting\ code\ specifies\ a\ hash\ value\ computed\ with\ HashPointPen}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00018}00018\ \textcolor{stringliteral}{\ \ \ \ that\ was\ valid\ for\ the\ glyph's\ outlines\ at\ the\ time\ the\ hinting\ code\ was}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00019}00019\ \textcolor{stringliteral}{\ \ \ \ written.\ Now\ you\ can\ calculate\ the\ hash\ for\ the\ glyph's\ current\ outlines\ to}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00020}00020\ \textcolor{stringliteral}{\ \ \ \ check\ if\ the\ outlines\ have\ changed,\ which\ would\ probably\ make\ the\ hinting}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00021}00021\ \textcolor{stringliteral}{\ \ \ \ code\ invalid.}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00022}00022\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00023}00023\ \textcolor{stringliteral}{\ \ \ \ >\ glyph\ =\ ufo[name]}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00024}00024\ \textcolor{stringliteral}{\ \ \ \ >\ hash\_pen\ =\ HashPointPen(glyph.width,\ ufo)}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00025}00025\ \textcolor{stringliteral}{\ \ \ \ >\ glyph.drawPoints(hash\_pen)}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00026}00026\ \textcolor{stringliteral}{\ \ \ \ >\ ttdata\ =\ glyph.lib.get("{}public.truetype.instructions"{},\ None)}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00027}00027\ \textcolor{stringliteral}{\ \ \ \ >\ stored\_hash\ =\ ttdata.get("{}id"{},\ None)\ \ \#\ The\ hash\ is\ stored\ in\ the\ "{}id"{}\ key}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00028}00028\ \textcolor{stringliteral}{\ \ \ \ >\ if\ stored\_hash\ is\ None\ or\ stored\_hash\ !=\ hash\_pen.hash:}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00029}00029\ \textcolor{stringliteral}{\ \ \ \ >\ \ \ \ logger.error(f"{}Glyph\ hash\ mismatch,\ glyph\ '\{name\}'\ will\ have\ no\ instructions\ in\ font."{})}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00030}00030\ \textcolor{stringliteral}{\ \ \ \ >\ else:}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00031}00031\ \textcolor{stringliteral}{\ \ \ \ >\ \ \ \ \#\ The\ hash\ values\ are\ identical,\ the\ outline\ has\ not\ changed.}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00032}00032\ \textcolor{stringliteral}{\ \ \ \ >\ \ \ \ \#\ Compile\ the\ hinting\ code\ ...}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00033}00033\ \textcolor{stringliteral}{\ \ \ \ >\ \ \ \ pass}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00034}00034\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00035}00035\ \textcolor{stringliteral}{\ \ \ \ If\ you\ want\ to\ compare\ a\ glyph\ from\ a\ source\ format\ which\ supports\ floating\ point}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00036}00036\ \textcolor{stringliteral}{\ \ \ \ coordinates\ and\ transformations\ against\ a\ glyph\ from\ a\ format\ which\ has\ restrictions}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00037}00037\ \textcolor{stringliteral}{\ \ \ \ on\ the\ precision\ of\ floats,\ e.g.\ UFO\ vs.\ TTF,\ you\ must\ use\ an\ appropriate\ rounding}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00038}00038\ \textcolor{stringliteral}{\ \ \ \ function\ to\ make\ the\ values\ comparable.\ For\ TTF\ fonts\ with\ composites,\ this}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00039}00039\ \textcolor{stringliteral}{\ \ \ \ construct\ can\ be\ used\ to\ make\ the\ transform\ values\ conform\ to\ F2Dot14:}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00040}00040\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00041}00041\ \textcolor{stringliteral}{\ \ \ \ >\ ttf\_hash\_pen\ =\ HashPointPen(ttf\_glyph\_width,\ ttFont.getGlyphSet())}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00042}00042\ \textcolor{stringliteral}{\ \ \ \ >\ ttf\_round\_pen\ =\ RoundingPointPen(ttf\_hash\_pen,\ transformRoundFunc=partial(floatToFixedToFloat,\ precisionBits=14))}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00043}00043\ \textcolor{stringliteral}{\ \ \ \ >\ ufo\_hash\_pen\ =\ HashPointPen(ufo\_glyph.width,\ ufo)}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00044}00044\ \textcolor{stringliteral}{\ \ \ \ >\ ttf\_glyph.drawPoints(ttf\_round\_pen,\ ttFont["{}glyf"{}])}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00045}00045\ \textcolor{stringliteral}{\ \ \ \ >\ ufo\_round\_pen\ =\ RoundingPointPen(ufo\_hash\_pen,\ transformRoundFunc=partial(floatToFixedToFloat,\ precisionBits=14))}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00046}00046\ \textcolor{stringliteral}{\ \ \ \ >\ ufo\_glyph.drawPoints(ufo\_round\_pen)}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00047}00047\ \textcolor{stringliteral}{\ \ \ \ >\ assert\ ttf\_hash\_pen.hash\ ==\ ufo\_hash\_pen.hash}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00048}00048\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00050}00050\ \ \ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(self,\ glyphWidth=0,\ glyphSet=None):}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a959c18eed1943c8050576374938ad391}{glyphset}}\ =\ glyphSet}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00052}00052\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a1449f9762d1e38ee5c05d2430ac9c53f}{data}}\ =\ [\textcolor{stringliteral}{"{}w\%s"{}}\ \%\ round(glyphWidth,\ 9)]}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00054}00054\ \ \ \ \ \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00055}00055\ \ \ \ \ \textcolor{keyword}{def\ }hash(self):}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ data\ =\ \textcolor{stringliteral}{"{}"{}}.join(self.\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a1449f9762d1e38ee5c05d2430ac9c53f}{data}})}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00057}00057\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(data)\ >=\ 128:}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ data\ =\ hashlib.sha512(data.encode(\textcolor{stringliteral}{"{}ascii"{}})).hexdigest()}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00059}00059\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ data}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00061}\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a00bb2b188e2adba0de5d04256af2d22d}{00061}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a00bb2b188e2adba0de5d04256af2d22d}{beginPath}}(self,\ identifier=None,\ **kwargs):}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00062}00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00064}\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a5f36e22a00503886d5039f15e6b148fe}{00064}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a5f36e22a00503886d5039f15e6b148fe}{endPath}}(self):}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00065}00065\ \ \ \ \ \ \ \ \ self.data.append(\textcolor{stringliteral}{"{}|"{}})}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00066}00066\ }
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00067}\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a5151460cbb6190347bdbb45c0fe07541}{00067}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a5151460cbb6190347bdbb45c0fe07541}{addPoint}}(}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00068}00068\ \ \ \ \ \ \ \ \ self,}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00069}00069\ \ \ \ \ \ \ \ \ pt,}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ segmentType=None,}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00071}00071\ \ \ \ \ \ \ \ \ smooth=False,}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00072}00072\ \ \ \ \ \ \ \ \ name=None,}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00073}00073\ \ \ \ \ \ \ \ \ identifier=None,}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00074}00074\ \ \ \ \ \ \ \ \ **kwargs,}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00075}00075\ \ \ \ \ ):}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00076}00076\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ segmentType\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ pt\_type\ =\ \textcolor{stringliteral}{"{}o"{}}\ \ \textcolor{comment}{\#\ offcurve}}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ pt\_type\ =\ segmentType[0]}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00080}00080\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a1449f9762d1e38ee5c05d2430ac9c53f}{data}}.append(f\textcolor{stringliteral}{"{}\{pt\_type\}\{pt[0]:g\}\{pt[1]:+g\}"{}})}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00081}00081\ }
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00082}\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a20858a18ac7092b8eefb3aa436b54a21}{00082}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a20858a18ac7092b8eefb3aa436b54a21}{addComponent}}(self,\ baseGlyphName,\ transformation,\ identifier=None,\ **kwargs):}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00083}00083\ \ \ \ \ \ \ \ \ tr\ =\ \textcolor{stringliteral}{"{}"{}}.join([f\textcolor{stringliteral}{"{}\{t:+\}"{}}\ \textcolor{keywordflow}{for}\ t\ \textcolor{keywordflow}{in}\ transformation])}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00084}00084\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a1449f9762d1e38ee5c05d2430ac9c53f}{data}}.append(\textcolor{stringliteral}{"{}["{}})}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00085}00085\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a959c18eed1943c8050576374938ad391}{glyphset}}[baseGlyphName].drawPoints(self)}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00087}00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ KeyError:}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfontTools_1_1pens_1_1basePen_1_1MissingComponentError}{MissingComponentError}}(baseGlyphName)}
\DoxyCodeLine{\Hypertarget{hashPointPen_8py_source_l00089}00089\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classfontTools_1_1pens_1_1hashPointPen_1_1HashPointPen_a1449f9762d1e38ee5c05d2430ac9c53f}{data}}.append(f\textcolor{stringliteral}{"{}(\{tr\})]"{}})}

\end{DoxyCode}
