\doxysection{feature\+Vars.\+py}
\hypertarget{featureVars_8py_source}{}\label{featureVars_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/fontTools/varLib/featureVars.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/fontTools/varLib/featureVars.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00001}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars}{00001}}\ \textcolor{stringliteral}{"{}"{}"{}Module\ to\ build\ FeatureVariation\ tables:}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00002}00002\ \textcolor{stringliteral}{https://docs.microsoft.com/en-\/us/typography/opentype/spec/chapter2\#featurevariations-\/table}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00003}00003\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00004}00004\ \textcolor{stringliteral}{NOTE:\ The\ API\ is\ experimental\ and\ subject\ to\ change.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00005}00005\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00007}00007\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1misc_1_1dictTools}{fontTools.misc.dictTools}}\ \textcolor{keyword}{import}\ hashdict}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00008}00008\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1misc_1_1intTools}{fontTools.misc.intTools}}\ \textcolor{keyword}{import}\ bit\_count}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00009}00009\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1ttLib}{fontTools.ttLib}}\ \textcolor{keyword}{import}\ newTable}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00010}00010\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1ttLib_1_1tables}{fontTools.ttLib.tables}}\ \textcolor{keyword}{import}\ otTables\ \textcolor{keyword}{as}\ ot}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00011}00011\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1ttLib_1_1ttVisitor}{fontTools.ttLib.ttVisitor}}\ \textcolor{keyword}{import}\ TTVisitor}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00012}00012\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1otlLib_1_1builder}{fontTools.otlLib.builder}}\ \textcolor{keyword}{import}\ buildLookup,\ buildSingleSubstSubtable}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00013}00013\ \textcolor{keyword}{from}\ collections\ \textcolor{keyword}{import}\ OrderedDict}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00015}00015\ \textcolor{keyword}{from}\ .errors\ \textcolor{keyword}{import}\ VarLibError,\ VarLibValidationError}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00018}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a1a660cd1c7eb6f5046096d05152012c1}{00018}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a1a660cd1c7eb6f5046096d05152012c1}{addFeatureVariations}}(font,\ conditionalSubstitutions,\ featureTag="{}rvrn"{}):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00019}00019\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Add\ conditional\ substitutions\ to\ a\ Variable\ Font.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00020}00020\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00021}00021\ \textcolor{stringliteral}{\ \ \ \ The\ \`{}conditionalSubstitutions\`{}\ argument\ is\ a\ list\ of\ (Region,\ Substitutions)}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00022}00022\ \textcolor{stringliteral}{\ \ \ \ tuples.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00023}00023\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00024}00024\ \textcolor{stringliteral}{\ \ \ \ A\ Region\ is\ a\ list\ of\ Boxes.\ A\ Box\ is\ a\ dict\ mapping\ axisTags\ to}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00025}00025\ \textcolor{stringliteral}{\ \ \ \ (minValue,\ maxValue)\ tuples.\ Irrelevant\ axes\ may\ be\ omitted\ and\ they\ are}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00026}00026\ \textcolor{stringliteral}{\ \ \ \ interpretted\ as\ extending\ to\ end\ of\ axis\ in\ each\ direction.\ \ A\ Box\ represents}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00027}00027\ \textcolor{stringliteral}{\ \ \ \ an\ orthogonal\ 'rectangular'\ subset\ of\ an\ N-\/dimensional\ design\ space.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00028}00028\ \textcolor{stringliteral}{\ \ \ \ A\ Region\ represents\ a\ more\ complex\ subset\ of\ an\ N-\/dimensional\ design\ space,}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00029}00029\ \textcolor{stringliteral}{\ \ \ \ ie.\ the\ union\ of\ all\ the\ Boxes\ in\ the\ Region.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00030}00030\ \textcolor{stringliteral}{\ \ \ \ For\ efficiency,\ Boxes\ within\ a\ Region\ should\ ideally\ not\ overlap,\ but}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00031}00031\ \textcolor{stringliteral}{\ \ \ \ functionality\ is\ not\ compromised\ if\ they\ do.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00032}00032\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00033}00033\ \textcolor{stringliteral}{\ \ \ \ The\ minimum\ and\ maximum\ values\ are\ expressed\ in\ normalized\ coordinates.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00034}00034\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00035}00035\ \textcolor{stringliteral}{\ \ \ \ A\ Substitution\ is\ a\ dict\ mapping\ source\ glyph\ names\ to\ substitute\ glyph\ names.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00036}00036\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00037}00037\ \textcolor{stringliteral}{\ \ \ \ Example:}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00038}00038\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00039}00039\ \textcolor{stringliteral}{\ \ \ \ \#\ >>>\ f\ =\ TTFont(srcPath)}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00040}00040\ \textcolor{stringliteral}{\ \ \ \ \#\ >>>\ condSubst\ =\ [}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00041}00041\ \textcolor{stringliteral}{\ \ \ \ \#\ ...\ \ \ \ \ \#\ A\ list\ of\ (Region,\ Substitution)\ tuples.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00042}00042\ \textcolor{stringliteral}{\ \ \ \ \#\ ...\ \ \ \ \ ([\{"{}wdth"{}:\ (0.5,\ 1.0)\}],\ \{"{}cent"{}:\ "{}cent.rvrn"{}\}),}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00043}00043\ \textcolor{stringliteral}{\ \ \ \ \#\ ...\ \ \ \ \ ([\{"{}wght"{}:\ (0.5,\ 1.0)\}],\ \{"{}dollar"{}:\ "{}dollar.rvrn"{}\}),}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00044}00044\ \textcolor{stringliteral}{\ \ \ \ \#\ ...\ ]}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00045}00045\ \textcolor{stringliteral}{\ \ \ \ \#\ >>>\ addFeatureVariations(f,\ condSubst)}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00046}00046\ \textcolor{stringliteral}{\ \ \ \ \#\ >>>\ f.save(dstPath)}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00047}00047\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00048}00048\ \textcolor{stringliteral}{\ \ \ \ The\ \`{}featureTag\`{}\ parameter\ takes\ either\ a\ str\ or\ a\ iterable\ of\ str\ (the\ single\ str}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00049}00049\ \textcolor{stringliteral}{\ \ \ \ is\ kept\ for\ backwards\ compatibility),\ and\ defines\ which\ feature(s)\ will\ be}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00050}00050\ \textcolor{stringliteral}{\ \ \ \ associated\ with\ the\ feature\ variations.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00051}00051\ \textcolor{stringliteral}{\ \ \ \ Note,\ if\ this\ is\ "{}rvrn"{},\ then\ the\ substitution\ lookup\ will\ be\ inserted\ at\ the}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00052}00052\ \textcolor{stringliteral}{\ \ \ \ beginning\ of\ the\ lookup\ list\ so\ that\ it\ is\ processed\ before\ others,\ otherwise}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00053}00053\ \textcolor{stringliteral}{\ \ \ \ for\ any\ other\ feature\ tags\ it\ will\ be\ appended\ last.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00054}00054\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00055}00055\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00056}00056\ \ \ \ \ \textcolor{comment}{\#\ process\ first\ when\ "{}rvrn"{}\ is\ the\ only\ listed\ tag}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00057}00057\ \ \ \ \ featureTags\ =\ [featureTag]\ \textcolor{keywordflow}{if}\ isinstance(featureTag,\ str)\ \textcolor{keywordflow}{else}\ sorted(featureTag)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00058}00058\ \ \ \ \ processLast\ =\ \textcolor{stringliteral}{"{}rvrn"{}}\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ featureTags\ \textcolor{keywordflow}{or}\ len(featureTags)\ >\ 1}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00060}00060\ \ \ \ \ \_checkSubstitutionGlyphsExist(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00061}00061\ \ \ \ \ \ \ \ \ glyphNames=set(font.getGlyphOrder()),}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00062}00062\ \ \ \ \ \ \ \ \ substitutions=conditionalSubstitutions,}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00063}00063\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00064}00064\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00065}00065\ \ \ \ \ substitutions\ =\ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a98455ef199d9013baf64572e88095604}{overlayFeatureVariations}}(conditionalSubstitutions)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00066}00066\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00067}00067\ \ \ \ \ \textcolor{comment}{\#\ turn\ substitution\ dicts\ into\ tuples\ of\ tuples,\ so\ they\ are\ hashable}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00068}00068\ \ \ \ \ conditionalSubstitutions,\ allSubstitutions\ =\ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_acd511c6d4af6324ff25fa997792aab0b}{makeSubstitutionsHashable}}(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00069}00069\ \ \ \ \ \ \ \ \ substitutions}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00070}00070\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00071}00071\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}GSUB"{}}\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ font:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00072}00072\ \ \ \ \ \ \ \ \ font[\textcolor{stringliteral}{"{}GSUB"{}}]\ =\ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_aa3abda32a4614269287cb36afcbeb11e}{buildGSUB}}()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00073}00073\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00074}00074\ \ \ \ \ \ \ \ \ existingTags\ =\ \_existingVariableFeatures(font[\textcolor{stringliteral}{"{}GSUB"{}}].table).intersection(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ featureTags}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00076}00076\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ existingTags:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfontTools_1_1varLib_1_1errors_1_1VarLibError}{VarLibError}}(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}FeatureVariations\ already\ exist\ for\ feature\ tag(s):\ \{existingTags\}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00081}00081\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00082}00082\ \ \ \ \ \textcolor{comment}{\#\ setup\ lookups}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00083}00083\ \ \ \ \ lookupMap\ =\ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a963078fcf8a17fd5359054e705320fe4}{buildSubstitutionLookups}}(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00084}00084\ \ \ \ \ \ \ \ \ font[\textcolor{stringliteral}{"{}GSUB"{}}].table,\ allSubstitutions,\ processLast}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00085}00085\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00086}00086\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00087}00087\ \ \ \ \ \textcolor{comment}{\#\ addFeatureVariationsRaw\ takes\ a\ list\ of}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00088}00088\ \ \ \ \ \textcolor{comment}{\#\ \ (\ \{condition\},\ [\ lookup\ indices\ ]\ )}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00089}00089\ \ \ \ \ \textcolor{comment}{\#\ so\ rearrange\ our\ lookups\ to\ match}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00090}00090\ \ \ \ \ conditionsAndLookups\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00091}00091\ \ \ \ \ \textcolor{keywordflow}{for}\ conditionSet,\ substitutions\ \textcolor{keywordflow}{in}\ conditionalSubstitutions:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00092}00092\ \ \ \ \ \ \ \ \ conditionsAndLookups.append(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ (conditionSet,\ [lookupMap[s]\ \textcolor{keywordflow}{for}\ s\ \textcolor{keywordflow}{in}\ substitutions])}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00094}00094\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00096}00096\ \ \ \ \ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a2db79079995931eaaedf5007c504bf00}{addFeatureVariationsRaw}}(font,\ font[\textcolor{stringliteral}{"{}GSUB"{}}].table,\ conditionsAndLookups,\ featureTags)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00097}00097\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00098}00098\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00099}00099\ \textcolor{keyword}{def\ }\_existingVariableFeatures(table):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00100}00100\ \ \ \ \ existingFeatureVarsTags\ =\ set()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00101}00101\ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(table,\ \textcolor{stringliteral}{"{}FeatureVariations"{}})\ \textcolor{keywordflow}{and}\ table.FeatureVariations\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00102}00102\ \ \ \ \ \ \ \ \ features\ =\ table.FeatureList.FeatureRecord}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ fvr\ \textcolor{keywordflow}{in}\ table.FeatureVariations.FeatureVariationRecord:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ ftsr\ \textcolor{keywordflow}{in}\ fvr.FeatureTableSubstitution.SubstitutionRecord:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00105}00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ existingFeatureVarsTags.add(features[ftsr.FeatureIndex].FeatureTag)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00106}00106\ \ \ \ \ \textcolor{keywordflow}{return}\ existingFeatureVarsTags}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00107}00107\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00108}00108\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00109}00109\ \textcolor{keyword}{def\ }\_checkSubstitutionGlyphsExist(glyphNames,\ substitutions):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00110}00110\ \ \ \ \ referencedGlyphNames\ =\ set()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00111}00111\ \ \ \ \ \textcolor{keywordflow}{for}\ \_,\ substitution\ \textcolor{keywordflow}{in}\ substitutions:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00112}00112\ \ \ \ \ \ \ \ \ referencedGlyphNames\ |=\ substitution.keys()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00113}00113\ \ \ \ \ \ \ \ \ referencedGlyphNames\ |=\ set(substitution.values())}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00114}00114\ \ \ \ \ missing\ =\ referencedGlyphNames\ -\/\ glyphNames}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00115}00115\ \ \ \ \ \textcolor{keywordflow}{if}\ missing:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00116}00116\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfontTools_1_1varLib_1_1errors_1_1VarLibValidationError}{VarLibValidationError}}(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00117}00117\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Missing\ glyphs\ are\ referenced\ in\ conditional\ substitution\ rules:"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00118}00118\ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}\ \{',\ '.join(missing)\}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00119}00119\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00120}00120\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00121}00121\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00122}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a98455ef199d9013baf64572e88095604}{00122}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a98455ef199d9013baf64572e88095604}{overlayFeatureVariations}}(conditionalSubstitutions):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00123}00123\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Compute\ overlaps\ between\ all\ conditional\ substitutions.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00124}00124\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00125}00125\ \textcolor{stringliteral}{\ \ \ \ The\ \`{}conditionalSubstitutions\`{}\ argument\ is\ a\ list\ of\ (Region,\ Substitutions)}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00126}00126\ \textcolor{stringliteral}{\ \ \ \ tuples.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00127}00127\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00128}00128\ \textcolor{stringliteral}{\ \ \ \ A\ Region\ is\ a\ list\ of\ Boxes.\ A\ Box\ is\ a\ dict\ mapping\ axisTags\ to}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00129}00129\ \textcolor{stringliteral}{\ \ \ \ (minValue,\ maxValue)\ tuples.\ Irrelevant\ axes\ may\ be\ omitted\ and\ they\ are}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00130}00130\ \textcolor{stringliteral}{\ \ \ \ interpretted\ as\ extending\ to\ end\ of\ axis\ in\ each\ direction.\ \ A\ Box\ represents}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00131}00131\ \textcolor{stringliteral}{\ \ \ \ an\ orthogonal\ 'rectangular'\ subset\ of\ an\ N-\/dimensional\ design\ space.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00132}00132\ \textcolor{stringliteral}{\ \ \ \ A\ Region\ represents\ a\ more\ complex\ subset\ of\ an\ N-\/dimensional\ design\ space,}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00133}00133\ \textcolor{stringliteral}{\ \ \ \ ie.\ the\ union\ of\ all\ the\ Boxes\ in\ the\ Region.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00134}00134\ \textcolor{stringliteral}{\ \ \ \ For\ efficiency,\ Boxes\ within\ a\ Region\ should\ ideally\ not\ overlap,\ but}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00135}00135\ \textcolor{stringliteral}{\ \ \ \ functionality\ is\ not\ compromised\ if\ they\ do.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00136}00136\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00137}00137\ \textcolor{stringliteral}{\ \ \ \ The\ minimum\ and\ maximum\ values\ are\ expressed\ in\ normalized\ coordinates.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00138}00138\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00139}00139\ \textcolor{stringliteral}{\ \ \ \ A\ Substitution\ is\ a\ dict\ mapping\ source\ glyph\ names\ to\ substitute\ glyph\ names.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00140}00140\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00141}00141\ \textcolor{stringliteral}{\ \ \ \ Returns\ data\ is\ in\ similar\ but\ different\ format.\ \ Overlaps\ of\ distinct}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00142}00142\ \textcolor{stringliteral}{\ \ \ \ substitution\ Boxes\ (*not*\ Regions)\ are\ explicitly\ listed\ as\ distinct\ rules,}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00143}00143\ \textcolor{stringliteral}{\ \ \ \ and\ rules\ with\ the\ same\ Box\ merged.\ \ The\ more\ specific\ rules\ appear\ earlier}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00144}00144\ \textcolor{stringliteral}{\ \ \ \ in\ the\ resulting\ list.\ \ Moreover,\ instead\ of\ just\ a\ dictionary\ of\ substitutions,}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00145}00145\ \textcolor{stringliteral}{\ \ \ \ a\ list\ of\ dictionaries\ is\ returned\ for\ substitutions\ corresponding\ to\ each}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00146}00146\ \textcolor{stringliteral}{\ \ \ \ unique\ space,\ with\ each\ dictionary\ being\ identical\ to\ one\ of\ the\ input}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00147}00147\ \textcolor{stringliteral}{\ \ \ \ substitution\ dictionaries.\ \ These\ dictionaries\ are\ not\ merged\ to\ allow\ data}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00148}00148\ \textcolor{stringliteral}{\ \ \ \ sharing\ when\ they\ are\ converted\ into\ font\ tables.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00149}00149\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00150}00150\ \textcolor{stringliteral}{\ \ \ \ Example::}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00151}00151\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00152}00152\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ >>>\ condSubst\ =\ [}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00153}00153\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ ...\ \ \ \ \ \#\ A\ list\ of\ (Region,\ Substitution)\ tuples.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00154}00154\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ ...\ \ \ \ \ ([\{"{}wght"{}:\ (0.5,\ 1.0)\}],\ \{"{}dollar"{}:\ "{}dollar.rvrn"{}\}),}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00155}00155\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ ...\ \ \ \ \ ([\{"{}wght"{}:\ (0.5,\ 1.0)\}],\ \{"{}dollar"{}:\ "{}dollar.rvrn"{}\}),}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00156}00156\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ ...\ \ \ \ \ ([\{"{}wdth"{}:\ (0.5,\ 1.0)\}],\ \{"{}cent"{}:\ "{}cent.rvrn"{}\}),}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00157}00157\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ ...\ \ \ \ \ ([\{"{}wght"{}:\ (0.5,\ 1.0),\ "{}wdth"{}:\ (-\/1,\ 1.0)\}],\ \{"{}dollar"{}:\ "{}dollar.rvrn"{}\}),}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00158}00158\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ ...\ ]}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00159}00159\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ >>>\ from\ pprint\ import\ pprint}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00160}00160\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ >>>\ pprint(overlayFeatureVariations(condSubst))}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00161}00161\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ [(\{'wdth':\ (0.5,\ 1.0),\ 'wght':\ (0.5,\ 1.0)\},}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00162}00162\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ [\{'dollar':\ 'dollar.rvrn'\},\ \{'cent':\ 'cent.rvrn'\}]),}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00163}00163\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ (\{'wdth':\ (0.5,\ 1.0)\},\ [\{'cent':\ 'cent.rvrn'\}]),}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00164}00164\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ (\{'wght':\ (0.5,\ 1.0)\},\ [\{'dollar':\ 'dollar.rvrn'\}])]}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00165}00165\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00166}00166\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00167}00167\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00168}00168\ \ \ \ \ \textcolor{comment}{\#\ Merge\ same-\/substitutions\ rules,\ as\ this\ creates\ fewer\ number\ oflookups.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00169}00169\ \ \ \ \ merged\ =\ OrderedDict()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00170}00170\ \ \ \ \ \textcolor{keywordflow}{for}\ value,\ key\ \textcolor{keywordflow}{in}\ conditionalSubstitutions:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00171}00171\ \ \ \ \ \ \ \ \ key\ =\ \mbox{\hyperlink{classfontTools_1_1misc_1_1dictTools_1_1hashdict}{hashdict}}(key)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00172}00172\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ key\ \textcolor{keywordflow}{in}\ merged:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \ \ \ merged[key].extend(value)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00174}00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \ \ \ merged[key]\ =\ value}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00176}00176\ \ \ \ \ conditionalSubstitutions\ =\ [(v,\ dict(k))\ \textcolor{keywordflow}{for}\ k,\ v\ \textcolor{keywordflow}{in}\ merged.items()]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00177}00177\ \ \ \ \ del\ merged}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00178}00178\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00179}00179\ \ \ \ \ \textcolor{comment}{\#\ Merge\ same-\/region\ rules,\ as\ this\ is\ cheaper.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00180}00180\ \ \ \ \ \textcolor{comment}{\#\ Also\ convert\ boxes\ to\ hashdict()}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00181}00181\ \ \ \ \ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00182}00182\ \ \ \ \ \textcolor{comment}{\#\ Reversing\ is\ such\ that\ earlier\ entries\ win\ in\ case\ of\ conflicting\ substitution}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00183}00183\ \ \ \ \ \textcolor{comment}{\#\ rules\ for\ the\ same\ region.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00184}00184\ \ \ \ \ merged\ =\ OrderedDict()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00185}00185\ \ \ \ \ \textcolor{keywordflow}{for}\ key,\ value\ \textcolor{keywordflow}{in}\ reversed(conditionalSubstitutions):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00186}00186\ \ \ \ \ \ \ \ \ key\ =\ tuple(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00187}00187\ \ \ \ \ \ \ \ \ \ \ \ \ sorted(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00188}00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{classfontTools_1_1misc_1_1dictTools_1_1hashdict}{hashdict}}(\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_ab0f4124cf2154bc8fcc734f94b1999d8}{cleanupBox}}(k))\ \textcolor{keywordflow}{for}\ k\ \textcolor{keywordflow}{in}\ key),}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key=\textcolor{keyword}{lambda}\ d:\ tuple(sorted(d.items())),}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00190}00190\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00191}00191\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00192}00192\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ key\ \textcolor{keywordflow}{in}\ merged:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00193}00193\ \ \ \ \ \ \ \ \ \ \ \ \ merged[key].update(value)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00194}00194\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00195}00195\ \ \ \ \ \ \ \ \ \ \ \ \ merged[key]\ =\ dict(value)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00196}00196\ \ \ \ \ conditionalSubstitutions\ =\ list(reversed(merged.items()))}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00197}00197\ \ \ \ \ del\ merged}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00198}00198\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00199}00199\ \ \ \ \ \textcolor{comment}{\#\ Overlay}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00200}00200\ \ \ \ \ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00201}00201\ \ \ \ \ \textcolor{comment}{\#\ Rank\ is\ the\ bit-\/set\ of\ the\ index\ of\ all\ contributing\ layers.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00202}00202\ \ \ \ \ initMapInit\ =\ ((\mbox{\hyperlink{classfontTools_1_1misc_1_1dictTools_1_1hashdict}{hashdict}}(),\ 0),)\ \ \textcolor{comment}{\#\ Initializer\ representing\ the\ entire\ space}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00203}00203\ \ \ \ \ boxMap\ =\ OrderedDict(initMapInit)\ \ \textcolor{comment}{\#\ Map\ from\ Box\ to\ Rank}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00204}00204\ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ (currRegion,\ \_)\ \textcolor{keywordflow}{in}\ enumerate(conditionalSubstitutions):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00205}00205\ \ \ \ \ \ \ \ \ newMap\ =\ OrderedDict(initMapInit)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00206}00206\ \ \ \ \ \ \ \ \ currRank\ =\ 1\ <<\ i}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00207}00207\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ box,\ rank\ \textcolor{keywordflow}{in}\ boxMap.items():}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ currBox\ \textcolor{keywordflow}{in}\ currRegion:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ intersection,\ remainder\ =\ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_ad4bd21f345e0baaaf925d482efa4d004}{overlayBox}}(currBox,\ box)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00210}00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ intersection\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00211}00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ intersection\ =\ \mbox{\hyperlink{classfontTools_1_1misc_1_1dictTools_1_1hashdict}{hashdict}}(intersection)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00212}00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newMap[intersection]\ =\ newMap.get(intersection,\ 0)\ |\ rank\ |\ currRank}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00213}00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ remainder\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00214}00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ remainder\ =\ \mbox{\hyperlink{classfontTools_1_1misc_1_1dictTools_1_1hashdict}{hashdict}}(remainder)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00215}00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newMap[remainder]\ =\ newMap.get(remainder,\ 0)\ |\ rank}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00216}00216\ \ \ \ \ \ \ \ \ boxMap\ =\ newMap}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00217}00217\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00218}00218\ \ \ \ \ \textcolor{comment}{\#\ Generate\ output}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00219}00219\ \ \ \ \ items\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00220}00220\ \ \ \ \ \textcolor{keywordflow}{for}\ box,\ rank\ \textcolor{keywordflow}{in}\ sorted(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00221}00221\ \ \ \ \ \ \ \ \ boxMap.items(),\ key=(\textcolor{keyword}{lambda}\ BoxAndRank:\ -\/bit\_count(BoxAndRank[1]))}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00222}00222\ \ \ \ \ ):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00223}00223\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Skip\ any\ box\ that\ doesn't\ have\ any\ substitution.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00224}00224\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ rank\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00225}00225\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00226}00226\ \ \ \ \ \ \ \ \ substsList\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00227}00227\ \ \ \ \ \ \ \ \ i\ =\ 0}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00228}00228\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ rank:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00229}00229\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ rank\ \&\ 1:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00230}00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ substsList.append(conditionalSubstitutions[i][1])}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00231}00231\ \ \ \ \ \ \ \ \ \ \ \ \ rank\ >>=\ 1}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00232}00232\ \ \ \ \ \ \ \ \ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00233}00233\ \ \ \ \ \ \ \ \ items.append((dict(box),\ substsList))}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00234}00234\ \ \ \ \ \textcolor{keywordflow}{return}\ items}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00235}00235\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00236}00236\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00237}00237\ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00238}00238\ \textcolor{comment}{\#\ Terminology:}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00239}00239\ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00240}00240\ \textcolor{comment}{\#\ A\ 'Box'\ is\ a\ dict\ representing\ an\ orthogonal\ "{}rectangular"{}\ bit\ of\ N-\/dimensional\ space.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00241}00241\ \textcolor{comment}{\#\ The\ keys\ in\ the\ dict\ are\ axis\ tags,\ the\ values\ are\ (minValue,\ maxValue)\ tuples.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00242}00242\ \textcolor{comment}{\#\ Missing\ dimensions\ (keys)\ are\ substituted\ by\ the\ default\ min\ and\ max\ values}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00243}00243\ \textcolor{comment}{\#\ from\ the\ corresponding\ axes.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00244}00244\ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00245}00245\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00246}00246\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00247}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_ad4bd21f345e0baaaf925d482efa4d004}{00247}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_ad4bd21f345e0baaaf925d482efa4d004}{overlayBox}}(top,\ bot):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00248}00248\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Overlays\ \`{}\`{}top\`{}\`{}\ box\ on\ top\ of\ \`{}\`{}bot\`{}\`{}\ box.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00249}00249\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00250}00250\ \textcolor{stringliteral}{\ \ \ \ Returns\ two\ items:}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00251}00251\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00252}00252\ \textcolor{stringliteral}{\ \ \ \ *\ Box\ for\ intersection\ of\ \`{}\`{}top\`{}\`{}\ and\ \`{}\`{}bot\`{}\`{},\ or\ None\ if\ they\ don't\ intersect.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00253}00253\ \textcolor{stringliteral}{\ \ \ \ *\ Box\ for\ remainder\ of\ \`{}\`{}bot\`{}\`{}.\ \ Remainder\ box\ might\ not\ be\ exact\ (since\ the}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00254}00254\ \textcolor{stringliteral}{\ \ \ \ \ \ remainder\ might\ not\ be\ a\ simple\ box),\ but\ is\ inclusive\ of\ the\ exact}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00255}00255\ \textcolor{stringliteral}{\ \ \ \ \ \ remainder.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00256}00256\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00257}00257\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00258}00258\ \ \ \ \ \textcolor{comment}{\#\ Intersection}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00259}00259\ \ \ \ \ intersection\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00260}00260\ \ \ \ \ intersection.update(top)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00261}00261\ \ \ \ \ intersection.update(bot)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00262}00262\ \ \ \ \ \textcolor{keywordflow}{for}\ axisTag\ \textcolor{keywordflow}{in}\ set(top)\ \&\ set(bot):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00263}00263\ \ \ \ \ \ \ \ \ min1,\ max1\ =\ top[axisTag]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00264}00264\ \ \ \ \ \ \ \ \ min2,\ max2\ =\ bot[axisTag]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00265}00265\ \ \ \ \ \ \ \ \ minimum\ =\ max(min1,\ min2)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00266}00266\ \ \ \ \ \ \ \ \ maximum\ =\ min(max1,\ max2)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00267}00267\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ minimum\ <\ maximum:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00268}00268\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{None},\ bot\ \ \textcolor{comment}{\#\ Do\ not\ intersect}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00269}00269\ \ \ \ \ \ \ \ \ intersection[axisTag]\ =\ minimum,\ maximum}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00270}00270\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00271}00271\ \ \ \ \ \textcolor{comment}{\#\ Remainder}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00272}00272\ \ \ \ \ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00273}00273\ \ \ \ \ \textcolor{comment}{\#\ Remainder\ is\ empty\ if\ bot's\ each\ axis\ range\ lies\ within\ that\ of\ intersection.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00274}00274\ \ \ \ \ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00275}00275\ \ \ \ \ \textcolor{comment}{\#\ Remainder\ is\ shrank\ if\ bot's\ each,\ except\ for\ exactly\ one,\ axis\ range\ lies}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00276}00276\ \ \ \ \ \textcolor{comment}{\#\ within\ that\ of\ intersection,\ and\ that\ one\ axis,\ it\ extrudes\ out\ of\ the}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00277}00277\ \ \ \ \ \textcolor{comment}{\#\ intersection\ only\ on\ one\ side.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00278}00278\ \ \ \ \ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00279}00279\ \ \ \ \ \textcolor{comment}{\#\ Bot\ is\ returned\ in\ full\ as\ remainder\ otherwise,\ as\ true\ remainder\ is\ not}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00280}00280\ \ \ \ \ \textcolor{comment}{\#\ representable\ as\ a\ single\ box.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00281}00281\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00282}00282\ \ \ \ \ remainder\ =\ dict(bot)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00283}00283\ \ \ \ \ extruding\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00284}00284\ \ \ \ \ fullyInside\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00285}00285\ \ \ \ \ \textcolor{keywordflow}{for}\ axisTag\ \textcolor{keywordflow}{in}\ top:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00286}00286\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ axisTag\ \textcolor{keywordflow}{in}\ bot:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00287}00287\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00288}00288\ \ \ \ \ \ \ \ \ extruding\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00289}00289\ \ \ \ \ \ \ \ \ fullyInside\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00290}00290\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00291}00291\ \ \ \ \ \textcolor{keywordflow}{for}\ axisTag\ \textcolor{keywordflow}{in}\ bot:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00292}00292\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ axisTag\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ top:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00293}00293\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}\ \ \textcolor{comment}{\#\ Axis\ range\ lies\ fully\ within}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00294}00294\ \ \ \ \ \ \ \ \ min1,\ max1\ =\ intersection[axisTag]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00295}00295\ \ \ \ \ \ \ \ \ min2,\ max2\ =\ bot[axisTag]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00296}00296\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ min1\ <=\ min2\ \textcolor{keywordflow}{and}\ max2\ <=\ max1:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00297}00297\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}\ \ \textcolor{comment}{\#\ Axis\ range\ lies\ fully\ within}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00298}00298\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00299}00299\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Bot's\ range\ doesn't\ fully\ lie\ within\ that\ of\ top's\ for\ this\ axis.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00300}00300\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ We\ know\ they\ intersect,\ so\ it\ cannot\ lie\ fully\ without\ either;\ so\ they}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00301}00301\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ overlap.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00302}00302\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00303}00303\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ If\ we\ have\ had\ an\ overlapping\ axis\ before,\ remainder\ is\ not}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00304}00304\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ representable\ as\ a\ box,\ so\ return\ full\ bottom\ and\ go\ home.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00305}00305\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ extruding:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00306}00306\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ intersection,\ bot}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00307}00307\ \ \ \ \ \ \ \ \ extruding\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00308}00308\ \ \ \ \ \ \ \ \ fullyInside\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00309}00309\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00310}00310\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Otherwise,\ cut\ remainder\ on\ this\ axis\ and\ continue.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00311}00311\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ min1\ <=\ min2:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00312}00312\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Right\ side\ survives.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00313}00313\ \ \ \ \ \ \ \ \ \ \ \ \ minimum\ =\ max(max1,\ min2)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00314}00314\ \ \ \ \ \ \ \ \ \ \ \ \ maximum\ =\ max2}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00315}00315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ max2\ <=\ max1:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00316}00316\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Left\ side\ survives.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00317}00317\ \ \ \ \ \ \ \ \ \ \ \ \ minimum\ =\ min2}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00318}00318\ \ \ \ \ \ \ \ \ \ \ \ \ maximum\ =\ min(min1,\ max2)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00319}00319\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00320}00320\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Remainder\ leaks\ out\ from\ both\ sides.\ \ Can't\ cut\ either.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00321}00321\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ intersection,\ bot}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00322}00322\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00323}00323\ \ \ \ \ \ \ \ \ remainder[axisTag]\ =\ minimum,\ maximum}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00324}00324\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00325}00325\ \ \ \ \ \textcolor{keywordflow}{if}\ fullyInside:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00326}00326\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ bot\ is\ fully\ within\ intersection.\ \ Remainder\ is\ empty.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00327}00327\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ intersection,\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00328}00328\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00329}00329\ \ \ \ \ \textcolor{keywordflow}{return}\ intersection,\ remainder}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00330}00330\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00331}00331\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00332}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_ab0f4124cf2154bc8fcc734f94b1999d8}{00332}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_ab0f4124cf2154bc8fcc734f94b1999d8}{cleanupBox}}(box):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00333}00333\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Return\ a\ sparse\ copy\ of\ \`{}box\`{},\ without\ redundant\ (default)\ values.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00334}00334\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00335}00335\ \textcolor{stringliteral}{\ \ \ \ >>>\ cleanupBox(\{\})}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00336}00336\ \textcolor{stringliteral}{\ \ \ \ \{\}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00337}00337\ \textcolor{stringliteral}{\ \ \ \ >>>\ cleanupBox(\{'wdth':\ (0.0,\ 1.0)\})}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00338}00338\ \textcolor{stringliteral}{\ \ \ \ \{'wdth':\ (0.0,\ 1.0)\}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00339}00339\ \textcolor{stringliteral}{\ \ \ \ >>>\ cleanupBox(\{'wdth':\ (-\/1.0,\ 1.0)\})}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00340}00340\ \textcolor{stringliteral}{\ \ \ \ \{\}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00341}00341\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00342}00342\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00343}00343\ \ \ \ \ \textcolor{keywordflow}{return}\ \{tag:\ limit\ \textcolor{keywordflow}{for}\ tag,\ limit\ \textcolor{keywordflow}{in}\ box.items()\ \textcolor{keywordflow}{if}\ limit\ !=\ (-\/1.0,\ 1.0)\}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00344}00344\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00345}00345\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00346}00346\ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00347}00347\ \textcolor{comment}{\#\ Low\ level\ implementation}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00348}00348\ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00349}00349\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00350}00350\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00351}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a2db79079995931eaaedf5007c504bf00}{00351}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a2db79079995931eaaedf5007c504bf00}{addFeatureVariationsRaw}}(font,\ table,\ conditionalSubstitutions,\ featureTag="{}rvrn"{}):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00352}00352\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Low\ level\ implementation\ of\ addFeatureVariations\ that\ directly}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00353}00353\ \textcolor{stringliteral}{\ \ \ \ models\ the\ possibilities\ of\ the\ FeatureVariations\ table."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00354}00354\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00355}00355\ \ \ \ \ featureTags\ =\ [featureTag]\ \textcolor{keywordflow}{if}\ isinstance(featureTag,\ str)\ \textcolor{keywordflow}{else}\ sorted(featureTag)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00356}00356\ \ \ \ \ processLast\ =\ \textcolor{stringliteral}{"{}rvrn"{}}\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ featureTags\ \textcolor{keywordflow}{or}\ len(featureTags)\ >\ 1}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00357}00357\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00358}00358\ \ \ \ \ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00359}00359\ \ \ \ \ \textcolor{comment}{\#\ if\ a\ <featureTag>\ feature\ is\ not\ present:}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00360}00360\ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ make\ empty\ <featureTag>\ feature}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00361}00361\ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ sort\ features,\ get\ <featureTag>\ feature\ index}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00362}00362\ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ add\ <featureTag>\ feature\ to\ all\ scripts}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00363}00363\ \ \ \ \ \textcolor{comment}{\#\ if\ a\ <featureTag>\ feature\ is\ present:}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00364}00364\ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ reuse\ <featureTag>\ feature\ index}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00365}00365\ \ \ \ \ \textcolor{comment}{\#\ make\ lookups}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00366}00366\ \ \ \ \ \textcolor{comment}{\#\ add\ feature\ variations}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00367}00367\ \ \ \ \ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00368}00368\ \ \ \ \ \textcolor{keywordflow}{if}\ table.Version\ <\ 0x00010001:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00369}00369\ \ \ \ \ \ \ \ \ table.Version\ =\ 0x00010001\ \ \textcolor{comment}{\#\ allow\ table.FeatureVariations}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00370}00370\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00371}00371\ \ \ \ \ varFeatureIndices\ =\ set()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00372}00372\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00373}00373\ \ \ \ \ existingTags\ =\ \{}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00374}00374\ \ \ \ \ \ \ \ \ feature.FeatureTag}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00375}00375\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ feature\ \textcolor{keywordflow}{in}\ table.FeatureList.FeatureRecord}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00376}00376\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ feature.FeatureTag\ \textcolor{keywordflow}{in}\ featureTags}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00377}00377\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00378}00378\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00379}00379\ \ \ \ \ newTags\ =\ set(featureTags)\ -\/\ existingTags}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00380}00380\ \ \ \ \ \textcolor{keywordflow}{if}\ newTags:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00381}00381\ \ \ \ \ \ \ \ \ varFeatures\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00382}00382\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ featureTag\ \textcolor{keywordflow}{in}\ sorted(newTags):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00383}00383\ \ \ \ \ \ \ \ \ \ \ \ \ varFeature\ =\ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a812b8ccc3d259dce927a918c62ecb05c}{buildFeatureRecord}}(featureTag,\ [])}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00384}00384\ \ \ \ \ \ \ \ \ \ \ \ \ table.FeatureList.FeatureRecord.append(varFeature)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00385}00385\ \ \ \ \ \ \ \ \ \ \ \ \ varFeatures.append(varFeature)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00386}00386\ \ \ \ \ \ \ \ \ table.FeatureList.FeatureCount\ =\ len(table.FeatureList.FeatureRecord)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00387}00387\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00388}00388\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a71bbc76b3ecb3a9ce0dd4de99e99e156}{sortFeatureList}}(table)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00389}00389\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00390}00390\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ varFeature\ \textcolor{keywordflow}{in}\ varFeatures:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00391}00391\ \ \ \ \ \ \ \ \ \ \ \ \ varFeatureIndex\ =\ table.FeatureList.FeatureRecord.index(varFeature)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00392}00392\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00393}00393\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ scriptRecord\ \textcolor{keywordflow}{in}\ table.ScriptList.ScriptRecord:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00394}00394\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ scriptRecord.Script.DefaultLangSys\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00395}00395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ We\ need\ to\ have\ a\ default\ LangSys\ to\ attach\ variations\ to.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00396}00396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ langSys\ =\ ot.LangSys()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00397}00397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ langSys.LookupOrder\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00398}00398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ langSys.ReqFeatureIndex\ =\ 0xFFFF}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00399}00399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ langSys.FeatureIndex\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00400}00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ langSys.FeatureCount\ =\ 0}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00401}00401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ scriptRecord.Script.DefaultLangSys\ =\ langSys}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00402}00402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ langSystems\ =\ [lsr.LangSys\ \textcolor{keywordflow}{for}\ lsr\ \textcolor{keywordflow}{in}\ scriptRecord.Script.LangSysRecord]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00403}00403\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ langSys\ \textcolor{keywordflow}{in}\ [scriptRecord.Script.DefaultLangSys]\ +\ langSystems:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00404}00404\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ langSys.FeatureIndex.append(varFeatureIndex)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00405}00405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ langSys.FeatureCount\ =\ len(langSys.FeatureIndex)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00406}00406\ \ \ \ \ \ \ \ \ \ \ \ \ varFeatureIndices.add(varFeatureIndex)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00407}00407\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00408}00408\ \ \ \ \ \textcolor{keywordflow}{if}\ existingTags:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00409}00409\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ indices\ may\ have\ changed\ if\ we\ inserted\ new\ features\ and\ sorted\ feature\ list}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00410}00410\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ so\ we\ must\ do\ this\ after\ the\ above}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00411}00411\ \ \ \ \ \ \ \ \ varFeatureIndices.update(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00412}00412\ \ \ \ \ \ \ \ \ \ \ \ \ index}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00413}00413\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ index,\ feature\ \textcolor{keywordflow}{in}\ enumerate(table.FeatureList.FeatureRecord)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ feature.FeatureTag\ \textcolor{keywordflow}{in}\ existingTags}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00415}00415\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00416}00416\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00417}00417\ \ \ \ \ axisIndices\ =\ \{}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00418}00418\ \ \ \ \ \ \ \ \ axis.axisTag:\ axisIndex\ \textcolor{keywordflow}{for}\ axisIndex,\ axis\ \textcolor{keywordflow}{in}\ enumerate(font[\textcolor{stringliteral}{"{}fvar"{}}].axes)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00419}00419\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00420}00420\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00421}00421\ \ \ \ \ hasFeatureVariations\ =\ (}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00422}00422\ \ \ \ \ \ \ \ \ hasattr(table,\ \textcolor{stringliteral}{"{}FeatureVariations"{}})\ \textcolor{keywordflow}{and}\ table.FeatureVariations\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00423}00423\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00424}00424\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00425}00425\ \ \ \ \ featureVariationRecords\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00426}00426\ \ \ \ \ \textcolor{keywordflow}{for}\ conditionSet,\ lookupIndices\ \textcolor{keywordflow}{in}\ conditionalSubstitutions:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00427}00427\ \ \ \ \ \ \ \ \ conditionTable\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00428}00428\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ axisTag,\ (minValue,\ maxValue)\ \textcolor{keywordflow}{in}\ sorted(conditionSet.items()):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00429}00429\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ minValue\ >\ maxValue:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00430}00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfontTools_1_1varLib_1_1errors_1_1VarLibValidationError}{VarLibValidationError}}(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00431}00431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}A\ condition\ set\ has\ a\ minimum\ value\ above\ the\ maximum\ value."{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00432}00432\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00433}00433\ \ \ \ \ \ \ \ \ \ \ \ \ ct\ =\ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_acfb52f6a7fb266da42b04dfd886d0b89}{buildConditionTable}}(axisIndices[axisTag],\ minValue,\ maxValue)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00434}00434\ \ \ \ \ \ \ \ \ \ \ \ \ conditionTable.append(ct)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00435}00435\ \ \ \ \ \ \ \ \ records\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00436}00436\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ varFeatureIndex\ \textcolor{keywordflow}{in}\ sorted(varFeatureIndices):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00437}00437\ \ \ \ \ \ \ \ \ \ \ \ \ existingLookupIndices\ =\ table.FeatureList.FeatureRecord[}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00438}00438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ varFeatureIndex}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00439}00439\ \ \ \ \ \ \ \ \ \ \ \ \ ].Feature.LookupListIndex}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00440}00440\ \ \ \ \ \ \ \ \ \ \ \ \ combinedLookupIndices\ =\ (}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00441}00441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ existingLookupIndices\ +\ lookupIndices}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00442}00442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ processLast}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00443}00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ lookupIndices\ +\ existingLookupIndices}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00444}00444\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00445}00445\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00446}00446\ \ \ \ \ \ \ \ \ \ \ \ \ records.append(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00447}00447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_affa50ed71fc354a331f772d998b11bad}{buildFeatureTableSubstitutionRecord}}(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00448}00448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ varFeatureIndex,\ combinedLookupIndices}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00449}00449\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00450}00450\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00451}00451\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hasFeatureVariations\ \textcolor{keywordflow}{and}\ (}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00452}00452\ \ \ \ \ \ \ \ \ \ \ \ \ fvr\ :=\ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a25c4d0f9d0481e4c6d9a976782d9105f}{findFeatureVariationRecord}}(table.FeatureVariations,\ conditionTable)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00453}00453\ \ \ \ \ \ \ \ \ ):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00454}00454\ \ \ \ \ \ \ \ \ \ \ \ \ fvr.FeatureTableSubstitution.SubstitutionRecord.extend(records)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00455}00455\ \ \ \ \ \ \ \ \ \ \ \ \ fvr.FeatureTableSubstitution.SubstitutionCount\ =\ len(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00456}00456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fvr.FeatureTableSubstitution.SubstitutionRecord}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00457}00457\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00458}00458\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00459}00459\ \ \ \ \ \ \ \ \ \ \ \ \ featureVariationRecords.append(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00460}00460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a7f152e80d7e173306b7743e0c808b7aa}{buildFeatureVariationRecord}}(conditionTable,\ records)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00461}00461\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00462}00462\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00463}00463\ \ \ \ \ \textcolor{keywordflow}{if}\ hasFeatureVariations:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00464}00464\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ table.FeatureVariations.Version\ !=\ 0x00010000:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00465}00465\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfontTools_1_1varLib_1_1errors_1_1VarLibError}{VarLibError}}(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00466}00466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Unsupported\ FeatureVariations\ table\ version:\ "{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00467}00467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}0x\{table.FeatureVariations.Version:08x\}\ (expected\ 0x00010000)."{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00468}00468\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00469}00469\ \ \ \ \ \ \ \ \ table.FeatureVariations.FeatureVariationRecord.extend(featureVariationRecords)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00470}00470\ \ \ \ \ \ \ \ \ table.FeatureVariations.FeatureVariationCount\ =\ len(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00471}00471\ \ \ \ \ \ \ \ \ \ \ \ \ table.FeatureVariations.FeatureVariationRecord}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00472}00472\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00473}00473\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00474}00474\ \ \ \ \ \ \ \ \ table.FeatureVariations\ =\ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_abeeec6b6cec97d63c63e8fc438c0457c}{buildFeatureVariations}}(featureVariationRecords)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00475}00475\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00476}00476\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00477}00477\ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00478}00478\ \textcolor{comment}{\#\ Building\ GSUB/FeatureVariations\ internals}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00479}00479\ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00480}00480\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00481}00481\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00482}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_aa3abda32a4614269287cb36afcbeb11e}{00482}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_aa3abda32a4614269287cb36afcbeb11e}{buildGSUB}}():}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00483}00483\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Build\ a\ GSUB\ table\ from\ scratch."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00484}00484\ \ \ \ \ fontTable\ =\ newTable(\textcolor{stringliteral}{"{}GSUB"{}})}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00485}00485\ \ \ \ \ gsub\ =\ fontTable.table\ =\ ot.GSUB()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00486}00486\ \ \ \ \ gsub.Version\ =\ 0x00010001\ \ \textcolor{comment}{\#\ allow\ gsub.FeatureVariations}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00487}00487\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00488}00488\ \ \ \ \ gsub.ScriptList\ =\ ot.ScriptList()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00489}00489\ \ \ \ \ gsub.ScriptList.ScriptRecord\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00490}00490\ \ \ \ \ gsub.FeatureList\ =\ ot.FeatureList()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00491}00491\ \ \ \ \ gsub.FeatureList.FeatureRecord\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00492}00492\ \ \ \ \ gsub.LookupList\ =\ ot.LookupList()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00493}00493\ \ \ \ \ gsub.LookupList.Lookup\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00494}00494\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00495}00495\ \ \ \ \ srec\ =\ ot.ScriptRecord()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00496}00496\ \ \ \ \ srec.ScriptTag\ =\ \textcolor{stringliteral}{"{}DFLT"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00497}00497\ \ \ \ \ srec.Script\ =\ ot.Script()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00498}00498\ \ \ \ \ srec.Script.DefaultLangSys\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00499}00499\ \ \ \ \ srec.Script.LangSysRecord\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00500}00500\ \ \ \ \ srec.Script.LangSysCount\ =\ 0}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00501}00501\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00502}00502\ \ \ \ \ langrec\ =\ ot.LangSysRecord()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00503}00503\ \ \ \ \ langrec.LangSys\ =\ ot.LangSys()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00504}00504\ \ \ \ \ langrec.LangSys.ReqFeatureIndex\ =\ 0xFFFF}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00505}00505\ \ \ \ \ langrec.LangSys.FeatureIndex\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00506}00506\ \ \ \ \ srec.Script.DefaultLangSys\ =\ langrec.LangSys}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00507}00507\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00508}00508\ \ \ \ \ gsub.ScriptList.ScriptRecord.append(srec)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00509}00509\ \ \ \ \ gsub.ScriptList.ScriptCount\ =\ 1}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00510}00510\ \ \ \ \ gsub.FeatureVariations\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00511}00511\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00512}00512\ \ \ \ \ \textcolor{keywordflow}{return}\ fontTable}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00513}00513\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00514}00514\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00515}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_acd511c6d4af6324ff25fa997792aab0b}{00515}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_acd511c6d4af6324ff25fa997792aab0b}{makeSubstitutionsHashable}}(conditionalSubstitutions):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00516}00516\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Turn\ all\ the\ substitution\ dictionaries\ in\ sorted\ tuples\ of\ tuples\ so}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00517}00517\ \textcolor{stringliteral}{\ \ \ \ they\ are\ hashable,\ to\ detect\ duplicates\ so\ we\ don't\ write\ out\ redundant}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00518}00518\ \textcolor{stringliteral}{\ \ \ \ data."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00519}00519\ \ \ \ \ allSubstitutions\ =\ set()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00520}00520\ \ \ \ \ condSubst\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00521}00521\ \ \ \ \ \textcolor{keywordflow}{for}\ conditionSet,\ substitutionMaps\ \textcolor{keywordflow}{in}\ conditionalSubstitutions:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00522}00522\ \ \ \ \ \ \ \ \ substitutions\ =\ []}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00523}00523\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ substitutionMap\ \textcolor{keywordflow}{in}\ substitutionMaps:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00524}00524\ \ \ \ \ \ \ \ \ \ \ \ \ subst\ =\ tuple(sorted(substitutionMap.items()))}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00525}00525\ \ \ \ \ \ \ \ \ \ \ \ \ substitutions.append(subst)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00526}00526\ \ \ \ \ \ \ \ \ \ \ \ \ allSubstitutions.add(subst)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00527}00527\ \ \ \ \ \ \ \ \ condSubst.append((conditionSet,\ substitutions))}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00528}00528\ \ \ \ \ \textcolor{keywordflow}{return}\ condSubst,\ sorted(allSubstitutions)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00529}00529\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00530}00530\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00531}\mbox{\hyperlink{classfontTools_1_1varLib_1_1featureVars_1_1ShifterVisitor}{00531}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classfontTools_1_1varLib_1_1featureVars_1_1ShifterVisitor}{ShifterVisitor}}(\mbox{\hyperlink{classfontTools_1_1ttLib_1_1ttVisitor_1_1TTVisitor}{TTVisitor}}):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00532}00532\ \ \ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(self,\ shift):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00533}00533\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classfontTools_1_1varLib_1_1featureVars_1_1ShifterVisitor_a418c2c3d7340f1ca93d54aa897df7e48}{shift}}\ =\ shift}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00534}00534\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00535}00535\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00536}00536\ \textcolor{preprocessor}{@ShifterVisitor.register\_attr(ot.Feature,\ "{}LookupListIndex"{})}\ \ \textcolor{comment}{\#\ GSUB/GPOS}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00537}00537\ \textcolor{keyword}{def\ }\mbox{\hyperlink{classfontTools_1_1ttLib_1_1ttVisitor_1_1TTVisitor_af89fc6da5e32b6988c3dba1b74252ff5}{visit}}(visitor,\ obj,\ attr,\ value):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00538}00538\ \ \ \ \ shift\ =\ visitor.shift}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00539}00539\ \ \ \ \ value\ =\ [l\ +\ shift\ \textcolor{keywordflow}{for}\ l\ \textcolor{keywordflow}{in}\ value]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00540}00540\ \ \ \ \ setattr(obj,\ attr,\ value)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00541}00541\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00542}00542\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00543}00543\ \textcolor{preprocessor}{@ShifterVisitor.register\_attr}(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00544}00544\ \ \ \ \ (ot.SubstLookupRecord,\ ot.PosLookupRecord),\ \textcolor{stringliteral}{"{}LookupListIndex"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00545}00545\ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00546}00546\ \textcolor{keyword}{def\ }\mbox{\hyperlink{classfontTools_1_1ttLib_1_1ttVisitor_1_1TTVisitor_af89fc6da5e32b6988c3dba1b74252ff5}{visit}}(visitor,\ obj,\ attr,\ value):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00547}00547\ \ \ \ \ setattr(obj,\ attr,\ visitor.shift\ +\ value)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00548}00548\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00549}00549\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00550}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a963078fcf8a17fd5359054e705320fe4}{00550}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a963078fcf8a17fd5359054e705320fe4}{buildSubstitutionLookups}}(gsub,\ allSubstitutions,\ processLast=False):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00551}00551\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Build\ the\ lookups\ for\ the\ glyph\ substitutions,\ return\ a\ dict\ mapping}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00552}00552\ \textcolor{stringliteral}{\ \ \ \ the\ substitution\ to\ lookup\ indices."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00553}00553\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00554}00554\ \ \ \ \ \textcolor{comment}{\#\ Insert\ lookups\ at\ the\ beginning\ of\ the\ lookup\ vector}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00555}00555\ \ \ \ \ \textcolor{comment}{\#\ https://github.com/googlefonts/fontmake/issues/950}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00556}00556\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00557}00557\ \ \ \ \ firstIndex\ =\ len(gsub.LookupList.Lookup)\ \textcolor{keywordflow}{if}\ processLast\ \textcolor{keywordflow}{else}\ 0}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00558}00558\ \ \ \ \ lookupMap\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00559}00559\ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ substitutionMap\ \textcolor{keywordflow}{in}\ enumerate(allSubstitutions):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00560}00560\ \ \ \ \ \ \ \ \ lookupMap[substitutionMap]\ =\ firstIndex\ +\ i}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00561}00561\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00562}00562\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ processLast:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00563}00563\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Shift\ all\ lookup\ indices\ in\ gsub\ by\ len(allSubstitutions)}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00564}00564\ \ \ \ \ \ \ \ \ shift\ =\ len(allSubstitutions)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00565}00565\ \ \ \ \ \ \ \ \ visitor\ =\ \mbox{\hyperlink{classfontTools_1_1varLib_1_1featureVars_1_1ShifterVisitor}{ShifterVisitor}}(shift)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00566}00566\ \ \ \ \ \ \ \ \ visitor.visit(gsub.FeatureList.FeatureRecord)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00567}00567\ \ \ \ \ \ \ \ \ visitor.visit(gsub.LookupList.Lookup)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00568}00568\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00569}00569\ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ subst\ \textcolor{keywordflow}{in}\ enumerate(allSubstitutions):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00570}00570\ \ \ \ \ \ \ \ \ substMap\ =\ dict(subst)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00571}00571\ \ \ \ \ \ \ \ \ lookup\ =\ buildLookup([buildSingleSubstSubtable(substMap)])}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00572}00572\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ processLast:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00573}00573\ \ \ \ \ \ \ \ \ \ \ \ \ gsub.LookupList.Lookup.append(lookup)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00574}00574\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00575}00575\ \ \ \ \ \ \ \ \ \ \ \ \ gsub.LookupList.Lookup.insert(i,\ lookup)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00576}00576\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ gsub.LookupList.Lookup[lookupMap[subst]]\ \textcolor{keywordflow}{is}\ lookup}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00577}00577\ \ \ \ \ gsub.LookupList.LookupCount\ =\ len(gsub.LookupList.Lookup)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00578}00578\ \ \ \ \ \textcolor{keywordflow}{return}\ lookupMap}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00579}00579\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00580}00580\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00581}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_abeeec6b6cec97d63c63e8fc438c0457c}{00581}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_abeeec6b6cec97d63c63e8fc438c0457c}{buildFeatureVariations}}(featureVariationRecords):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00582}00582\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Build\ the\ FeatureVariations\ subtable."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00583}00583\ \ \ \ \ fv\ =\ ot.FeatureVariations()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00584}00584\ \ \ \ \ fv.Version\ =\ 0x00010000}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00585}00585\ \ \ \ \ fv.FeatureVariationRecord\ =\ featureVariationRecords}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00586}00586\ \ \ \ \ fv.FeatureVariationCount\ =\ len(featureVariationRecords)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00587}00587\ \ \ \ \ \textcolor{keywordflow}{return}\ fv}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00588}00588\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00589}00589\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00590}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a812b8ccc3d259dce927a918c62ecb05c}{00590}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a812b8ccc3d259dce927a918c62ecb05c}{buildFeatureRecord}}(featureTag,\ lookupListIndices):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00591}00591\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Build\ a\ FeatureRecord."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00592}00592\ \ \ \ \ fr\ =\ ot.FeatureRecord()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00593}00593\ \ \ \ \ fr.FeatureTag\ =\ featureTag}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00594}00594\ \ \ \ \ fr.Feature\ =\ ot.Feature()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00595}00595\ \ \ \ \ fr.Feature.LookupListIndex\ =\ lookupListIndices}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00596}00596\ \ \ \ \ fr.Feature.populateDefaults()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00597}00597\ \ \ \ \ \textcolor{keywordflow}{return}\ fr}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00598}00598\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00599}00599\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00600}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a7f152e80d7e173306b7743e0c808b7aa}{00600}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a7f152e80d7e173306b7743e0c808b7aa}{buildFeatureVariationRecord}}(conditionTable,\ substitutionRecords):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00601}00601\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Build\ a\ FeatureVariationRecord."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00602}00602\ \ \ \ \ fvr\ =\ ot.FeatureVariationRecord()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00603}00603\ \ \ \ \ \textcolor{keywordflow}{if}\ len(conditionTable)\ !=\ 0:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00604}00604\ \ \ \ \ \ \ \ \ fvr.ConditionSet\ =\ ot.ConditionSet()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00605}00605\ \ \ \ \ \ \ \ \ fvr.ConditionSet.ConditionTable\ =\ conditionTable}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00606}00606\ \ \ \ \ \ \ \ \ fvr.ConditionSet.ConditionCount\ =\ len(conditionTable)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00607}00607\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00608}00608\ \ \ \ \ \ \ \ \ fvr.ConditionSet\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00609}00609\ \ \ \ \ fvr.FeatureTableSubstitution\ =\ ot.FeatureTableSubstitution()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00610}00610\ \ \ \ \ fvr.FeatureTableSubstitution.Version\ =\ 0x00010000}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00611}00611\ \ \ \ \ fvr.FeatureTableSubstitution.SubstitutionRecord\ =\ substitutionRecords}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00612}00612\ \ \ \ \ fvr.FeatureTableSubstitution.SubstitutionCount\ =\ len(substitutionRecords)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00613}00613\ \ \ \ \ \textcolor{keywordflow}{return}\ fvr}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00614}00614\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00615}00615\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00616}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_affa50ed71fc354a331f772d998b11bad}{00616}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_affa50ed71fc354a331f772d998b11bad}{buildFeatureTableSubstitutionRecord}}(featureIndex,\ lookupListIndices):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00617}00617\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Build\ a\ FeatureTableSubstitutionRecord."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00618}00618\ \ \ \ \ ftsr\ =\ ot.FeatureTableSubstitutionRecord()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00619}00619\ \ \ \ \ ftsr.FeatureIndex\ =\ featureIndex}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00620}00620\ \ \ \ \ ftsr.Feature\ =\ ot.Feature()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00621}00621\ \ \ \ \ ftsr.Feature.LookupListIndex\ =\ lookupListIndices}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00622}00622\ \ \ \ \ ftsr.Feature.LookupCount\ =\ len(lookupListIndices)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00623}00623\ \ \ \ \ \textcolor{keywordflow}{return}\ ftsr}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00624}00624\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00625}00625\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00626}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_acfb52f6a7fb266da42b04dfd886d0b89}{00626}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_acfb52f6a7fb266da42b04dfd886d0b89}{buildConditionTable}}(axisIndex,\ filterRangeMinValue,\ filterRangeMaxValue):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00627}00627\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Build\ a\ ConditionTable."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00628}00628\ \ \ \ \ ct\ =\ ot.ConditionTable()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00629}00629\ \ \ \ \ ct.Format\ =\ 1}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00630}00630\ \ \ \ \ ct.AxisIndex\ =\ axisIndex}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00631}00631\ \ \ \ \ ct.FilterRangeMinValue\ =\ filterRangeMinValue}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00632}00632\ \ \ \ \ ct.FilterRangeMaxValue\ =\ filterRangeMaxValue}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00633}00633\ \ \ \ \ \textcolor{keywordflow}{return}\ ct}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00634}00634\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00635}00635\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00636}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a25c4d0f9d0481e4c6d9a976782d9105f}{00636}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a25c4d0f9d0481e4c6d9a976782d9105f}{findFeatureVariationRecord}}(featureVariations,\ conditionTable):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00637}00637\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Find\ a\ FeatureVariationRecord\ that\ has\ the\ same\ conditionTable."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00638}00638\ \ \ \ \ \textcolor{keywordflow}{if}\ featureVariations.Version\ !=\ 0x00010000:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00639}00639\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfontTools_1_1varLib_1_1errors_1_1VarLibError}{VarLibError}}(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00640}00640\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Unsupported\ FeatureVariations\ table\ version:\ "{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00641}00641\ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}0x\{featureVariations.Version:08x\}\ (expected\ 0x00010000)."{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00642}00642\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00643}00643\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00644}00644\ \ \ \ \ \textcolor{keywordflow}{for}\ fvr\ \textcolor{keywordflow}{in}\ featureVariations.FeatureVariationRecord:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00645}00645\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ conditionTable\ ==\ fvr.ConditionSet.ConditionTable:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00646}00646\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ fvr}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00647}00647\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00648}00648\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00649}00649\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00650}00650\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00651}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a71bbc76b3ecb3a9ce0dd4de99e99e156}{00651}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a71bbc76b3ecb3a9ce0dd4de99e99e156}{sortFeatureList}}(table):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00652}00652\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Sort\ the\ feature\ list\ by\ feature\ tag,\ and\ remap\ the\ feature\ indices}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00653}00653\ \textcolor{stringliteral}{\ \ \ \ elsewhere.\ This\ is\ needed\ after\ the\ feature\ list\ has\ been\ modified.}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00654}00654\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00655}00655\ \ \ \ \ \textcolor{comment}{\#\ decorate,\ sort,\ undecorate,\ because\ we\ need\ to\ make\ an\ index\ remapping\ table}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00656}00656\ \ \ \ \ tagIndexFea\ =\ [}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00657}00657\ \ \ \ \ \ \ \ \ (fea.FeatureTag,\ index,\ fea)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00658}00658\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ index,\ fea\ \textcolor{keywordflow}{in}\ enumerate(table.FeatureList.FeatureRecord)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00659}00659\ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00660}00660\ \ \ \ \ tagIndexFea.sort()}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00661}00661\ \ \ \ \ table.FeatureList.FeatureRecord\ =\ [fea\ \textcolor{keywordflow}{for}\ tag,\ index,\ fea\ \textcolor{keywordflow}{in}\ tagIndexFea]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00662}00662\ \ \ \ \ featureRemap\ =\ dict(}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00663}00663\ \ \ \ \ \ \ \ \ zip([index\ \textcolor{keywordflow}{for}\ tag,\ index,\ fea\ \textcolor{keywordflow}{in}\ tagIndexFea],\ range(len(tagIndexFea)))}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00664}00664\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00665}00665\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00666}00666\ \ \ \ \ \textcolor{comment}{\#\ Remap\ the\ feature\ indices}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00667}00667\ \ \ \ \ \mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a0dca2df9f8535a3e301d2520a9af8561}{remapFeatures}}(table,\ featureRemap)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00668}00668\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00669}00669\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00670}\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a0dca2df9f8535a3e301d2520a9af8561}{00670}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1varLib_1_1featureVars_a0dca2df9f8535a3e301d2520a9af8561}{remapFeatures}}(table,\ featureRemap):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00671}00671\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Go\ through\ the\ scripts\ list,\ and\ remap\ feature\ indices."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00672}00672\ \ \ \ \ \textcolor{keywordflow}{for}\ scriptIndex,\ script\ \textcolor{keywordflow}{in}\ enumerate(table.ScriptList.ScriptRecord):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00673}00673\ \ \ \ \ \ \ \ \ defaultLangSys\ =\ script.Script.DefaultLangSys}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00674}00674\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ defaultLangSys\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00675}00675\ \ \ \ \ \ \ \ \ \ \ \ \ \_remapLangSys(defaultLangSys,\ featureRemap)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00676}00676\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ langSysRecordIndex,\ langSysRec\ \textcolor{keywordflow}{in}\ enumerate(script.Script.LangSysRecord):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00677}00677\ \ \ \ \ \ \ \ \ \ \ \ \ langSys\ =\ langSysRec.LangSys}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00678}00678\ \ \ \ \ \ \ \ \ \ \ \ \ \_remapLangSys(langSys,\ featureRemap)}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00679}00679\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00680}00680\ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(table,\ \textcolor{stringliteral}{"{}FeatureVariations"{}})\ \textcolor{keywordflow}{and}\ table.FeatureVariations\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00681}00681\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ fvr\ \textcolor{keywordflow}{in}\ table.FeatureVariations.FeatureVariationRecord:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00682}00682\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ ftsr\ \textcolor{keywordflow}{in}\ fvr.FeatureTableSubstitution.SubstitutionRecord:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00683}00683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ftsr.FeatureIndex\ =\ featureRemap[ftsr.FeatureIndex]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00684}00684\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00685}00685\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00686}00686\ \textcolor{keyword}{def\ }\_remapLangSys(langSys,\ featureRemap):}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00687}00687\ \ \ \ \ \textcolor{keywordflow}{if}\ langSys.ReqFeatureIndex\ !=\ 0xFFFF:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00688}00688\ \ \ \ \ \ \ \ \ langSys.ReqFeatureIndex\ =\ featureRemap[langSys.ReqFeatureIndex]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00689}00689\ \ \ \ \ langSys.FeatureIndex\ =\ [featureRemap[index]\ \textcolor{keywordflow}{for}\ index\ \textcolor{keywordflow}{in}\ langSys.FeatureIndex]}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00690}00690\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00691}00691\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00692}00692\ \textcolor{keywordflow}{if}\ \_\_name\_\_\ ==\ \textcolor{stringliteral}{"{}\_\_main\_\_"{}}:}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00693}00693\ \ \ \ \ \textcolor{keyword}{import}\ doctest,\ sys}
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00694}00694\ }
\DoxyCodeLine{\Hypertarget{featureVars_8py_source_l00695}00695\ \ \ \ \ sys.exit(doctest.testmod().failed)}

\end{DoxyCode}
