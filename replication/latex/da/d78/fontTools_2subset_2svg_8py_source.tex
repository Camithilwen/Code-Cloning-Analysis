\doxysection{svg.\+py}
\hypertarget{fontTools_2subset_2svg_8py_source}{}\label{fontTools_2subset_2svg_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/fontTools/subset/svg.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/fontTools/subset/svg.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00001}\mbox{\hyperlink{namespacefontTools_1_1subset_1_1svg}{00001}}\ \textcolor{keyword}{from}\ \_\_future\_\_\ \textcolor{keyword}{import}\ annotations}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00003}00003\ \textcolor{keyword}{import}\ re}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00004}00004\ \textcolor{keyword}{from}\ functools\ \textcolor{keyword}{import}\ lru\_cache}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00005}00005\ \textcolor{keyword}{from}\ itertools\ \textcolor{keyword}{import}\ chain,\ count}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00006}00006\ \textcolor{keyword}{from}\ typing\ \textcolor{keyword}{import}\ Dict,\ Iterable,\ Iterator,\ List,\ Optional,\ Set,\ Tuple}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00008}00008\ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00009}00009\ \ \ \ \ \textcolor{keyword}{from}\ lxml\ \textcolor{keyword}{import}\ etree}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00010}00010\ \textcolor{keywordflow}{except}\ ImportError:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00011}00011\ \ \ \ \ \textcolor{comment}{\#\ lxml\ is\ required\ for\ subsetting\ SVG,\ but\ we\ prefer\ to\ delay\ the\ import\ error}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00012}00012\ \ \ \ \ \textcolor{comment}{\#\ until\ subset\_glyphs()\ is\ called\ (i.e.\ if\ font\ to\ subset\ has\ an\ 'SVG\ '\ table)}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00013}00013\ \ \ \ \ etree\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00015}00015\ \textcolor{keyword}{from}\ fontTools\ \textcolor{keyword}{import}\ ttLib}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00016}00016\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1subset_1_1util}{fontTools.subset.util}}\ \textcolor{keyword}{import}\ \_add\_method}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00017}00017\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1ttLib_1_1tables_1_1S__V__G__}{fontTools.ttLib.tables.S\_V\_G\_}}\ \textcolor{keyword}{import}\ SVGDocument}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00020}00020\ \_\_all\_\_\ =\ [\textcolor{stringliteral}{"{}subset\_glyphs"{}}]}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00022}00022\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00023}00023\ GID\_RE\ =\ re.compile(\textcolor{stringliteral}{r"{}\string^glyph(\(\backslash\)d+)\$"{}})}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00025}00025\ NAMESPACES\ =\ \{}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00026}00026\ \ \ \ \ \textcolor{stringliteral}{"{}svg"{}}:\ \textcolor{stringliteral}{"{}http://www.w3.org/2000/svg"{}},}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00027}00027\ \ \ \ \ \textcolor{stringliteral}{"{}xlink"{}}:\ \textcolor{stringliteral}{"{}http://www.w3.org/1999/xlink"{}},}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00028}00028\ \}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00029}00029\ XLINK\_HREF\ =\ f\textcolor{stringliteral}{'\{\{\{NAMESPACES["{}xlink"{}]\}\}\}href'}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00030}00030\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00032}00032\ \textcolor{comment}{\#\ TODO(antrotype):\ Replace\ with\ functools.cache\ once\ we\ are\ 3.9+}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00033}00033\ \textcolor{preprocessor}{@lru\_cache(maxsize=None)}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00034}00034\ \textcolor{keyword}{def\ }xpath(path):}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00035}00035\ \ \ \ \ \textcolor{comment}{\#\ compile\ XPath\ upfront,\ caching\ result\ to\ reuse\ on\ multiple\ elements}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00036}00036\ \ \ \ \ \textcolor{keywordflow}{return}\ etree.XPath(path,\ namespaces=NAMESPACES)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00039}00039\ \textcolor{keyword}{def\ }group\_elements\_by\_id(tree:\ etree.Element)\ -\/>\ Dict[str,\ etree.Element]:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00040}00040\ \ \ \ \ \textcolor{comment}{\#\ select\ all\ svg\ elements\ with\ 'id'\ attribute\ no\ matter\ where\ they\ are}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00041}00041\ \ \ \ \ \textcolor{comment}{\#\ including\ the\ root\ element\ itself:}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00042}00042\ \ \ \ \ \textcolor{comment}{\#\ https://github.com/fonttools/fonttools/issues/2548}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00043}00043\ \ \ \ \ \textcolor{keywordflow}{return}\ \{el.attrib[\textcolor{stringliteral}{"{}id"{}}]:\ el\ \textcolor{keywordflow}{for}\ el\ \textcolor{keywordflow}{in}\ xpath(\textcolor{stringliteral}{"{}//svg:*[@id]"{}})(tree)\}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00045}00045\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00046}00046\ \textcolor{keyword}{def\ }parse\_css\_declarations(style\_attr:\ str)\ -\/>\ Dict[str,\ str]:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00047}00047\ \ \ \ \ \textcolor{comment}{\#\ https://developer.mozilla.org/en-\/US/docs/Web/SVG/Attribute/style}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00048}00048\ \ \ \ \ \textcolor{comment}{\#\ https://developer.mozilla.org/en-\/US/docs/Web/CSS/Syntax\#css\_declarations}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00049}00049\ \ \ \ \ result\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00050}00050\ \ \ \ \ \textcolor{keywordflow}{for}\ declaration\ \textcolor{keywordflow}{in}\ style\_attr.split(\textcolor{stringliteral}{"{};"{}}):}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ declaration.count(\textcolor{stringliteral}{"{}:"{}})\ ==\ 1:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ property\_name,\ value\ =\ declaration.split(\textcolor{stringliteral}{"{}:"{}})}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ property\_name\ =\ property\_name.strip()}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ result[property\_name]\ =\ value.strip()}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ declaration.strip():}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classValueError}{ValueError}}(f\textcolor{stringliteral}{"{}Invalid\ CSS\ declaration\ syntax:\ \{declaration\}"{}})}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00057}00057\ \ \ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00058}00058\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00060}00060\ \textcolor{keyword}{def\ }iter\_referenced\_ids(tree:\ etree.Element)\ -\/>\ Iterator[str]:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00061}00061\ \ \ \ \ \textcolor{comment}{\#\ Yield\ all\ the\ ids\ that\ can\ be\ reached\ via\ references\ from\ this\ element\ tree.}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00062}00062\ \ \ \ \ \textcolor{comment}{\#\ We\ currently\ support\ xlink:href\ (as\ used\ by\ <use>\ and\ gradient\ templates),}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00063}00063\ \ \ \ \ \textcolor{comment}{\#\ and\ local\ url(\#...)\ links\ found\ in\ fill\ or\ clip-\/path\ attributes}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00064}00064\ \ \ \ \ \textcolor{comment}{\#\ TODO(anthrotype):\ Check\ we\ aren't\ missing\ other\ supported\ kinds\ of\ reference}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00065}00065\ \ \ \ \ find\_svg\_elements\_with\_references\ =\ xpath(}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00066}00066\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}.//svg:*[\ "{}}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}starts-\/with(@xlink:href,\ '\#')\ "{}}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00068}00068\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}or\ starts-\/with(@fill,\ 'url(\#')\ "{}}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00069}00069\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}or\ starts-\/with(@clip-\/path,\ 'url(\#')\ "{}}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}or\ contains(@style,\ ':url(\#')\ "{}}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00071}00071\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}]"{}},}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00072}00072\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00073}00073\ \ \ \ \ \textcolor{keywordflow}{for}\ el\ \textcolor{keywordflow}{in}\ chain([tree],\ find\_svg\_elements\_with\_references(tree)):}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00074}00074\ \ \ \ \ \ \ \ \ ref\_id\ =\ href\_local\_target(el)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00075}00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ref\_id\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ ref\_id}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00077}00077\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ attrs\ =\ el.attrib}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00079}00079\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}style"{}}\ \textcolor{keywordflow}{in}\ attrs:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ attrs\ =\ \{**dict(attrs),\ **parse\_css\_declarations(el.attrib[\textcolor{stringliteral}{"{}style"{}}])\}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00081}00081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ attr\ \textcolor{keywordflow}{in}\ (\textcolor{stringliteral}{"{}fill"{}},\ \textcolor{stringliteral}{"{}clip-\/path"{}}):}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ attr\ \textcolor{keywordflow}{in}\ attrs:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ value\ =\ attrs[attr]}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ value.startswith(\textcolor{stringliteral}{"{}url(\#"{}})\ \textcolor{keywordflow}{and}\ value.endswith(\textcolor{stringliteral}{"{})"{}}):}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ref\_id\ =\ value[5:-\/1]}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ ref\_id}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ ref\_id}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00088}00088\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00089}00089\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00090}00090\ \textcolor{keyword}{def\ }closure\_element\_ids(}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00091}00091\ \ \ \ \ elements:\ Dict[str,\ etree.Element],\ element\_ids:\ Set[str]}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00092}00092\ )\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00093}00093\ \ \ \ \ \textcolor{comment}{\#\ Expand\ the\ initial\ subset\ of\ element\ ids\ to\ include\ ids\ that\ can\ be\ reached}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00094}00094\ \ \ \ \ \textcolor{comment}{\#\ via\ references\ from\ the\ initial\ set.}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00095}00095\ \ \ \ \ unvisited\ =\ element\_ids}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00096}00096\ \ \ \ \ \textcolor{keywordflow}{while}\ unvisited:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00097}00097\ \ \ \ \ \ \ \ \ referenced:\ Set[str]\ =\ set()}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00098}00098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ el\_id\ \textcolor{keywordflow}{in}\ unvisited:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ el\_id\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ elements:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ ignore\ dangling\ reference;\ not\ our\ job\ to\ validate\ svg}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00102}00102\ \ \ \ \ \ \ \ \ \ \ \ \ referenced.update(iter\_referenced\_ids(elements[el\_id]))}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ referenced\ -\/=\ element\_ids}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00104}00104\ \ \ \ \ \ \ \ \ element\_ids.update(referenced)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00105}00105\ \ \ \ \ \ \ \ \ unvisited\ =\ referenced}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00106}00106\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00107}00107\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00108}00108\ \textcolor{keyword}{def\ }subset\_elements(el:\ etree.Element,\ retained\_ids:\ Set[str])\ -\/>\ bool:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00109}00109\ \ \ \ \ \textcolor{comment}{\#\ Keep\ elements\ if\ their\ id\ is\ in\ the\ subset,\ or\ any\ of\ their\ children's\ id\ is.}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00110}00110\ \ \ \ \ \textcolor{comment}{\#\ Drop\ elements\ whose\ id\ is\ not\ in\ the\ subset,\ and\ either\ have\ no\ children,}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00111}00111\ \ \ \ \ \textcolor{comment}{\#\ or\ all\ their\ children\ are\ being\ dropped.}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00112}00112\ \ \ \ \ \textcolor{keywordflow}{if}\ el.attrib.get(\textcolor{stringliteral}{"{}id"{}})\ \textcolor{keywordflow}{in}\ retained\_ids:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00113}00113\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ if\ id\ is\ in\ the\ set,\ don't\ recurse;\ keep\ whole\ subtree}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00114}00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00115}00115\ \ \ \ \ \textcolor{comment}{\#\ recursively\ subset\ all\ the\ children;\ we\ use\ a\ list\ comprehension\ instead}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00116}00116\ \ \ \ \ \textcolor{comment}{\#\ of\ a\ parentheses-\/less\ generator\ expression\ because\ we\ don't\ want\ any()\ to}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00117}00117\ \ \ \ \ \textcolor{comment}{\#\ short-\/circuit,\ as\ our\ function\ has\ a\ side\ effect\ of\ dropping\ empty\ elements.}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00118}00118\ \ \ \ \ \textcolor{keywordflow}{if}\ any([subset\_elements(e,\ retained\_ids)\ \textcolor{keywordflow}{for}\ e\ \textcolor{keywordflow}{in}\ el]):}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00119}00119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00120}00120\ \ \ \ \ \textcolor{keyword}{assert}\ len(el)\ ==\ 0}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00121}00121\ \ \ \ \ parent\ =\ el.getparent()}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00122}00122\ \ \ \ \ \textcolor{keywordflow}{if}\ parent\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00123}00123\ \ \ \ \ \ \ \ \ parent.remove(el)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00124}00124\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00125}00125\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00126}00126\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00127}00127\ \textcolor{keyword}{def\ }remap\_glyph\_ids(}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00128}00128\ \ \ \ \ svg:\ etree.Element,\ glyph\_index\_map:\ Dict[int,\ int]}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00129}00129\ )\ -\/>\ Dict[str,\ str]:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00130}00130\ \ \ \ \ \textcolor{comment}{\#\ Given\ \{old\_gid:\ new\_gid\}\ map,\ rename\ all\ elements\ containing\ id="{}glyph\{gid\}"{}}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00131}00131\ \ \ \ \ \textcolor{comment}{\#\ special\ attributes}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00132}00132\ \ \ \ \ elements\ =\ group\_elements\_by\_id(svg)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00133}00133\ \ \ \ \ id\_map\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00134}00134\ \ \ \ \ \textcolor{keywordflow}{for}\ el\_id,\ el\ \textcolor{keywordflow}{in}\ elements.items():}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00135}00135\ \ \ \ \ \ \ \ \ m\ =\ GID\_RE.match(el\_id)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00136}00136\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ m:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ old\_index\ =\ int(m.group(1))}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00139}00139\ \ \ \ \ \ \ \ \ new\_index\ =\ glyph\_index\_map.get(old\_index)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00140}00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ new\_index\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00141}00141\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ old\_index\ ==\ new\_index:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00142}00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00143}00143\ \ \ \ \ \ \ \ \ \ \ \ \ new\_id\ =\ f\textcolor{stringliteral}{"{}glyph\{new\_index\}"{}}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00144}00144\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ If\ the\ old\ index\ is\ missing,\ the\ element\ correspond\ to\ a\ glyph\ that\ was}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00146}00146\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ excluded\ from\ the\ font's\ subset.}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ We\ rename\ it\ to\ avoid\ clashes\ with\ the\ new\ GIDs\ or\ other\ element\ ids.}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00148}00148\ \ \ \ \ \ \ \ \ \ \ \ \ new\_id\ =\ f\textcolor{stringliteral}{"{}.\{el\_id\}"{}}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ n\ =\ count(1)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00150}00150\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ new\_id\ \textcolor{keywordflow}{in}\ elements:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00151}00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_id\ =\ f\textcolor{stringliteral}{"{}\{new\_id\}.\{next(n)\}"{}}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00152}00152\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00153}00153\ \ \ \ \ \ \ \ \ id\_map[el\_id]\ =\ new\_id}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00154}00154\ \ \ \ \ \ \ \ \ el.attrib[\textcolor{stringliteral}{"{}id"{}}]\ =\ new\_id}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00155}00155\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00156}00156\ \ \ \ \ \textcolor{keywordflow}{return}\ id\_map}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00157}00157\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00159}00159\ \textcolor{keyword}{def\ }href\_local\_target(el:\ etree.Element)\ -\/>\ Optional[str]:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00160}00160\ \ \ \ \ \textcolor{keywordflow}{if}\ XLINK\_HREF\ \textcolor{keywordflow}{in}\ el.attrib:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00161}00161\ \ \ \ \ \ \ \ \ href\ =\ el.attrib[XLINK\_HREF]}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00162}00162\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ href.startswith(\textcolor{stringliteral}{"{}\#"{}})\ \textcolor{keywordflow}{and}\ len(href)\ >\ 1:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00163}00163\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ href[1:]\ \ \textcolor{comment}{\#\ drop\ the\ leading\ \#}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00164}00164\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00166}00166\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00167}00167\ \textcolor{keyword}{def\ }update\_glyph\_href\_links(svg:\ etree.Element,\ id\_map:\ Dict[str,\ str])\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00168}00168\ \ \ \ \ \textcolor{comment}{\#\ update\ all\ xlink:href="{}\#glyph..."{}\ attributes\ to\ point\ to\ the\ new\ glyph\ ids}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00169}00169\ \ \ \ \ \textcolor{keywordflow}{for}\ el\ \textcolor{keywordflow}{in}\ xpath(\textcolor{stringliteral}{"{}.//svg:*[starts-\/with(@xlink:href,\ '\#glyph')]"{}})(svg):}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00170}00170\ \ \ \ \ \ \ \ \ old\_id\ =\ href\_local\_target(el)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00171}00171\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ old\_id\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00172}00172\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ old\_id\ \textcolor{keywordflow}{in}\ id\_map:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \ \ \ new\_id\ =\ id\_map[old\_id]}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \ \ \ el.attrib[XLINK\_HREF]\ =\ f\textcolor{stringliteral}{"{}\#\{new\_id\}"{}}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00175}00175\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00176}00176\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00177}00177\ \textcolor{keyword}{def\ }ranges(ints:\ Iterable[int])\ -\/>\ Iterator[Tuple[int,\ int]]:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00178}00178\ \ \ \ \ \textcolor{comment}{\#\ Yield\ sorted,\ non-\/overlapping\ (min,\ max)\ ranges\ of\ consecutive\ integers}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00179}00179\ \ \ \ \ sorted\_ints\ =\ iter(sorted(set(ints)))}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00180}00180\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00181}00181\ \ \ \ \ \ \ \ \ start\ =\ end\ =\ next(sorted\_ints)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00182}00182\ \ \ \ \ \textcolor{keywordflow}{except}\ StopIteration:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00183}00183\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00184}00184\ \ \ \ \ \textcolor{keywordflow}{for}\ v\ \textcolor{keywordflow}{in}\ sorted\_ints:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00185}00185\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ v\ -\/\ 1\ ==\ end:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00186}00186\ \ \ \ \ \ \ \ \ \ \ \ \ end\ =\ v}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00187}00187\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00188}00188\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ (start,\ end)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \ \ \ start\ =\ end\ =\ v}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00190}00190\ \ \ \ \ \textcolor{keywordflow}{yield}\ (start,\ end)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00191}00191\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00193}00193\ \textcolor{preprocessor}{@\_add\_method(ttLib.getTableClass("{}SVG\ "{})})}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00194}00194\ \textcolor{keyword}{def\ }subset\_glyphs(self,\ s)\ -\/>\ bool:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00195}00195\ \ \ \ \ \textcolor{keywordflow}{if}\ etree\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00196}00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classImportError}{ImportError}}(\textcolor{stringliteral}{"{}No\ module\ named\ 'lxml',\ required\ to\ subset\ SVG"{}})}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00197}00197\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00198}00198\ \ \ \ \ \textcolor{comment}{\#\ glyph\ names\ (before\ subsetting)}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00199}00199\ \ \ \ \ glyph\_order:\ List[str]\ =\ s.orig\_glyph\_order}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00200}00200\ \ \ \ \ \textcolor{comment}{\#\ map\ from\ glyph\ names\ to\ original\ glyph\ indices}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00201}00201\ \ \ \ \ rev\_orig\_glyph\_map:\ Dict[str,\ int]\ =\ s.reverseOrigGlyphMap}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00202}00202\ \ \ \ \ \textcolor{comment}{\#\ map\ from\ original\ to\ new\ glyph\ indices\ (after\ subsetting)}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00203}00203\ \ \ \ \ glyph\_index\_map:\ Dict[int,\ int]\ =\ s.glyph\_index\_map}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00204}00204\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00205}00205\ \ \ \ \ new\_docs:\ List[SVGDocument]\ =\ []}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00206}00206\ \ \ \ \ \textcolor{keywordflow}{for}\ doc\ \textcolor{keywordflow}{in}\ self.docList:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00207}00207\ \ \ \ \ \ \ \ \ glyphs\ =\ \{}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ glyph\_order[i]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(doc.startGlyphID,\ doc.endGlyphID\ +\ 1)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00209}00209\ \ \ \ \ \ \ \ \ \}.intersection(s.glyphs)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00210}00210\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ glyphs:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00211}00211\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ no\ intersection:\ we\ can\ drop\ the\ whole\ record}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00212}00212\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00213}00213\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00214}00214\ \ \ \ \ \ \ \ \ svg\ =\ etree.fromstring(}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00215}00215\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ encode\ because\ fromstring\ dislikes\ xml\ encoding\ decl\ if\ input\ is\ str.}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00216}00216\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ SVG\ xml\ encoding\ must\ be\ utf-\/8\ as\ per\ OT\ spec.}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00217}00217\ \ \ \ \ \ \ \ \ \ \ \ \ doc.data.encode(\textcolor{stringliteral}{"{}utf-\/8"{}}),}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00218}00218\ \ \ \ \ \ \ \ \ \ \ \ \ parser=etree.XMLParser(}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00219}00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Disable\ libxml2\ security\ restrictions\ to\ support\ very\ deep\ trees.}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00220}00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Without\ this\ we\ would\ get\ an\ error\ like\ this:}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00221}00221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \`{}lxml.etree.XMLSyntaxError:\ internal\ error:\ Huge\ input\ lookup`}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00222}00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ when\ parsing\ big\ fonts\ e.g.\ noto-\/emoji-\/picosvg.ttf.}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00223}00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ huge\_tree=\textcolor{keyword}{True},}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00224}00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ ignore\ blank\ text\ as\ it's\ not\ meaningful\ in\ OT-\/SVG;\ it\ also\ prevents}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00225}00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ dangling\ tail\ text\ after\ removing\ an\ element\ when\ pretty\_print=True}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00226}00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ remove\_blank\_text=\textcolor{keyword}{True},}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00227}00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ don't\ replace\ entities;\ we\ don't\ expect\ any\ in\ OT-\/SVG\ and\ they\ may}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00228}00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ be\ abused\ for\ XXE\ attacks}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00229}00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ resolve\_entities=\textcolor{keyword}{False},}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00230}00230\ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00231}00231\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00232}00232\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00233}00233\ \ \ \ \ \ \ \ \ elements\ =\ group\_elements\_by\_id(svg)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00234}00234\ \ \ \ \ \ \ \ \ gids\ =\ \{rev\_orig\_glyph\_map[g]\ \textcolor{keywordflow}{for}\ g\ \textcolor{keywordflow}{in}\ glyphs\}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00235}00235\ \ \ \ \ \ \ \ \ element\_ids\ =\ \{f\textcolor{stringliteral}{"{}glyph\{i\}"{}}\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ gids\}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00236}00236\ \ \ \ \ \ \ \ \ closure\_element\_ids(elements,\ element\_ids)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00237}00237\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00238}00238\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ subset\_elements(svg,\ element\_ids):}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00239}00239\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00240}00240\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00241}00241\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ s.options.retain\_gids:}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00242}00242\ \ \ \ \ \ \ \ \ \ \ \ \ id\_map\ =\ remap\_glyph\_ids(svg,\ glyph\_index\_map)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00243}00243\ \ \ \ \ \ \ \ \ \ \ \ \ update\_glyph\_href\_links(svg,\ id\_map)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00244}00244\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00245}00245\ \ \ \ \ \ \ \ \ new\_doc\ =\ etree.tostring(svg,\ pretty\_print=s.options.pretty\_svg).decode(\textcolor{stringliteral}{"{}utf-\/8"{}})}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00246}00246\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00247}00247\ \ \ \ \ \ \ \ \ new\_gids\ =\ (glyph\_index\_map[i]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ gids)}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00248}00248\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ start,\ end\ \textcolor{keywordflow}{in}\ ranges(new\_gids):}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00249}00249\ \ \ \ \ \ \ \ \ \ \ \ \ new\_docs.append(\mbox{\hyperlink{classfontTools_1_1ttLib_1_1tables_1_1S__V__G___1_1SVGDocument}{SVGDocument}}(new\_doc,\ start,\ end,\ doc.compressed))}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00250}00250\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00251}00251\ \ \ \ \ self.docList\ =\ new\_docs}
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00252}00252\ }
\DoxyCodeLine{\Hypertarget{fontTools_2subset_2svg_8py_source_l00253}00253\ \ \ \ \ \textcolor{keywordflow}{return}\ bool(self.docList)}

\end{DoxyCode}
