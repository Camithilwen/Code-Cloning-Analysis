\doxysection{spawn.\+py}
\hypertarget{spawn_8py_source}{}\label{spawn_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/joblib/externals/loky/backend/spawn.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/joblib/externals/loky/backend/spawn.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00001}\mbox{\hyperlink{namespacejoblib_1_1externals_1_1loky_1_1backend_1_1spawn}{00001}}\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00009}00009\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00010}00010\ \textcolor{keyword}{import}\ sys}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00011}00011\ \textcolor{keyword}{import}\ runpy}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00012}00012\ \textcolor{keyword}{import}\ textwrap}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00013}00013\ \textcolor{keyword}{import}\ types}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00014}00014\ \textcolor{keyword}{from}\ multiprocessing\ \textcolor{keyword}{import}\ process,\ util}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00017}00017\ \textcolor{keywordflow}{if}\ sys.platform\ !=\ \textcolor{stringliteral}{"{}win32"{}}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00018}00018\ \ \ \ \ WINEXE\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00019}00019\ \ \ \ \ WINSERVICE\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00020}00020\ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00021}00021\ \ \ \ \ \textcolor{keyword}{import}\ msvcrt}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00022}00022\ \ \ \ \ \textcolor{keyword}{from}\ multiprocessing.reduction\ \textcolor{keyword}{import}\ duplicate}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00023}00023\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00024}00024\ \ \ \ \ WINEXE\ =\ sys.platform\ ==\ \textcolor{stringliteral}{"{}win32"{}}\ \textcolor{keywordflow}{and}\ getattr(sys,\ \textcolor{stringliteral}{"{}frozen"{}},\ \textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00025}00025\ \ \ \ \ WINSERVICE\ =\ sys.executable.lower().endswith(\textcolor{stringliteral}{"{}pythonservice.exe"{}})}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00027}00027\ \textcolor{keywordflow}{if}\ WINSERVICE:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00028}00028\ \ \ \ \ \_python\_exe\ =\ os.path.join(sys.exec\_prefix,\ \textcolor{stringliteral}{"{}python.exe"{}})}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00029}00029\ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00030}00030\ \ \ \ \ \_python\_exe\ =\ sys.executable}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00033}00033\ \textcolor{keyword}{def\ }get\_executable():}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00034}00034\ \ \ \ \ \textcolor{keywordflow}{return}\ \_python\_exe}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00037}00037\ \textcolor{keyword}{def\ }\_check\_not\_importing\_main():}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00038}00038\ \ \ \ \ \textcolor{keywordflow}{if}\ getattr(process.current\_process(),\ \textcolor{stringliteral}{"{}\_inheriting"{}},\ \textcolor{keyword}{False}):}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00039}00039\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classRuntimeError}{RuntimeError}}(}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00040}00040\ \ \ \ \ \ \ \ \ \ \ \ \ textwrap.dedent(}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00041}00041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}\(\backslash\)}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00042}00042\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ An\ attempt\ has\ been\ made\ to\ start\ a\ new\ process\ before\ the}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00043}00043\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ current\ process\ has\ finished\ its\ bootstrapping\ phase.}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00044}00044\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00045}00045\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ This\ probably\ means\ that\ you\ are\ not\ using\ fork\ to\ start\ your}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00046}00046\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ child\ processes\ and\ you\ have\ forgotten\ to\ use\ the\ proper\ idiom}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00047}00047\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ in\ the\ main\ module:}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00048}00048\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00049}00049\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ \_\_name\_\_\ ==\ '\_\_main\_\_':}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00050}00050\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ freeze\_support()}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00051}00051\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ...}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00052}00052\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00053}00053\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ The\ "{}freeze\_support()"{}\ line\ can\ be\ omitted\ if\ the\ program}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00054}00054\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ is\ not\ going\ to\ be\ frozen\ to\ produce\ an\ executable."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00057}00057\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00058}00058\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00059}\mbox{\hyperlink{namespacejoblib_1_1externals_1_1loky_1_1backend_1_1spawn_a4c4a90aef694d7a15eed39a6d897df8d}{00059}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacejoblib_1_1externals_1_1loky_1_1backend_1_1spawn_a4c4a90aef694d7a15eed39a6d897df8d}{get\_preparation\_data}}(name,\ init\_main\_module=True):}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00060}00060\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Return\ info\ about\ parent\ needed\ by\ child\ to\ unpickle\ process\ object."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00061}00061\ \ \ \ \ \_check\_not\_importing\_main()}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00062}00062\ \ \ \ \ d\ =\ dict(}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00063}00063\ \ \ \ \ \ \ \ \ log\_to\_stderr=util.\_log\_to\_stderr,}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00064}00064\ \ \ \ \ \ \ \ \ authkey=bytes(process.current\_process().authkey),}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00065}00065\ \ \ \ \ \ \ \ \ name=name,}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00066}00066\ \ \ \ \ \ \ \ \ sys\_argv=sys.argv,}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ orig\_dir=process.ORIGINAL\_DIR,}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00068}00068\ \ \ \ \ \ \ \ \ dir=os.getcwd(),}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00069}00069\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00070}00070\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00071}00071\ \ \ \ \ \textcolor{comment}{\#\ Send\ sys\_path\ and\ make\ sure\ the\ current\ directory\ will\ not\ be\ changed}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00072}00072\ \ \ \ \ d[\textcolor{stringliteral}{"{}sys\_path"{}}]\ =\ [p\ \textcolor{keywordflow}{if}\ p\ !=\ \textcolor{stringliteral}{"{}"{}}\ \textcolor{keywordflow}{else}\ process.ORIGINAL\_DIR\ \textcolor{keywordflow}{for}\ p\ \textcolor{keywordflow}{in}\ sys.path]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00073}00073\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00074}00074\ \ \ \ \ \textcolor{comment}{\#\ Make\ sure\ to\ pass\ the\ information\ if\ the\ multiprocessing\ logger\ is\ active}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00075}00075\ \ \ \ \ \textcolor{keywordflow}{if}\ util.\_logger\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00076}00076\ \ \ \ \ \ \ \ \ d[\textcolor{stringliteral}{"{}log\_level"{}}]\ =\ util.\_logger.getEffectiveLevel()}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ util.\_logger.handlers:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ h\ =\ util.\_logger.handlers[0]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ d[\textcolor{stringliteral}{"{}log\_fmt"{}}]\ =\ h.formatter.\_fmt}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00081}00081\ \ \ \ \ \textcolor{comment}{\#\ Tell\ the\ child\ how\ to\ communicate\ with\ the\ resource\_tracker}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00082}00082\ \ \ \ \ \textcolor{keyword}{from}\ .resource\_tracker\ \textcolor{keyword}{import}\ \_resource\_tracker}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00083}00083\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00084}00084\ \ \ \ \ \_resource\_tracker.ensure\_running()}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00085}00085\ \ \ \ \ \textcolor{keywordflow}{if}\ sys.platform\ ==\ \textcolor{stringliteral}{"{}win32"{}}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00086}00086\ \ \ \ \ \ \ \ \ d[\textcolor{stringliteral}{"{}tracker\_fd"{}}]\ =\ msvcrt.get\_osfhandle(\_resource\_tracker.\_fd)}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00087}00087\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00088}00088\ \ \ \ \ \ \ \ \ d[\textcolor{stringliteral}{"{}tracker\_fd"{}}]\ =\ \_resource\_tracker.\_fd}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00089}00089\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00090}00090\ \ \ \ \ \textcolor{keywordflow}{if}\ os.name\ ==\ \textcolor{stringliteral}{"{}posix"{}}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00091}00091\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ joblib/loky\#242:\ allow\ loky\ processes\ to\ retrieve\ the\ resource}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00092}00092\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ tracker\ of\ their\ parent\ in\ case\ the\ child\ processes\ depickles}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00093}00093\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ shared\_memory\ objects,\ that\ are\ still\ tracked\ by\ multiprocessing's}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00094}00094\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ resource\_tracker\ by\ default.}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00095}00095\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ XXX:\ this\ is\ a\ workaround\ that\ may\ be\ error\ prone:\ in\ the\ future,\ it}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00096}00096\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ would\ be\ better\ to\ have\ loky\ subclass\ multiprocessing's\ shared\_memory}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00097}00097\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ to\ force\ registration\ of\ shared\_memory\ segments\ via\ loky's}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00098}00098\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ resource\_tracker.}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00099}00099\ \ \ \ \ \ \ \ \ \textcolor{keyword}{from}\ multiprocessing.resource\_tracker\ \textcolor{keyword}{import}\ (}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ \_resource\_tracker\ \textcolor{keyword}{as}\ mp\_resource\_tracker,}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00101}00101\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00102}00102\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ multiprocessing's\ resource\_tracker\ must\ be\ running\ before\ loky}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00104}00104\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ process\ is\ created\ (othewise\ the\ child\ won't\ be\ able\ to\ use\ it\ if\ it}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00105}00105\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ is\ created\ later\ on)}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00106}00106\ \ \ \ \ \ \ \ \ mp\_resource\_tracker.ensure\_running()}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00107}00107\ \ \ \ \ \ \ \ \ d[\textcolor{stringliteral}{"{}mp\_tracker\_fd"{}}]\ =\ mp\_resource\_tracker.\_fd}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00108}00108\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00109}00109\ \ \ \ \ \textcolor{comment}{\#\ Figure\ out\ whether\ to\ initialise\ main\ in\ the\ subprocess\ as\ a\ module}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00110}00110\ \ \ \ \ \textcolor{comment}{\#\ or\ through\ direct\ execution\ (or\ to\ leave\ it\ alone\ entirely)}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00111}00111\ \ \ \ \ \textcolor{keywordflow}{if}\ init\_main\_module:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00112}00112\ \ \ \ \ \ \ \ \ main\_module\ =\ sys.modules[\textcolor{stringliteral}{"{}\_\_main\_\_"{}}]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00113}00113\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ main\_mod\_name\ =\ getattr(main\_module.\_\_spec\_\_,\ \textcolor{stringliteral}{"{}name"{}},\ \textcolor{keywordtype}{None})}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00115}00115\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ BaseException:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00116}00116\ \ \ \ \ \ \ \ \ \ \ \ \ main\_mod\_name\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00117}00117\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ main\_mod\_name\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00118}00118\ \ \ \ \ \ \ \ \ \ \ \ \ d[\textcolor{stringliteral}{"{}init\_main\_from\_name"{}}]\ =\ main\_mod\_name}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00119}00119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ sys.platform\ !=\ \textcolor{stringliteral}{"{}win32"{}}\ \textcolor{keywordflow}{or}\ (\textcolor{keywordflow}{not}\ WINEXE\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ WINSERVICE):}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00120}00120\ \ \ \ \ \ \ \ \ \ \ \ \ main\_path\ =\ getattr(main\_module,\ \textcolor{stringliteral}{"{}\_\_file\_\_"{}},\ \textcolor{keywordtype}{None})}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ main\_path\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00122}00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00123}00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{not}\ os.path.isabs(main\_path)}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{and}\ process.ORIGINAL\_DIR\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00125}00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ):}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00126}00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ main\_path\ =\ os.path.join(process.ORIGINAL\_DIR,\ main\_path)}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00127}00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ d[\textcolor{stringliteral}{"{}init\_main\_from\_path"{}}]\ =\ os.path.normpath(main\_path)}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00128}00128\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00129}00129\ \ \ \ \ \textcolor{keywordflow}{return}\ d}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00130}00130\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00131}00131\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00132}00132\ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00133}00133\ \textcolor{comment}{\#\ Prepare\ current\ process}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00134}00134\ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00135}00135\ old\_main\_modules\ =\ []}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00136}00136\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00137}00137\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00138}\mbox{\hyperlink{namespacejoblib_1_1externals_1_1loky_1_1backend_1_1spawn_af7a16bfe57618c4195f225b01b742c68}{00138}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacejoblib_1_1externals_1_1loky_1_1backend_1_1spawn_af7a16bfe57618c4195f225b01b742c68}{prepare}}(data,\ parent\_sentinel=None):}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00139}00139\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Try\ to\ get\ current\ process\ ready\ to\ unpickle\ process\ object."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00140}00140\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}name"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00141}00141\ \ \ \ \ \ \ \ \ process.current\_process().name\ =\ data[\textcolor{stringliteral}{"{}name"{}}]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00142}00142\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00143}00143\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}authkey"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00144}00144\ \ \ \ \ \ \ \ \ process.current\_process().authkey\ =\ data[\textcolor{stringliteral}{"{}authkey"{}}]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00145}00145\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00146}00146\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}log\_to\_stderr"{}}\ \textcolor{keywordflow}{in}\ data\ \textcolor{keywordflow}{and}\ data[\textcolor{stringliteral}{"{}log\_to\_stderr"{}}]:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00147}00147\ \ \ \ \ \ \ \ \ util.log\_to\_stderr()}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00148}00148\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00149}00149\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}log\_level"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00150}00150\ \ \ \ \ \ \ \ \ util.get\_logger().setLevel(data[\textcolor{stringliteral}{"{}log\_level"{}}])}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00151}00151\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00152}00152\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}log\_fmt"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00153}00153\ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ logging}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00154}00154\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00155}00155\ \ \ \ \ \ \ \ \ util.get\_logger().handlers[0].setFormatter(}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00156}00156\ \ \ \ \ \ \ \ \ \ \ \ \ logging.Formatter(data[\textcolor{stringliteral}{"{}log\_fmt"{}}])}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00157}00157\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00159}00159\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}sys\_path"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00160}00160\ \ \ \ \ \ \ \ \ sys.path\ =\ data[\textcolor{stringliteral}{"{}sys\_path"{}}]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00161}00161\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00162}00162\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}sys\_argv"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00163}00163\ \ \ \ \ \ \ \ \ sys.argv\ =\ data[\textcolor{stringliteral}{"{}sys\_argv"{}}]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00164}00164\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00165}00165\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}dir"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00166}00166\ \ \ \ \ \ \ \ \ os.chdir(data[\textcolor{stringliteral}{"{}dir"{}}])}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00167}00167\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00168}00168\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}orig\_dir"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00169}00169\ \ \ \ \ \ \ \ \ process.ORIGINAL\_DIR\ =\ data[\textcolor{stringliteral}{"{}orig\_dir"{}}]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00170}00170\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00171}00171\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}mp\_tracker\_fd"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00172}00172\ \ \ \ \ \ \ \ \ \textcolor{keyword}{from}\ multiprocessing.resource\_tracker\ \textcolor{keyword}{import}\ (}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \ \ \ \_resource\_tracker\ \textcolor{keyword}{as}\ mp\_resource\_tracker,}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00174}00174\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00175}00175\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00176}00176\ \ \ \ \ \ \ \ \ mp\_resource\_tracker.\_fd\ =\ data[\textcolor{stringliteral}{"{}mp\_tracker\_fd"{}}]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00177}00177\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}tracker\_fd"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00178}00178\ \ \ \ \ \ \ \ \ \textcolor{keyword}{from}\ .resource\_tracker\ \textcolor{keyword}{import}\ \_resource\_tracker}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00179}00179\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00180}00180\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ sys.platform\ ==\ \textcolor{stringliteral}{"{}win32"{}}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ handle\ =\ data[\textcolor{stringliteral}{"{}tracker\_fd"{}}]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00182}00182\ \ \ \ \ \ \ \ \ \ \ \ \ handle\ =\ duplicate(handle,\ source\_process=parent\_sentinel)}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00183}00183\ \ \ \ \ \ \ \ \ \ \ \ \ \_resource\_tracker.\_fd\ =\ msvcrt.open\_osfhandle(handle,\ os.O\_RDONLY)}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00184}00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ \_resource\_tracker.\_fd\ =\ data[\textcolor{stringliteral}{"{}tracker\_fd"{}}]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00186}00186\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00187}00187\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}init\_main\_from\_name"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00188}00188\ \ \ \ \ \ \ \ \ \_fixup\_main\_from\_name(data[\textcolor{stringliteral}{"{}init\_main\_from\_name"{}}])}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00189}00189\ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{"{}init\_main\_from\_path"{}}\ \textcolor{keywordflow}{in}\ data:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00190}00190\ \ \ \ \ \ \ \ \ \_fixup\_main\_from\_path(data[\textcolor{stringliteral}{"{}init\_main\_from\_path"{}}])}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00191}00191\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00193}00193\ \textcolor{comment}{\#\ Multiprocessing\ module\ helpers\ to\ fix\ up\ the\ main\ module\ in}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00194}00194\ \textcolor{comment}{\#\ spawned\ subprocesses}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00195}00195\ \textcolor{keyword}{def\ }\_fixup\_main\_from\_name(mod\_name):}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00196}00196\ \ \ \ \ \textcolor{comment}{\#\ \_\_main\_\_.py\ files\ for\ packages,\ directories,\ zip\ archives,\ etc,\ run}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00197}00197\ \ \ \ \ \textcolor{comment}{\#\ their\ "{}main\ only"{}\ code\ unconditionally,\ so\ we\ don't\ even\ try\ to}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00198}00198\ \ \ \ \ \textcolor{comment}{\#\ populate\ anything\ in\ \_\_main\_\_,\ nor\ do\ we\ make\ any\ changes\ to}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00199}00199\ \ \ \ \ \textcolor{comment}{\#\ \_\_main\_\_\ attributes}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00200}00200\ \ \ \ \ current\_main\ =\ sys.modules[\textcolor{stringliteral}{"{}\_\_main\_\_"{}}]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00201}00201\ \ \ \ \ \textcolor{keywordflow}{if}\ mod\_name\ ==\ \textcolor{stringliteral}{"{}\_\_main\_\_"{}}\ \textcolor{keywordflow}{or}\ mod\_name.endswith(\textcolor{stringliteral}{"{}.\_\_main\_\_"{}}):}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00202}00202\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00203}00203\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00204}00204\ \ \ \ \ \textcolor{comment}{\#\ If\ this\ process\ was\ forked,\ \_\_main\_\_\ may\ already\ be\ populated}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00205}00205\ \ \ \ \ \textcolor{keywordflow}{if}\ getattr(current\_main.\_\_spec\_\_,\ \textcolor{stringliteral}{"{}name"{}},\ \textcolor{keywordtype}{None})\ ==\ mod\_name:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00206}00206\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00207}00207\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00208}00208\ \ \ \ \ \textcolor{comment}{\#\ Otherwise,\ \_\_main\_\_\ may\ contain\ some\ non-\/main\ code\ where\ we\ need\ to}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00209}00209\ \ \ \ \ \textcolor{comment}{\#\ support\ unpickling\ it\ properly.\ We\ rerun\ it\ as\ \_\_mp\_main\_\_\ and\ make}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00210}00210\ \ \ \ \ \textcolor{comment}{\#\ the\ normal\ \_\_main\_\_\ an\ alias\ to\ that}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00211}00211\ \ \ \ \ old\_main\_modules.append(current\_main)}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00212}00212\ \ \ \ \ main\_module\ =\ types.ModuleType(\textcolor{stringliteral}{"{}\_\_mp\_main\_\_"{}})}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00213}00213\ \ \ \ \ main\_content\ =\ runpy.run\_module(}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00214}00214\ \ \ \ \ \ \ \ \ mod\_name,\ run\_name=\textcolor{stringliteral}{"{}\_\_mp\_main\_\_"{}},\ alter\_sys=\textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00215}00215\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00216}00216\ \ \ \ \ main\_module.\_\_dict\_\_.update(main\_content)}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00217}00217\ \ \ \ \ sys.modules[\textcolor{stringliteral}{"{}\_\_main\_\_"{}}]\ =\ sys.modules[\textcolor{stringliteral}{"{}\_\_mp\_main\_\_"{}}]\ =\ main\_module}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00218}00218\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00219}00219\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00220}00220\ \textcolor{keyword}{def\ }\_fixup\_main\_from\_path(main\_path):}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00221}00221\ \ \ \ \ \textcolor{comment}{\#\ If\ this\ process\ was\ forked,\ \_\_main\_\_\ may\ already\ be\ populated}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00222}00222\ \ \ \ \ current\_main\ =\ sys.modules[\textcolor{stringliteral}{"{}\_\_main\_\_"{}}]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00223}00223\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00224}00224\ \ \ \ \ \textcolor{comment}{\#\ Unfortunately,\ the\ main\ ipython\ launch\ script\ historically\ had\ no}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00225}00225\ \ \ \ \ \textcolor{comment}{\#\ "{}if\ \_\_name\_\_\ ==\ '\_\_main\_\_'"{}\ guard,\ so\ we\ work\ around\ that}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00226}00226\ \ \ \ \ \textcolor{comment}{\#\ by\ treating\ it\ like\ a\ \_\_main\_\_.py\ file}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00227}00227\ \ \ \ \ \textcolor{comment}{\#\ See\ https://github.com/ipython/ipython/issues/4698}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00228}00228\ \ \ \ \ main\_name\ =\ os.path.splitext(os.path.basename(main\_path))[0]}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00229}00229\ \ \ \ \ \textcolor{keywordflow}{if}\ main\_name\ ==\ \textcolor{stringliteral}{"{}ipython"{}}:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00230}00230\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00231}00231\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00232}00232\ \ \ \ \ \textcolor{comment}{\#\ Otherwise,\ if\ \_\_file\_\_\ already\ has\ the\ setting\ we\ expect,}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00233}00233\ \ \ \ \ \textcolor{comment}{\#\ there's\ nothing\ more\ to\ do}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00234}00234\ \ \ \ \ \textcolor{keywordflow}{if}\ getattr(current\_main,\ \textcolor{stringliteral}{"{}\_\_file\_\_"{}},\ \textcolor{keywordtype}{None})\ ==\ main\_path:}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00235}00235\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00236}00236\ }
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00237}00237\ \ \ \ \ \textcolor{comment}{\#\ If\ the\ parent\ process\ has\ sent\ a\ path\ through\ rather\ than\ a\ module}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00238}00238\ \ \ \ \ \textcolor{comment}{\#\ name\ we\ assume\ it\ is\ an\ executable\ script\ that\ may\ contain}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00239}00239\ \ \ \ \ \textcolor{comment}{\#\ non-\/main\ code\ that\ needs\ to\ be\ executed}}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00240}00240\ \ \ \ \ old\_main\_modules.append(current\_main)}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00241}00241\ \ \ \ \ main\_module\ =\ types.ModuleType(\textcolor{stringliteral}{"{}\_\_mp\_main\_\_"{}})}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00242}00242\ \ \ \ \ main\_content\ =\ runpy.run\_path(main\_path,\ run\_name=\textcolor{stringliteral}{"{}\_\_mp\_main\_\_"{}})}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00243}00243\ \ \ \ \ main\_module.\_\_dict\_\_.update(main\_content)}
\DoxyCodeLine{\Hypertarget{spawn_8py_source_l00244}00244\ \ \ \ \ sys.modules[\textcolor{stringliteral}{"{}\_\_main\_\_"{}}]\ =\ sys.modules[\textcolor{stringliteral}{"{}\_\_mp\_main\_\_"{}}]\ =\ main\_module}

\end{DoxyCode}
