\doxysection{main.\+py}
\hypertarget{replication_202__embedding_2main_8py_source}{}\label{replication_202__embedding_2main_8py_source}\index{02\_embedding/main.py@{02\_embedding/main.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00001}\mbox{\hyperlink{namespacemain}{00001}}\ \textcolor{comment}{\#\ ///\ script}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00002}00002\ \textcolor{comment}{\#\ dependencies\ =\ [}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00003}00003\ \textcolor{comment}{\#\ \ \ "{}GitPython"{},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00004}00004\ \textcolor{comment}{\#\ \ \ "{}torch"{},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00005}00005\ \textcolor{comment}{\#\ \ \ "{}transformers>=4.21.0"{},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00006}00006\ \textcolor{comment}{\#\ \ \ "{}sentence-\/transformers"{},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00007}00007\ \textcolor{comment}{\#\ \ \ "{}pymilvus"{},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00008}00008\ \textcolor{comment}{\#\ \ \ "{}numpy"{},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00009}00009\ \textcolor{comment}{\#\ \ \ "{}einops"{},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00010}00010\ \textcolor{comment}{\#\ ]}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00011}00011\ \textcolor{comment}{\#\ ///}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00013}00013\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00014}00014\ \textcolor{keyword}{import}\ gc}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00015}00015\ \textcolor{keyword}{import}\ time}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00016}00016\ \textcolor{keyword}{import}\ torch}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00017}00017\ \textcolor{keyword}{import}\ numpy\ \textcolor{keyword}{as}\ np}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00018}00018\ \textcolor{keyword}{from}\ pathlib\ \textcolor{keyword}{import}\ Path}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00019}00019\ \textcolor{keyword}{from}\ sentence\_transformers\ \textcolor{keyword}{import}\ SentenceTransformer}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00020}00020\ \textcolor{keyword}{from}\ git\ \textcolor{keyword}{import}\ Repo}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00021}00021\ \textcolor{keyword}{import}\ shutil}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00022}00022\ \textcolor{keyword}{from}\ pymilvus\ \textcolor{keyword}{import}\ MilvusClient}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00023}00023\ \textcolor{keyword}{from}\ huggingface\_hub\ \textcolor{keyword}{import}\ login}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00024}00024\ \textcolor{keyword}{import}\ warnings}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00025}00025\ warnings.filterwarnings(\textcolor{stringliteral}{'ignore'})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00029}00029\ login(token=os.getenv(\textcolor{stringliteral}{"{}HF\_TOKEN"{}}))}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00030}00030\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00033}\mbox{\hyperlink{namespacemain_af39fe0d04f10b0240821af5f863b4d43}{00033}}\ repos\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00035}\mbox{\hyperlink{classmain_1_1EmbeddingModelManager}{00035}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmain_1_1EmbeddingModelManager}{EmbeddingModelManager}}:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00036}00036\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Embedding\ Model\ Management\ Class}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00037}00037\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00038}00038\ \textcolor{stringliteral}{\ \ \ \ Defines,\ loads,\ manages,\ and\ cleans\ up\ the\ repository\ embedding\ process.}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00039}00039\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00040}00040\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00041}\mbox{\hyperlink{classmain_1_1EmbeddingModelManager_a555c8052cfb7e1e2a78366fb1a44ccc0}{00041}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmain_1_1EmbeddingModelManager_a555c8052cfb7e1e2a78366fb1a44ccc0}{\_\_init\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00042}00042\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}!Defines\ embedding\ models\ and\ configures\ CUDA\ if\ a\ compatible\ GPU\ is\ present.}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00043}00043\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ CPU\ will\ be\ used\ in\ lieu\ of\ an\ available\ GPU.}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00044}00044\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00045}00045\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ @param\ self\ Object\ pointer}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00046}00046\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ @param\ self.model\_configs\ Contains\ embedding\ model\ configuration\ in\ JSON\ format.}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00047}00047\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ @param\ dimension\ Final\ size\ of\ vector\ embeddings.}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00048}00048\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ @param\ id\ Locally\ defined\ short\ ID\ for\ each\ model.}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00049}00049\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ @oaram\ trust\_remote\_code\ Boolean\ Required\ for\ the\ huggingface\ API\ to\ retrieve\ models\ with\ remotely\ defined\ code.}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00050}00050\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ @param\ max\_seq\_length\ Sequencing\ variable\ used\ during\ data\ chunking.}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00051}00051\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ @param\ self.current\_model\ SentenceTransformer\ object\ containing\ an\ embedding\ model.\ Initialized\ to\ None.}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00052}00052\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ @param\ self.current\_model\_name\ String\ holding\ the\ model\ name.}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00053}00053\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ @oaram\ self.device\ cuda\ OR\ cpu"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00054}00054\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ self.model\_configs\ =\ \{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00055}00055\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ "{}jinaai/jina-\/embeddings-\/v2-\/base-\/code"{}:\ \{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00056}00056\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}dimension"{}:\ 768,}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00057}00057\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}id"{}:\ "{}jina"{},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00058}00058\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}trust\_remote\_code"{}:\ False,}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00059}00059\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}max\_seq\_length"{}:\ 512}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00060}00060\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00061}00061\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ "{}nomic-\/ai/CodeRankEmbed"{}:\ \{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00062}00062\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}dimension"{}:\ 256,}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00063}00063\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}id"{}:\ "{}sfr2br"{},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00064}00064\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}trust\_remote\_code"{}:\ True,}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00065}00065\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}max\_seq\_length"{}:\ 256}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00066}00066\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00067}00067\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ "{}codesage/codesage-\/large-\/v2"{}:\ \{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00068}00068\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}dimension"{}:\ 1024,}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00069}00069\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}id"{}:\ "{}codesage"{},}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00070}00070\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}trust\_remote\_code"{}:\ True,}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00071}00071\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}max\_seq\_length"{}:\ 512}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00072}00072\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00073}00073\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00074}00074\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00075}00075\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00076}00076\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ self.current\_model\ =\ None}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00077}00077\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ self.current\_model\_name\ =\ None}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00078}00078\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ self.device\ =\ "{}cuda"{}\ if\ torch.cuda.is\_available()\ else\ "{}cpu"{}}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00079}00079\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00080}00080\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ if\ torch.cuda.is\_available():}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00081}00081\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ torch.cuda.set\_per\_process\_memory\_fraction(0.85)\ \ \#\ Reserve\ 15\%\ for\ system}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00082}00082\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ os.environ['PYTORCH\_CUDA\_ALLOC\_CONF']\ =\ 'expandable\_segments:True'}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00083}00083\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00084}00084\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ print(f"{}Using\ device:\ \{self.device\}"{})}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00085}00085\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ if\ self.device\ ==\ "{}cuda"{}:}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00086}00086\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ print(f"{}GPU\ Memory:\ \{torch.cuda.get\_device\_properties(0).total\_memory\ /\ 1e9:.1f\}\ GB"{})}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00087}00087\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00088}\mbox{\hyperlink{classmain_1_1EmbeddingModelManager_a901bb55862deafee2cf6954984f5335a}{00088}}\ \textcolor{stringliteral}{\ \ \ \ def\ aggressive\_cleanup(self):}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00089}00089\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}!\ Performs\ aggressive\ interpreter\ and\ torch\ memory\ cleanup\ between\ model\ loads.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00090}00090\ \ \ \ \ \ \ \ \ "{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00091}00091\ \ \ \ \ \ \ \ \ if\ self.current\_model\ is\ not\ None:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \ \ \ del\ self.current\_model}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ self.current\_model\ =\ None}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ self.current\_model\_name\ =\ None}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00096}00096\ \ \ \ \ \ \ \ \ \#\ Aggressive\ cleanup}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00097}00097\ \ \ \ \ \ \ \ \ gc.collect()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00098}00098\ \ \ \ \ \ \ \ \ if\ torch.cuda.is\_available():}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ torch.cuda.empty\_cache()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ torch.cuda.synchronize()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00101}00101\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00102}00102\ \ \ \ \ \ \ \ \ \#\ Brief\ pause\ to\ ensure\ cleanup}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ time.sleep(1)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00104}00104\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00105}\mbox{\hyperlink{classmain_1_1EmbeddingModelManager_a1649b133897294b3bf70420b8503680b}{00105}}\ \ \ \ \ def\ load\_model(self,\ model\_name):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00106}00106\ \ \ \ \ \ \ \ \ "{}"{}"{}!}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00107}00107\ \ \ \ \ \ \ \ \ Loads\ model\ and\ verifies\ embedding\ dimensions.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00108}00108\ \ \ \ \ \ \ \ \ @return\ An\ embedding\ model\ as\ a\ SentenceTransformer\ object.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00109}00109\ \ \ \ \ \ \ \ \ "{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00110}00110\ \ \ \ \ \ \ \ \ if\ self.current\_model\_name\ ==\ model\_name\ and\ self.current\_model\ is\ not\ None:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ return\ self.current\_model}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00112}00112\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00113}00113\ \ \ \ \ \ \ \ \ \#\#\ Aggressive\ cleanup\ before\ loading\ new\ model}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00114}00114\ \ \ \ \ \ \ \ \ self.aggressive\_cleanup()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00115}00115\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00116}00116\ \ \ \ \ \ \ \ \ print(f"{}Loading\ model:\ \{model\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00117}00117\ \ \ \ \ \ \ \ \ config\ =\ self.model\_configs[model\_name]}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00118}00118\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00119}00119\ \ \ \ \ \ \ \ \ try:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00120}00120\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Load\ with\ specific\ configurations\ for\ each\ model}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \ \ \ model\_kwargs\ =\ \{}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00122}00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 'device':\ self.device,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00123}00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 'trust\_remote\_code':\ config['trust\_remote\_code']}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00125}00125\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00126}00126\ \ \ \ \ \ \ \ \ \ \ \ \ model\ =\ SentenceTransformer(model\_name,\ **model\_kwargs)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00127}00127\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00128}00128\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Set\ maximum\ sequence\ length\ to\ prevent\ memory\ overflow}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00129}00129\ \ \ \ \ \ \ \ \ \ \ \ \ if\ hasattr(model,\ 'max\_seq\_length'):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ model.max\_seq\_length\ =\ config['max\_seq\_length']}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00131}00131\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00132}00132\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Test\ with\ minimal\ sample\ to\ verify\ dimensions}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00133}00133\ \ \ \ \ \ \ \ \ \ \ \ \ test\_embedding\ =\ model.encode(["{}test"{}],\ show\_progress\_bar=False)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00134}00134\ \ \ \ \ \ \ \ \ \ \ \ \ actual\_dim\ =\ len(test\_embedding[0])}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00135}00135\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00136}00136\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Update\ dimension\ in\ config}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ self.model\_configs[model\_name]["{}dimension"{}]\ =\ actual\_dim}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Model\ \{model\_name\}\ loaded\ successfully.\ Dimension:\ \{actual\_dim\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00139}00139\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00140}00140\ \ \ \ \ \ \ \ \ \ \ \ \ self.current\_model\ =\ model}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00141}00141\ \ \ \ \ \ \ \ \ \ \ \ \ self.current\_model\_name\ =\ model\_name}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00142}00142\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00143}00143\ \ \ \ \ \ \ \ \ \ \ \ \ return\ model}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00144}00144\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00145}00145\ \ \ \ \ \ \ \ \ except\ Exception\ as\ e:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00146}00146\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Error\ loading\ model\ \{model\_name\}:\ \{e\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \ \ \ self.aggressive\_cleanup()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00148}00148\ \ \ \ \ \ \ \ \ \ \ \ \ return\ None}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00149}00149\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00150}\mbox{\hyperlink{classmain_1_1EmbeddingModelManager_a70007d9407f26a5d9ef09c81df22235d}{00150}}\ \ \ \ \ def\ chunk\_text(self,\ text,\ max\_length=500):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00151}00151\ \ \ \ \ \ \ \ \ "{}"{}"{}!}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00152}00152\ \ \ \ \ \ \ \ \ Chunks\ long\ text\ files\ to\ prevent\ memory\ overflow\ while\ preserving\ content.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00153}00153\ \ \ \ \ \ \ \ \ @return\ Overlapping\ chunks\ to\ maintain\ context.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00154}00154\ \ \ \ \ \ \ \ \ "{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00155}00155\ \ \ \ \ \ \ \ \ if\ len(text)\ <=\ max\_length:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00156}00156\ \ \ \ \ \ \ \ \ \ \ \ \ return\ [text]}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00157}00157\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00158}00158\ \ \ \ \ \ \ \ \ chunks\ =\ []}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00159}00159\ \ \ \ \ \ \ \ \ \#\#\ 50\ character\ overlap\ to\ maintain\ context}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00160}00160\ \ \ \ \ \ \ \ \ overlap\ =\ 50}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00161}00161\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00162}00162\ \ \ \ \ \ \ \ \ for\ i\ in\ range(0,\ len(text),\ max\_length\ -\/\ overlap):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00163}00163\ \ \ \ \ \ \ \ \ \ \ \ \ chunk\ =\ text[i:i\ +\ max\_length]}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Only\ adds\ non-\/empty\ chunks}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00165}00165\ \ \ \ \ \ \ \ \ \ \ \ \ if\ chunk.strip():}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00166}00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chunks.append(chunk)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00167}00167\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00168}00168\ \ \ \ \ \ \ \ \ return\ chunks}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00169}00169\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00170}\mbox{\hyperlink{classmain_1_1EmbeddingModelManager_a95ca0983364857f926ce667a8336a1fd}{00170}}\ \ \ \ \ def\ embed\_texts(self,\ texts,\ model\_name,\ batch\_size=8):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00171}00171\ \ \ \ \ \ \ \ \ "{}"{}"{}!}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00172}00172\ \ \ \ \ \ \ \ \ Generates\ embeddings\ with\ aggressive\ memory\ management\ and\ chunking.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00173}00173\ \ \ \ \ \ \ \ \ Small\ batch\ sizes\ intended\ for\ use\ with\ a\ P100\ GPU\ through\ Kaggle.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00174}00174\ \ \ \ \ \ \ \ \ @return\ Lists\ containing\ complete\ embeddings\ and\ raw\ text\ metadata.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00175}00175\ \ \ \ \ \ \ \ \ "{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00176}00176\ \ \ \ \ \ \ \ \ model\ =\ self.load\_model(model\_name)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00177}00177\ \ \ \ \ \ \ \ \ if\ model\ is\ None:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ return\ None}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00179}00179\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00180}00180\ \ \ \ \ \ \ \ \ try:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Total\ list\ of\ embeddings}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00182}00182\ \ \ \ \ \ \ \ \ \ \ \ \ all\_embeddings\ =\ []}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00183}00183\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00184}00184\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ List\ of\ raw\ text\ metadata}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ processed\_texts\ =\ []}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00186}00186\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00187}00187\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Process\ and\ chunk\ texts\ first}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00188}00188\ \ \ \ \ \ \ \ \ \ \ \ \ for\ text\ in\ texts:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chunks\ =\ self.chunk\_text(text)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00190}00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processed\_texts.extend(chunks)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00191}00191\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00192}00192\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Processing\ \{len(processed\_texts)\}\ text\ chunks\ (from\ \{len(texts)\}\ original\ files)"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00193}00193\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00194}00194\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Process\ in\ very\ small\ batches\ for\ P100}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00195}00195\ \ \ \ \ \ \ \ \ \ \ \ \ for\ i\ in\ range(0,\ len(processed\_texts),\ batch\_size):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00196}00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ batch\ =\ processed\_texts[i:i\ +\ batch\_size]}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00197}00197\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00198}00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ try:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00199}00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ batch\_embeddings\ =\ model.encode(}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00200}00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ batch,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00201}00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ convert\_to\_numpy=True,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00202}00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ show\_progress\_bar=False,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00203}00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Smaller\ internal\ batches\ prevent\ memory\ overrun}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00204}00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ batch\_size=min(4,\ len(batch))}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00205}00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00206}00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ all\_embeddings.extend(batch\_embeddings)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00207}00207\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Memory\ cleanup\ between\ batches}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ i\ \%\ (batch\_size\ *\ 4)\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00210}00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gc.collect()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00211}00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ torch.cuda.is\_available():}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00212}00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ torch.cuda.empty\_cache()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00213}00213\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00214}00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ i\ \%\ (batch\_size\ *\ 2)\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00215}00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Processed\ \{i\ +\ len(batch)\}/\{len(processed\_texts)\}\ chunks"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00216}00216\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00217}00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ except\ Exception\ as\ e:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00218}00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Error\ in\ batch\ \{i\}:\ \{e\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00219}00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Skip\ this\ batch\ but\ continue\ processing}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00220}00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ continue}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00221}00221\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00222}00222\ \ \ \ \ \ \ \ \ \ \ \ \ return\ all\_embeddings,\ processed\_texts}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00223}00223\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00224}00224\ \ \ \ \ \ \ \ \ except\ Exception\ as\ e:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00225}00225\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Error\ generating\ embeddings:\ \{e\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00226}00226\ \ \ \ \ \ \ \ \ \ \ \ \ return\ None,\ None}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00227}00227\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00228}\mbox{\hyperlink{classmain_1_1EmbeddingModelManager_a75d6b05723dcf7d50e3b4ec527be250d}{00228}}\ \ \ \ \ def\ get\_dimension(self,\ model\_name):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00229}00229\ \ \ \ \ \ \ \ \ "{}"{}"{}!\ Gets\ the\ embedding\ dimension\ for\ a\ specific\ model."{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00230}00230\ \ \ \ \ \ \ \ \ return\ self.model\_configs.get(model\_name,\ \{\}).get("{}dimension"{},\ 768)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00231}00231\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00232}\mbox{\hyperlink{classmain_1_1EmbeddingModelManager_a70ec712b0fcfaba7542be332e14aecc8}{00232}}\ \ \ \ \ def\ cleanup(self):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00233}00233\ \ \ \ \ \ \ \ \ "{}"{}"{}!\ Cleans\ up\ loaded\ models\ and\ frees\ GPU\ memory."{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00234}00234\ \ \ \ \ \ \ \ \ self.aggressive\_cleanup()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00235}00235\ \ \ \ \ \ \ \ \ print("{}Model\ cleanup\ completed."{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00236}00236\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00237}\mbox{\hyperlink{classmain_1_1RepositoryEmbedder}{00237}}\ class\ RepositoryEmbedder:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00238}00238\ \ \ \ \ "{}"{}"{}!}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00239}00239\ \ \ \ \ Repository\ processor\ class\ with\ chunk-\/aware\ storage\ and\ metadata\ preservation.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00240}00240\ \ \ \ \ Handles\ repository\ pairs\ as\ separate\ Milvus\ instances.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00241}00241\ \ \ \ \ @param\ self\ Object\ pointer.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00242}00242\ \ \ \ \ @param\ self.repos\ clone\ of\ the\ global\ repository\ list.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00243}00243\ \ \ \ \ @param\ self.code\_extensions\ A\ set\ of\ 30\ common\ file\ extensions\ to\ microservices\ projects.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00244}00244\ \ \ \ \ @param\ self.models\ A\ list\ of\ github\ URLs\ for\ the\ embedding\ models\ in\ use.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00245}00245\ \ \ \ \ @param\ model\_manager\ an\ EmbeddingModelManager\ instance.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00246}00246\ \ \ \ \ "{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00247}00247\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00248}00248\ \ \ \ \ def\ \_\_init\_\_(self,\ model\_manager):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00249}00249\ \ \ \ \ \ \ \ \ self.model\_manager\ =\ model\_manager}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00250}00250\ \ \ \ \ \ \ \ \ self.repos\ =\ repos}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00251}00251\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00252}00252\ \ \ \ \ \ \ \ \ \#\ File\ extension\ store}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00253}00253\ \ \ \ \ \ \ \ \ self.code\_extensions\ =\ \{}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00254}00254\ \ \ \ \ \ \ \ \ \ \ \ \ '.py',\ '.js',\ '.java',\ '.cpp',\ '.c',\ '.h',\ '.cs',\ '.php',}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00255}00255\ \ \ \ \ \ \ \ \ \ \ \ \ '.rb',\ '.go',\ '.rs',\ '.swift',\ '.kt',\ '.ts',\ '.jsx',\ '.tsx',}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00256}00256\ \ \ \ \ \ \ \ \ \ \ \ \ '.md',\ '.txt',\ '.csv',\ '.json',\ '.xml',\ '.yml',\ '.yaml',}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00257}00257\ \ \ \ \ \ \ \ \ \ \ \ \ '.sql',\ '.sh',\ '.bat',\ '.html',\ '.css',\ '.scss',\ '.less'}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00258}00258\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00259}00259\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00260}00260\ \ \ \ \ \ \ \ \ \#\ Model\ configurations}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00261}00261\ \ \ \ \ \ \ \ \ self.models\ =\ [}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00262}00262\ \ \ \ \ \ \ \ \ \ \ \ \ "{}jinaai/jina-\/embeddings-\/v2-\/base-\/code"{},}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00263}00263\ \ \ \ \ \ \ \ \ \ \ \ \ "{}nomic-\/ai/CodeRankEmbed"{},}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00264}00264\ \ \ \ \ \ \ \ \ \ \ \ \ "{}codesage/codesage-\/large-\/v2"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00265}00265\ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00266}00266\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00267}\mbox{\hyperlink{classmain_1_1RepositoryEmbedder_a8c43c1c88eda3281613530302f7a288e}{00267}}\ \ \ \ \ def\ group\_repositories\_into\_pairs(self):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00268}00268\ \ \ \ \ \ \ \ \ "{}"{}"{}!}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00269}00269\ \ \ \ \ \ \ \ \ Group\ repositories\ into\ primary-\/fork\ pairs\ based\ on\ naming\ convention.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00270}00270\ \ \ \ \ \ \ \ \ @return\ A\ list\ of\ tuples:\ (pair\_name,\ primary\_repo,\ fork\_repo)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00271}00271\ \ \ \ \ \ \ \ \ "{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00272}00272\ \ \ \ \ \ \ \ \ pairs\ =\ []}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00273}00273\ \ \ \ \ \ \ \ \ processed\ =\ set()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00274}00274\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00275}00275\ \ \ \ \ \ \ \ \ for\ repo\_name\ in\ self.repos.keys():}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00276}00276\ \ \ \ \ \ \ \ \ \ \ \ \ if\ repo\_name\ in\ processed:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00277}00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ continue}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00278}00278\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00279}00279\ \ \ \ \ \ \ \ \ \ \ \ \ if\ repo\_name.endswith('-\/primary'):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00280}00280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Looks\ for\ corresponding\ fork}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00281}00281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ base\_name\ =\ repo\_name[:-\/8]}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00282}00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fork\_name\ =\ f"{}\{base\_name\}-\/fork"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00283}00283\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00284}00284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ fork\_name\ in\ self.repos:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00285}00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pairs.append((base\_name,\ repo\_name,\ fork\_name))}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00286}00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processed.add(repo\_name)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00287}00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processed.add(fork\_name)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00288}00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Found\ pair:\ \{base\_name\}\ -\/>\ \{repo\_name\}\ +\ \{fork\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00289}00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ else:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00290}00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Warning:\ No\ fork\ found\ for\ \{repo\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00291}00291\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00292}00292\ \ \ \ \ \ \ \ \ \ \ \ \ elif\ repo\_name.endswith('-\/fork'):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00293}00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Looks\ for\ corresponding\ primary}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00294}00294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ base\_name\ =\ repo\_name[:-\/5]}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00295}00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ primary\_name\ =\ f"{}\{base\_name\}-\/primary"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00296}00296\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00297}00297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ primary\_name\ in\ self.repos\ and\ primary\_name\ not\ in\ processed:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00298}00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pairs.append((base\_name,\ primary\_name,\ repo\_name))}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00299}00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processed.add(repo\_name)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00300}00300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ processed.add(primary\_name)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00301}00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Found\ pair:\ \{base\_name\}\ -\/>\ \{primary\_name\}\ +\ \{repo\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00302}00302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ elif\ primary\_name\ not\ in\ self.repos:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00303}00303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Warning:\ No\ primary\ found\ for\ \{repo\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00304}00304\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00305}00305\ \ \ \ \ \ \ \ \ \ \ \ \#\ if\ len(base\_name)\ >\ 36:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00306}00306\ \ \ \ \ \ \ \ \ \ \ \ \ \#\ \ \ \ base\_name\ =\ base\_name[:-\/(len(base\_name)\ -\/\ 36)]}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00307}00307\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00308}00308\ \ \ \ \ \ \ \ \ print(f"{}Created\ \{len(pairs)\}\ repository\ pairs"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00309}00309\ \ \ \ \ \ \ \ \ return\ pairs}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00310}00310\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00311}\mbox{\hyperlink{classmain_1_1RepositoryEmbedder_ad5715ceccd5f3a97c2ed096d53eca727}{00311}}\ \ \ \ \ def\ create\_milvus\_instance(self,\ pair\_name):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00312}00312\ \ \ \ \ \ \ \ \ "{}"{}"{}!\ Creates\ a\ new\ Milvus\ instance\ for\ a\ repository\ pair.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00313}00313\ \ \ \ \ \ \ \ \ @param\ the\ name\ of\ a\ repo\ pair\ as\ a\ string.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00314}00314\ \ \ \ \ \ \ \ \ @return\ A\ MilvusClient\ object."{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00315}00315\ \ \ \ \ \ \ \ \ db\_path\ =\ f"{}./\{pair\_name\}.db"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00316}00316\ \ \ \ \ \ \ \ \ return\ MilvusClient(uri=db\_path)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00317}00317\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00318}\mbox{\hyperlink{classmain_1_1RepositoryEmbedder_a2632314ce37a503aad1b180fbe7b7b31}{00318}}\ \ \ \ \ def\ setup\_collections\_for\_pair(self,\ milvus\_client,\ pair\_name,\ primary\_repo,\ fork\_repo):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00319}00319\ \ \ \ \ \ \ \ \ "{}"{}"{}!}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00320}00320\ \ \ \ \ \ \ \ \ Sets\ up\ 6\ collections\ for\ a\ repository\ pair\ (2\ repos\ ×\ 3\ models).}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00321}00321\ \ \ \ \ \ \ \ \ @param\ milvus\_client\ A\ MilvusClient\ object.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00322}00322\ \ \ \ \ \ \ \ \ @param\ pair\_name\ The\ name\ of\ a\ repo\ pair\ as\ a\ string.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00323}00323\ \ \ \ \ \ \ \ \ @param\ primary\_repo\ The\ name\ of\ the\ primary\ repository\ as\ a\ string.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00324}00324\ \ \ \ \ \ \ \ \ @param\ fork\_repo\ The\ name\ of\ the\ fork\ repository\ as\ a\ string.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00325}00325\ \ \ \ \ \ \ \ \ @return\ The\ set\ of\ collection\ names"{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00326}00326\ \ \ \ \ \ \ \ \ collections\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00327}00327\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00328}00328\ \ \ \ \ \ \ \ \ for\ i,\ model\_name\ in\ enumerate(self.models,\ 1):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00329}00329\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Collections\ for\ primary\ repository}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00330}00330\ \ \ \ \ \ \ \ \ \ \ \ \ primary\_collection\ =\ f"{}primary\_M\{i\}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00331}00331\ \ \ \ \ \ \ \ \ \ \ \ \ collections[primary\_collection]\ =\ (primary\_repo,\ model\_name)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00332}00332\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00333}00333\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Collections\ for\ fork\ repository}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00334}00334\ \ \ \ \ \ \ \ \ \ \ \ \ fork\_collection\ =\ f"{}fork\_M\{i\}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00335}00335\ \ \ \ \ \ \ \ \ \ \ \ \ collections[fork\_collection]\ =\ (fork\_repo,\ model\_name)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00336}00336\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00337}00337\ \ \ \ \ \ \ \ \ print(f"{}Setting\ up\ \{len(collections)\}\ collections\ for\ pair\ \{pair\_name\}..."{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00338}00338\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00339}00339\ \ \ \ \ \ \ \ \ for\ collection\_name,\ (repo\_name,\ model\_name)\ in\ collections.items():}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00340}00340\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Drops\ existing\ collection\ if\ present}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00341}00341\ \ \ \ \ \ \ \ \ \ \ \ \ if\ milvus\_client.has\_collection(collection\_name):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00342}00342\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ milvus\_client.drop\_collection(collection\_name)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00343}00343\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Dropped\ existing\ collection:\ \{collection\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00344}00344\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00345}00345\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Gets\ model\ dimension}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00346}00346\ \ \ \ \ \ \ \ \ \ \ \ \ dimension\ =\ self.model\_manager.get\_dimension(model\_name)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00347}00347\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00348}00348\ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Creates\ new\ collection}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00349}00349\ \ \ \ \ \ \ \ \ \ \ \ \ milvus\_client.create\_collection(}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00350}00350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collection\_name=collection\_name,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00351}00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dimension=dimension,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00352}00352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ metric\_type="{}COSINE"{},}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00353}00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ consistency\_level="{}Strong"{},}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00354}00354\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00355}00355\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Created\ collection\ \{collection\_name\}\ with\ dimension\ \{dimension\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00356}00356\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00357}00357\ \ \ \ \ \ \ \ \ return\ collections}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00358}00358\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00359}\mbox{\hyperlink{classmain_1_1RepositoryEmbedder_a717d0a6241cbe32e8e7793b446f00bba}{00359}}\ \ \ \ \ def\ extract\_code\_files(self,\ dir\_path):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00360}00360\ \ \ \ \ \ \ \ \ "{}"{}"{}!\ Extracts\ code\ files\ for\ embedding\ and\ preservation\ of\ plain\ text\ as\ metadata.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00361}00361\ \ \ \ \ \ \ \ \ @param\ dir\_path\ A\ directory\ path\ as\ a\ string}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00362}00362\ \ \ \ \ \ \ \ \ @return\ A\ list\ of\ all\ files\ with\ extensions\ defined\ in\ self.code\_extensions"{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00363}00363\ \ \ \ \ \ \ \ \ dir\_path\ =\ Path(dir\_path)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00364}00364\ \ \ \ \ \ \ \ \ code\_files\ =\ []}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00365}00365\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00366}00366\ \ \ \ \ \ \ \ \ for\ file\_path\ in\ dir\_path.rglob('*'):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00367}00367\ \ \ \ \ \ \ \ \ \ \ \ \ if\ file\_path.is\_file()\ and\ file\_path.suffix.lower()\ in\ self.code\_extensions:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00368}00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ try:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00369}00369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ with\ open(file\_path,\ 'r',\ encoding='utf-\/8',\ errors='ignore')\ as\ f:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00370}00370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ content\ =\ f.read().strip()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00371}00371\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00372}00372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ content:\ \ \#\#\ Skips\ empty\ files}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00373}00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ relative\_path\ =\ str(file\_path.relative\_to(dir\_path))}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00374}00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file\_stats\ =\ file\_path.stat()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00375}00375\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00376}00376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ code\_files.append(\{}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00377}00377\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 'relative\_path':\ relative\_path,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00378}00378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 'filename':\ file\_path.name,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00379}00379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 'content':\ content,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00380}00380\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 'size':\ file\_stats.st\_size,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00381}00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 'extension':\ file\_path.suffix.lower()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00382}00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00383}00383\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00384}00384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ except\ Exception\ as\ e:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00385}00385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Error\ reading\ \{file\_path\}:\ \{e\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00386}00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ continue}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00387}00387\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00388}00388\ \ \ \ \ \ \ \ \ print(f"{}Found\ \{len(code\_files)\}\ code\ files\ in\ \{dir\_path\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00389}00389\ \ \ \ \ \ \ \ \ return\ code\_files}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00390}00390\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00391}\mbox{\hyperlink{classmain_1_1RepositoryEmbedder_a5618738c14b8b2f35d91ed70cad331b0}{00391}}\ \ \ \ \ def\ process\_repository(self,\ repo\_path,\ collection\_name,\ model\_name,\ milvus\_client):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00392}00392\ \ \ \ \ \ \ \ \ "{}"{}"{}!}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00393}00393\ \ \ \ \ \ \ \ \ Embeds\ a\ repository\ with\ chunk-\/aware\ storage\ and\ complete\ metadata\ preservation.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00394}00394\ \ \ \ \ \ \ \ \ @param\ repo\_path\ A\ directory\ path\ as\ a\ string.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00395}00395\ \ \ \ \ \ \ \ \ @param\ collection\_name\ A\ Milvus\ database\ collection\ name\ as\ a\ string.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00396}00396\ \ \ \ \ \ \ \ \ @param\ model\_name\ An\ embedding\ model's\ name\ as\ a\ string}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00397}00397\ \ \ \ \ \ \ \ \ @param\ milvus\_client\ A\ milvus\_client\ instance's\ name\ as\ a\ string.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00398}00398\ \ \ \ \ \ \ \ \ "{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00399}00399\ \ \ \ \ \ \ \ \ print(f"{}Processing\ repository\ \{repo\_path\}\ with\ model\ \{model\_name\}\ -\/>\ \{collection\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00400}00400\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00401}00401\ \ \ \ \ \ \ \ \ \#\#\ Extracts\ code\ files}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00402}00402\ \ \ \ \ \ \ \ \ code\_files\ =\ self.extract\_code\_files(repo\_path)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00403}00403\ \ \ \ \ \ \ \ \ if\ not\ code\_files:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00404}00404\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}No\ code\ files\ found\ in\ \{repo\_path\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00405}00405\ \ \ \ \ \ \ \ \ \ \ \ \ return}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00406}00406\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00407}00407\ \ \ \ \ \ \ \ \ \#\#\ Prepares\ texts\ for\ embedding}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00408}00408\ \ \ \ \ \ \ \ \ texts\ =\ [file\_data['content']\ for\ file\_data\ in\ code\_files]}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00409}00409\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00410}00410\ \ \ \ \ \ \ \ \ \#\#\ Generates\ embeddings\ with\ chunking}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00411}00411\ \ \ \ \ \ \ \ \ print(f"{}Generating\ embeddings\ for\ \{len(texts)\}\ files..."{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00412}00412\ \ \ \ \ \ \ \ \ result\ =\ self.model\_manager.embed\_texts(texts,\ model\_name)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00413}00413\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00414}00414\ \ \ \ \ \ \ \ \ if\ result\ is\ None\ or\ result[0]\ is\ None:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00415}00415\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Failed\ to\ generate\ embeddings\ for\ \{collection\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00416}00416\ \ \ \ \ \ \ \ \ \ \ \ \ return}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00417}00417\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00418}00418\ \ \ \ \ \ \ \ \ embeddings,\ processed\_chunks\ =\ result}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00419}00419\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00420}00420\ \ \ \ \ \ \ \ \ \#\#\ Maps\ chunks\ back\ to\ original\ files}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00421}00421\ \ \ \ \ \ \ \ \ data\_to\_insert\ =\ []}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00422}00422\ \ \ \ \ \ \ \ \ chunk\_idx\ =\ 0}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00423}00423\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00424}00424\ \ \ \ \ \ \ \ \ for\ file\_data\ in\ code\_files:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00425}00425\ \ \ \ \ \ \ \ \ \ \ \ \ file\_chunks\ =\ self.model\_manager.chunk\_text(file\_data['content'])}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00426}00426\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00427}00427\ \ \ \ \ \ \ \ \ \ \ \ \ for\ chunk\_num,\ chunk\_content\ in\ enumerate(file\_chunks):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00428}00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ chunk\_idx\ <\ len(embeddings):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00429}00429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\_to\_insert.append(\{}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00430}00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}id"{}:\ chunk\_idx,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00431}00431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}vector"{}:\ embeddings[chunk\_idx].tolist(),}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00432}00432\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}file\_path"{}:\ file\_data['relative\_path'],}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00433}00433\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}file\_name"{}:\ file\_data['filename'],}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00434}00434\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}file\_extension"{}:\ file\_data['extension'],}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00435}00435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}file\_size"{}:\ file\_data['size'],}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00436}00436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}chunk\_index"{}:\ chunk\_num,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00437}00437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}total\_chunks"{}:\ len(file\_chunks),}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00438}00438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}content"{}:\ chunk\_content,}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00439}00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}is\_complete\_file"{}:\ len(file\_chunks)\ ==\ 1}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00440}00440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00441}00441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chunk\_idx\ +=\ 1}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00442}00442\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00443}00443\ \ \ \ \ \ \ \ \ \#\#\ Inserts\ data\ into\ Milvus\ in\ small\ batches\ for\ stability}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00444}00444\ \ \ \ \ \ \ \ \ batch\_size\ =\ 50}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00445}00445\ \ \ \ \ \ \ \ \ for\ i\ in\ range(0,\ len(data\_to\_insert),\ batch\_size):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00446}00446\ \ \ \ \ \ \ \ \ \ \ \ \ batch\ =\ data\_to\_insert[i:i\ +\ batch\_size]}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00447}00447\ \ \ \ \ \ \ \ \ \ \ \ \ try:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00448}00448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ milvus\_client.insert(collection\_name=collection\_name,\ data=batch)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00449}00449\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Inserted\ batch\ \{i//batch\_size\ +\ 1\}/\{(len(data\_to\_insert)-\/1)//batch\_size\ +\ 1\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00450}00450\ \ \ \ \ \ \ \ \ \ \ \ \ except\ Exception\ as\ e:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00451}00451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Error\ inserting\ batch:\ \{e\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00452}00452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ continue}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00453}00453\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00454}00454\ \ \ \ \ \ \ \ \ print(f"{}Successfully\ processed\ \{len(code\_files)\}\ files\ into\ \{len(data\_to\_insert)\}\ chunks\ for\ \{collection\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00455}00455\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00456}\mbox{\hyperlink{namespacemain_a92486436f6e05ea08dcf149be0d2bfe8}{00456}}\ def\ clone\_repositories():}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00457}00457\ \ \ \ \ "{}"{}"{}!\ Clones\ repositories\ and\ handles\ errors,\ if\ present."{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00458}00458\ \ \ \ \ print("{}Setting\ up\ repositories..."{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00459}00459\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00460}00460\ \ \ \ \ \#\#\ Creates\ data\ directory}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00461}00461\ \ \ \ \ os.makedirs("{}./data"{},\ exist\_ok=True)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00462}00462\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00463}00463\ \ \ \ \ import\ csv}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00464}00464\ \ \ \ \ data\_file\ =\ "{}../01\_dataset/repositories.csv"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00465}00465\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00466}00466\ \ \ \ \ with\ open(data\_file,\ 'r')\ as\ data:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00467}00467\ \ \ \ \ \ \ \ \ reader\ =\ csv.DictReader(data)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00468}00468\ \ \ \ \ \ \ \ \ for\ row\ in\ reader:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00469}00469\ \ \ \ \ \ \ \ \ \ \ \ \ result\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00470}00470\ \ \ \ \ \ \ \ \ \ \ \ \ result[row['Title']]\ =\ row['URL']}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00471}00471\ \ \ \ \ \ \ \ \ \ \ \ \ repos.update(result)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00472}00472\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00473}00473\ \ \ \ \ for\ repo\_name,\ repo\_url\ in\ repos.items():}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00474}00474\ \ \ \ \ \ \ \ \ repo\_path\ =\ f"{}./repo\_store/\{repo\_name\}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00475}00475\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00476}00476\ \ \ \ \ \ \ \ \ \#\#\ Removes\ existing\ directory,\ if\ present}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00477}00477\ \ \ \ \ \ \ \ \ if\ os.path.exists(repo\_path):}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00478}00478\ \ \ \ \ \ \ \ \ \ \ \ \ shutil.rmtree(repo\_path)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00479}00479\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Removed\ existing\ \{repo\_name\}\ directory"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00480}00480\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00481}00481\ \ \ \ \ \ \ \ \ \#\#\ Clones\ repository}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00482}00482\ \ \ \ \ \ \ \ \ print(f"{}Cloning\ \{repo\_name\}\ repository..."{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00483}00483\ \ \ \ \ \ \ \ \ try:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00484}00484\ \ \ \ \ \ \ \ \ \ \ \ \ Repo.clone\_from(repo\_url,\ repo\_path)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00485}00485\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Successfully\ cloned\ \{repo\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00486}00486\ \ \ \ \ \ \ \ \ except\ Exception\ as\ e:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00487}00487\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Error\ cloning\ \{repo\_name\}:\ \{e\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00488}00488\ \ \ \ \ \ \ \ \ \ \ \ \ raise}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00489}00489\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00490}\mbox{\hyperlink{namespacemain_a5994e9227a9b6b579910a9f91ffcddf5}{00490}}\ def\ main():}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00491}00491\ \ \ \ \ "{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00492}00492\ \ \ \ \ Main\ execution.}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00493}00493\ \ \ \ \ "{}"{}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00494}00494\ \ \ \ \ model\_manager\ =\ None}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00495}00495\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00496}00496\ \ \ \ \ try:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00497}00497\ \ \ \ \ \ \ \ \ \#\#\ Initializes\ components}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00498}00498\ \ \ \ \ \ \ \ \ print("{}Initializing\ embedding\ system..."{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00499}00499\ \ \ \ \ \ \ \ \ model\_manager\ =\ EmbeddingModelManager()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00500}00500\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00501}00501\ \ \ \ \ \ \ \ \ \#\#\ Clones\ repositories}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00502}00502\ \ \ \ \ \ \ \ \ clone\_repositories()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00503}00503\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00504}00504\ \ \ \ \ \ \ \ \ embedder\ =\ RepositoryEmbedder(model\_manager)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00505}00505\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00506}00506\ \ \ \ \ \ \ \ \ \#\#\ Groups\ repositories\ into\ pairs}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00507}00507\ \ \ \ \ \ \ \ \ repo\_pairs\ =\ embedder.group\_repositories\_into\_pairs()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00508}00508\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00509}00509\ \ \ \ \ \ \ \ \ if\ not\ repo\_pairs:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00510}00510\ \ \ \ \ \ \ \ \ \ \ \ \ print("{}No\ repository\ pairs\ found!"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00511}00511\ \ \ \ \ \ \ \ \ \ \ \ \ return}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00512}00512\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00513}00513\ \ \ \ \ \ \ \ \ \#\#\ Processes\ each\ repository\ pair\ with\ its\ own\ Milvus\ instance}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00514}00514\ \ \ \ \ \ \ \ \ for\ pair\_name,\ primary\_repo,\ fork\_repo\ in\ repo\_pairs:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00515}00515\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}\(\backslash\)n\{'='*80\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00516}00516\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Processing\ repository\ pair:\ \{pair\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00517}00517\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Primary:\ \{primary\_repo\},\ Fork:\ \{fork\_repo\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00518}00518\ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}\{'='*80\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00519}00519\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00520}00520\ \ \ \ \ \ \ \ \ \ \ \ \ milvus\_client\ =\ embedder.create\_milvus\_instance(pair\_name)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00521}00521\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00522}00522\ \ \ \ \ \ \ \ \ \ \ \ \ try:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00523}00523\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Sets\ up\ collections\ for\ this\ pair}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00524}00524\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collections\ =\ embedder.setup\_collections\_for\_pair(}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00525}00525\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ milvus\_client,\ pair\_name,\ primary\_repo,\ fork\_repo}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00526}00526\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00527}00527\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00528}00528\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Processes\ all\ collections\ for\ this\ pair}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00529}00529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ for\ collection\_name,\ (repo\_name,\ model\_name)\ in\ collections.items():}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00530}00530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}\(\backslash\)n\{'-\/'*60\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00531}00531\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Processing\ \{collection\_name\}:\ \{repo\_name\}\ +\ \{model\_name\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00532}00532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}\{'-\/'*60\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00533}00533\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00534}00534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ repo\_path\ =\ f"{}./repo\_store/\{repo\_name\}"{}}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00535}00535\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00536}00536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ try:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00537}00537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ embedder.process\_repository(repo\_path,\ collection\_name,\ model\_name,\ milvus\_client)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00538}00538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ except\ Exception\ as\ e:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00539}00539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Error\ processing\ \{collection\_name\}:\ \{e\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00540}00540\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ continue}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00541}00541\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00542}00542\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Cleans\ up\ between\ models}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00543}00543\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ model\_manager.aggressive\_cleanup()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00544}00544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ time.sleep(2)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00545}00545\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00546}00546\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}✅\ Completed\ pair\ \{pair\_name\}\ -\/\ Database:\ \{pair\_name\}.db"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00547}00547\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00548}00548\ \ \ \ \ \ \ \ \ \ \ \ \ except\ Exception\ as\ e:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00549}00549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f"{}Error\ processing\ pair\ \{pair\_name\}:\ \{e\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00550}00550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ continue}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00551}00551\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00552}00552\ \ \ \ \ \ \ \ \ \ \ \ \ finally:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00553}00553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Closes\ Milvus\ client\ for\ this\ pair}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00554}00554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ 'milvus\_client'\ in\ locals():}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00555}00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ del\ milvus\_client}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00556}00556\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00557}00557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#\#\ Performs\ additional\ cleanup\ between\ pairs}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00558}00558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gc.collect()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00559}00559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ time.sleep(3)}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00560}00560\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00561}00561\ \ \ \ \ \ \ \ \ print(f"{}\(\backslash\)n🎉\ All\ embedding\ operations\ completed!"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00562}00562\ \ \ \ \ \ \ \ \ print(f"{}Created\ \{len(repo\_pairs)\}\ separate\ database\ files"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00563}00563\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00564}00564\ \ \ \ \ except\ Exception\ as\ e:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00565}00565\ \ \ \ \ \ \ \ \ print(f"{}Error\ during\ execution:\ \{e\}"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00566}00566\ \ \ \ \ \ \ \ \ import\ traceback}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00567}00567\ \ \ \ \ \ \ \ \ traceback.print\_exc()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00568}00568\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00569}00569\ \ \ \ \ finally:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00570}00570\ \ \ \ \ \ \ \ \ \#\#\ Performs\ final\ cleanup}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00571}00571\ \ \ \ \ \ \ \ \ if\ model\_manager:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00572}00572\ \ \ \ \ \ \ \ \ \ \ \ \ model\_manager.cleanup()}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00573}00573\ \ \ \ \ \ \ \ \ shutil.rmtree("{}./repo\_store"{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00574}00574\ \ \ \ \ \ \ \ \ print("{}Script\ completed."{})}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00575}00575\ }
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00576}00576\ if\ \_\_name\_\_\ ==\ "{}\_\_main\_\_"{}:}
\DoxyCodeLine{\Hypertarget{replication_202__embedding_2main_8py_source_l00577}00577\ \ \ \ \ main()}

\end{DoxyCode}
