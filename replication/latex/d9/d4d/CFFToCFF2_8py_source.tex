\doxysection{CFFTo\+CFF2.\+py}
\hypertarget{CFFToCFF2_8py_source}{}\label{CFFToCFF2_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/fontTools/cffLib/CFFToCFF2.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/fontTools/cffLib/CFFToCFF2.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00001}\mbox{\hyperlink{namespacefontTools_1_1cffLib_1_1CFFToCFF2}{00001}}\ \textcolor{stringliteral}{"{}"{}"{}CFF\ to\ CFF2\ converter."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00003}00003\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1ttLib}{fontTools.ttLib}}\ \textcolor{keyword}{import}\ TTFont,\ newTable}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00004}00004\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1misc_1_1cliTools}{fontTools.misc.cliTools}}\ \textcolor{keyword}{import}\ makeOutputFileName}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00005}00005\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1misc_1_1psCharStrings}{fontTools.misc.psCharStrings}}\ \textcolor{keyword}{import}\ T2WidthExtractor}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00006}00006\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefontTools_1_1cffLib}{fontTools.cffLib}}\ \textcolor{keyword}{import}\ (}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00007}00007\ \ \ \ \ TopDictIndex,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00008}00008\ \ \ \ \ FDArrayIndex,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00009}00009\ \ \ \ \ FontDict,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00010}00010\ \ \ \ \ buildOrder,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00011}00011\ \ \ \ \ topDictOperators,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00012}00012\ \ \ \ \ privateDictOperators,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00013}00013\ \ \ \ \ topDictOperators2,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00014}00014\ \ \ \ \ privateDictOperators2,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00015}00015\ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00016}00016\ \textcolor{keyword}{from}\ io\ \textcolor{keyword}{import}\ BytesIO}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00017}00017\ \textcolor{keyword}{import}\ logging}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00019}00019\ \_\_all\_\_\ =\ [\textcolor{stringliteral}{"{}convertCFFToCFF2"{}},\ \textcolor{stringliteral}{"{}main"{}}]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00020}00020\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00022}00022\ log\ =\ logging.getLogger(\textcolor{stringliteral}{"{}fontTools.cffLib"{}})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00023}00023\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00025}\mbox{\hyperlink{classfontTools_1_1cffLib_1_1CFFToCFF2_1_1__NominalWidthUsedError}{00025}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classfontTools_1_1cffLib_1_1CFFToCFF2_1_1__NominalWidthUsedError}{\_NominalWidthUsedError}}(\mbox{\hyperlink{classException}{Exception}}):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00026}00026\ \ \ \ \ \textcolor{keyword}{def\ }\_\_add\_\_(self,\ other):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00027}00027\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ self}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00029}00029\ \ \ \ \ \textcolor{keyword}{def\ }\_\_radd\_\_(self,\ other):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00030}00030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ self}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00033}\mbox{\hyperlink{namespacefontTools_1_1cffLib_1_1CFFToCFF2_a49b86eba3f2e439180c158c8b0b3a71c}{00033}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacefontTools_1_1cffLib_1_1CFFToCFF2_a49b86eba3f2e439180c158c8b0b3a71c}{\_convertCFFToCFF2}}(cff,\ otFont):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00034}00034\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Converts\ this\ object\ from\ CFF\ format\ to\ CFF2\ format.\ This\ conversion}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00035}00035\ \textcolor{stringliteral}{\ \ \ \ is\ done\ 'in-\/place'.\ The\ conversion\ cannot\ be\ reversed.}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00036}00036\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00037}00037\ \textcolor{stringliteral}{\ \ \ \ This\ assumes\ a\ decompiled\ CFF\ table.\ (i.e.\ that\ the\ object\ has\ been}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00038}00038\ \textcolor{stringliteral}{\ \ \ \ filled\ via\ :meth:\`{}decompile\`{}\ and\ e.g.\ not\ loaded\ from\ XML.)"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00039}00039\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00040}00040\ \ \ \ \ \textcolor{comment}{\#\ Clean\ up\ T2CharStrings}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00042}00042\ \ \ \ \ topDict\ =\ cff.topDictIndex[0]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00043}00043\ \ \ \ \ fdArray\ =\ topDict.FDArray\ \textcolor{keywordflow}{if}\ hasattr(topDict,\ \textcolor{stringliteral}{"{}FDArray"{}})\ \textcolor{keywordflow}{else}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00044}00044\ \ \ \ \ charStrings\ =\ topDict.CharStrings}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00045}00045\ \ \ \ \ globalSubrs\ =\ cff.GlobalSubrs}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00046}00046\ \ \ \ \ localSubrs\ =\ (}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00047}00047\ \ \ \ \ \ \ \ \ [getattr(fd.Private,\ \textcolor{stringliteral}{"{}Subrs"{}},\ [])\ \textcolor{keywordflow}{for}\ fd\ \textcolor{keywordflow}{in}\ fdArray]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ fdArray}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ (}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ [topDict.Private.Subrs]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(topDict,\ \textcolor{stringliteral}{"{}Private"{}})\ \textcolor{keywordflow}{and}\ hasattr(topDict.Private,\ \textcolor{stringliteral}{"{}Subrs"{}})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ []}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00053}00053\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00054}00054\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00055}00055\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00056}00056\ \ \ \ \ \textcolor{keywordflow}{for}\ glyphName\ \textcolor{keywordflow}{in}\ charStrings.keys():}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00057}00057\ \ \ \ \ \ \ \ \ cs,\ fdIndex\ =\ charStrings.getItemAndSelector(glyphName)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00058}00058\ \ \ \ \ \ \ \ \ cs.decompile()}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00060}00060\ \ \ \ \ \textcolor{comment}{\#\ Clean\ up\ subroutines\ first}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00061}00061\ \ \ \ \ \textcolor{keywordflow}{for}\ subrs\ \textcolor{keywordflow}{in}\ [globalSubrs]\ +\ localSubrs:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00062}00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ subr\ \textcolor{keywordflow}{in}\ subrs:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ program\ =\ subr.program}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00064}00064\ \ \ \ \ \ \ \ \ \ \ \ \ i\ =\ j\ =\ len(program)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00065}00065\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i\ =\ program.index(\textcolor{stringliteral}{"{}return"{}})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ ValueError:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00069}00069\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ j\ =\ program.index(\textcolor{stringliteral}{"{}endchar"{}})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ ValueError:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ program[min(i,\ j)\ :]\ =\ []}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00075}00075\ \ \ \ \ \textcolor{comment}{\#\ Clean\ up\ glyph\ charstrings}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00076}00076\ \ \ \ \ removeUnusedSubrs\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00077}00077\ \ \ \ \ nominalWidthXError\ =\ \mbox{\hyperlink{classfontTools_1_1cffLib_1_1CFFToCFF2_1_1__NominalWidthUsedError}{\_NominalWidthUsedError}}()}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00078}00078\ \ \ \ \ \textcolor{keywordflow}{for}\ glyphName\ \textcolor{keywordflow}{in}\ charStrings.keys():}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00079}00079\ \ \ \ \ \ \ \ \ cs,\ fdIndex\ =\ charStrings.getItemAndSelector(glyphName)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00080}00080\ \ \ \ \ \ \ \ \ program\ =\ cs.program}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00081}00081\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00082}00082\ \ \ \ \ \ \ \ \ thisLocalSubrs\ =\ (}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ localSubrs[fdIndex]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ fdIndex\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ (}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ getattr(topDict.Private,\ \textcolor{stringliteral}{"{}Subrs"{}},\ [])}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(topDict,\ \textcolor{stringliteral}{"{}Private"{}})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ []}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00090}00090\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00091}00091\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00092}00092\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Intentionally\ use\ custom\ type\ for\ nominalWidthX,\ such\ that\ any}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00093}00093\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ CharString\ that\ has\ an\ explicit\ width\ encoded\ will\ throw\ back\ to\ us.}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00094}00094\ \ \ \ \ \ \ \ \ extractor\ =\ \mbox{\hyperlink{classfontTools_1_1misc_1_1psCharStrings_1_1T2WidthExtractor}{T2WidthExtractor}}(}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \ \ \ thisLocalSubrs,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00096}00096\ \ \ \ \ \ \ \ \ \ \ \ \ globalSubrs,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \ \ \ nominalWidthXError,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \ \ \ 0,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00099}00099\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00100}00100\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ extractor.execute(cs)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00102}00102\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ \_NominalWidthUsedError:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Program\ has\ explicit\ width.\ We\ want\ to\ drop\ it,\ but\ can't}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ just\ pop\ the\ first\ number\ since\ it\ may\ be\ a\ subroutine\ call.}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00105}00105\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Instead,\ when\ seeing\ that,\ we\ embed\ the\ subroutine\ and\ recurse.}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00106}00106\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ If\ this\ ever\ happened,\ we\ later\ prune\ unused\ subroutines.}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00107}00107\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ len(program)\ >=\ 2\ \textcolor{keywordflow}{and}\ program[1]\ \textcolor{keywordflow}{in}\ [\textcolor{stringliteral}{"{}callsubr"{}},\ \textcolor{stringliteral}{"{}callgsubr"{}}]:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00108}00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ removeUnusedSubrs\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00109}00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ subrNumber\ =\ program.pop(0)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ isinstance(subrNumber,\ int),\ subrNumber}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ op\ =\ program.pop(0)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bias\ =\ extractor.localBias\ \textcolor{keywordflow}{if}\ op\ ==\ \textcolor{stringliteral}{"{}callsubr"{}}\ \textcolor{keywordflow}{else}\ extractor.globalBias}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00113}00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ subrNumber\ +=\ bias}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ subrSet\ =\ thisLocalSubrs\ \textcolor{keywordflow}{if}\ op\ ==\ \textcolor{stringliteral}{"{}callsubr"{}}\ \textcolor{keywordflow}{else}\ globalSubrs}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ subrProgram\ =\ subrSet[subrNumber].program}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00116}00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ program[:0]\ =\ subrProgram}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00117}00117\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Now\ pop\ the\ actual\ width}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00118}00118\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ len(program)\ >=\ 1,\ program}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00119}00119\ \ \ \ \ \ \ \ \ \ \ \ \ program.pop(0)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00120}00120\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00121}00121\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ program\ \textcolor{keywordflow}{and}\ program[-\/1]\ ==\ \textcolor{stringliteral}{"{}endchar"{}}:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00122}00122\ \ \ \ \ \ \ \ \ \ \ \ \ program.pop()}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00123}00123\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00124}00124\ \ \ \ \ \textcolor{keywordflow}{if}\ removeUnusedSubrs:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00125}00125\ \ \ \ \ \ \ \ \ cff.remove\_unused\_subroutines()}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00126}00126\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00127}00127\ \ \ \ \ \textcolor{comment}{\#\ Upconvert\ TopDict}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00128}00128\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00129}00129\ \ \ \ \ cff.major\ =\ 2}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00130}00130\ \ \ \ \ cff2GetGlyphOrder\ =\ cff.otFont.getGlyphOrder}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00131}00131\ \ \ \ \ topDictData\ =\ \mbox{\hyperlink{classfontTools_1_1cffLib_1_1TopDictIndex}{TopDictIndex}}(\textcolor{keywordtype}{None},\ cff2GetGlyphOrder)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00132}00132\ \ \ \ \ \textcolor{keywordflow}{for}\ item\ \textcolor{keywordflow}{in}\ cff.topDictIndex:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00133}00133\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Iterate\ over,\ such\ that\ all\ are\ decompiled}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00134}00134\ \ \ \ \ \ \ \ \ topDictData.append(item)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00135}00135\ \ \ \ \ cff.topDictIndex\ =\ topDictData}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00136}00136\ \ \ \ \ topDict\ =\ topDictData[0]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00137}00137\ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(topDict,\ \textcolor{stringliteral}{"{}Private"{}}):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ privateDict\ =\ topDict.Private}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00139}00139\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00140}00140\ \ \ \ \ \ \ \ \ privateDict\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00141}00141\ \ \ \ \ opOrder\ =\ buildOrder(topDictOperators2)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00142}00142\ \ \ \ \ topDict.order\ =\ opOrder}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00143}00143\ \ \ \ \ topDict.cff2GetGlyphOrder\ =\ cff2GetGlyphOrder}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00144}00144\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00145}00145\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ hasattr(topDict,\ \textcolor{stringliteral}{"{}FDArray"{}}):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00146}00146\ \ \ \ \ \ \ \ \ fdArray\ =\ topDict.FDArray\ =\ \mbox{\hyperlink{classfontTools_1_1cffLib_1_1FDArrayIndex}{FDArrayIndex}}()}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00147}00147\ \ \ \ \ \ \ \ \ fdArray.strings\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00148}00148\ \ \ \ \ \ \ \ \ fdArray.GlobalSubrs\ =\ topDict.GlobalSubrs}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00149}00149\ \ \ \ \ \ \ \ \ topDict.GlobalSubrs.fdArray\ =\ fdArray}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00150}00150\ \ \ \ \ \ \ \ \ charStrings\ =\ topDict.CharStrings}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00151}00151\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ charStrings.charStringsAreIndexed:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00152}00152\ \ \ \ \ \ \ \ \ \ \ \ \ charStrings.charStringsIndex.fdArray\ =\ fdArray}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00153}00153\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00154}00154\ \ \ \ \ \ \ \ \ \ \ \ \ charStrings.fdArray\ =\ fdArray}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00155}00155\ \ \ \ \ \ \ \ \ fontDict\ =\ \mbox{\hyperlink{classfontTools_1_1cffLib_1_1FontDict}{FontDict}}()}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00156}00156\ \ \ \ \ \ \ \ \ fontDict.setCFF2(\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00157}00157\ \ \ \ \ \ \ \ \ fdArray.append(fontDict)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00158}00158\ \ \ \ \ \ \ \ \ fontDict.Private\ =\ privateDict}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00159}00159\ \ \ \ \ \ \ \ \ privateOpOrder\ =\ buildOrder(privateDictOperators2)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00160}00160\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ privateDict\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00161}00161\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ entry\ \textcolor{keywordflow}{in}\ privateDictOperators:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00162}00162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key\ =\ entry[1]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00163}00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ key\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ privateOpOrder:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ key\ \textcolor{keywordflow}{in}\ privateDict.rawDict:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00165}00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ print\ "{}Removing\ private\ dict"{},\ key}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00166}00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ del\ privateDict.rawDict[key]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00167}00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(privateDict,\ key):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00168}00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ delattr(privateDict,\ key)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00169}00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ print\ "{}Removing\ privateDict\ attr"{},\ key}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00170}00170\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00171}00171\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ clean\ up\ the\ PrivateDicts\ in\ the\ fdArray}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00172}00172\ \ \ \ \ \ \ \ \ fdArray\ =\ topDict.FDArray}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00173}00173\ \ \ \ \ \ \ \ \ privateOpOrder\ =\ buildOrder(privateDictOperators2)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00174}00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ fontDict\ \textcolor{keywordflow}{in}\ fdArray:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \ \ \ fontDict.setCFF2(\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00176}00176\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ key\ \textcolor{keywordflow}{in}\ list(fontDict.rawDict.keys()):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ key\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ fontDict.order:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ del\ fontDict.rawDict[key]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(fontDict,\ key):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00180}00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ delattr(fontDict,\ key)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00181}00181\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00182}00182\ \ \ \ \ \ \ \ \ \ \ \ \ privateDict\ =\ fontDict.Private}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00183}00183\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ entry\ \textcolor{keywordflow}{in}\ privateDictOperators:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00184}00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key\ =\ entry[1]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ key\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ privateOpOrder:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00186}00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ key\ \textcolor{keywordflow}{in}\ list(privateDict.rawDict.keys()):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00187}00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ print\ "{}Removing\ private\ dict"{},\ key}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00188}00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ del\ privateDict.rawDict[key]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(privateDict,\ key):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00190}00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ delattr(privateDict,\ key)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00191}00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ print\ "{}Removing\ privateDict\ attr"{},\ key}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00193}00193\ \ \ \ \ \textcolor{comment}{\#\ Now\ delete\ up\ the\ deprecated\ topDict\ operators\ from\ CFF\ 1.0}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00194}00194\ \ \ \ \ \textcolor{keywordflow}{for}\ entry\ \textcolor{keywordflow}{in}\ topDictOperators:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00195}00195\ \ \ \ \ \ \ \ \ key\ =\ entry[1]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00196}00196\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ We\ seem\ to\ need\ to\ keep\ the\ charset\ operator\ for\ now,}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00197}00197\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ or\ we\ fail\ to\ compile\ with\ some\ fonts,\ like\ AdditionFont.otf.}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00198}00198\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ I\ don't\ know\ which\ kind\ of\ CFF\ font\ those\ are.\ But\ keeping}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00199}00199\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ charset\ seems\ to\ work.\ It\ will\ be\ removed\ when\ we\ save\ and}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00200}00200\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ read\ the\ font\ again.}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00201}00201\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00202}00202\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ AdditionFont.otf\ has\ <Encoding\ name="{}StandardEncoding"{}/>.}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00203}00203\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ key\ ==\ \textcolor{stringliteral}{"{}charset"{}}:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00204}00204\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00205}00205\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ key\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ opOrder:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00206}00206\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ key\ \textcolor{keywordflow}{in}\ topDict.rawDict:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00207}00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ del\ topDict.rawDict[key]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(topDict,\ key):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ delattr(topDict,\ key)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00210}00210\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00211}00211\ \ \ \ \ \textcolor{comment}{\#\ TODO(behdad):\ What\ does\ the\ following\ comment\ even\ mean?\ Both\ CFF\ and\ CFF2}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00212}00212\ \ \ \ \ \textcolor{comment}{\#\ use\ the\ same\ T2Charstring\ class.\ I\ *think*\ what\ it\ means\ is\ that\ the\ CharStrings}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00213}00213\ \ \ \ \ \textcolor{comment}{\#\ were\ loaded\ for\ CFF1,\ and\ we\ need\ to\ reload\ them\ for\ CFF2\ to\ set\ varstore,\ etc}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00214}00214\ \ \ \ \ \textcolor{comment}{\#\ on\ them.\ At\ least\ that's\ what\ I\ understand.\ It's\ probably\ safe\ to\ remove\ this}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00215}00215\ \ \ \ \ \textcolor{comment}{\#\ and\ just\ set\ vstore\ where\ needed.}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00216}00216\ \ \ \ \ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00217}00217\ \ \ \ \ \textcolor{comment}{\#\ See\ comment\ above\ about\ charset\ as\ well.}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00218}00218\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00219}00219\ \ \ \ \ \textcolor{comment}{\#\ At\ this\ point,\ the\ Subrs\ and\ Charstrings\ are\ all\ still\ T2Charstring\ class}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00220}00220\ \ \ \ \ \textcolor{comment}{\#\ easiest\ to\ fix\ this\ by\ compiling,\ then\ decompiling\ again}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00221}00221\ \ \ \ \ file\ =\ \mbox{\hyperlink{classBytesIO}{BytesIO}}()}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00222}00222\ \ \ \ \ cff.compile(file,\ otFont,\ isCFF2=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00223}00223\ \ \ \ \ file.seek(0)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00224}00224\ \ \ \ \ cff.decompile(file,\ otFont,\ isCFF2=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00225}00225\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00226}00226\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00227}00227\ \textcolor{keyword}{def\ }convertCFFToCFF2(font):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00228}00228\ \ \ \ \ cff\ =\ font[\textcolor{stringliteral}{"{}CFF\ "{}}].cff}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00229}00229\ \ \ \ \ del\ font[\textcolor{stringliteral}{"{}CFF\ "{}}]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00230}00230\ \ \ \ \ \mbox{\hyperlink{namespacefontTools_1_1cffLib_1_1CFFToCFF2_a49b86eba3f2e439180c158c8b0b3a71c}{\_convertCFFToCFF2}}(cff,\ font)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00231}00231\ \ \ \ \ table\ =\ font[\textcolor{stringliteral}{"{}CFF2"{}}]\ =\ newTable(\textcolor{stringliteral}{"{}CFF2"{}})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00232}00232\ \ \ \ \ table.cff\ =\ cff}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00233}00233\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00234}00234\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00235}\mbox{\hyperlink{namespacefontTools_1_1cffLib_1_1CFFToCFF2_a6cd1c02d1add65bfee6c77017450b604}{00235}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacemain}{main}}(args=None):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00236}00236\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Convert\ CFF\ OTF\ font\ to\ CFF2\ OTF\ font"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00237}00237\ \ \ \ \ \textcolor{keywordflow}{if}\ args\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00238}00238\ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ sys}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00239}00239\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00240}00240\ \ \ \ \ \ \ \ \ args\ =\ sys.argv[1:]}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00241}00241\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00242}00242\ \ \ \ \ \textcolor{keyword}{import}\ argparse}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00243}00243\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00244}00244\ \ \ \ \ parser\ =\ argparse.ArgumentParser(}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00245}00245\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}fonttools\ cffLib.CFFToCFF2"{}},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00246}00246\ \ \ \ \ \ \ \ \ description=\textcolor{stringliteral}{"{}Upgrade\ a\ CFF\ font\ to\ CFF2."{}},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00247}00247\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00248}00248\ \ \ \ \ parser.add\_argument(}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00249}00249\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}input"{}},\ metavar=\textcolor{stringliteral}{"{}INPUT.ttf"{}},\ help=\textcolor{stringliteral}{"{}Input\ OTF\ file\ with\ CFF\ table."{}}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00250}00250\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00251}00251\ \ \ \ \ parser.add\_argument(}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00252}00252\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}-\/o"{}},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00253}00253\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}-\/-\/output"{}},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00254}00254\ \ \ \ \ \ \ \ \ metavar=\textcolor{stringliteral}{"{}OUTPUT.ttf"{}},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00255}00255\ \ \ \ \ \ \ \ \ default=\textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00256}00256\ \ \ \ \ \ \ \ \ help=\textcolor{stringliteral}{"{}Output\ instance\ OTF\ file\ (default:\ INPUT-\/CFF2.ttf)."{}},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00257}00257\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00258}00258\ \ \ \ \ parser.add\_argument(}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00259}00259\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}-\/-\/no-\/recalc-\/timestamp"{}},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00260}00260\ \ \ \ \ \ \ \ \ dest=\textcolor{stringliteral}{"{}recalc\_timestamp"{}},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00261}00261\ \ \ \ \ \ \ \ \ action=\textcolor{stringliteral}{"{}store\_false"{}},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00262}00262\ \ \ \ \ \ \ \ \ help=\textcolor{stringliteral}{"{}Don't\ set\ the\ output\ font's\ timestamp\ to\ the\ current\ time."{}},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00263}00263\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00264}00264\ \ \ \ \ loggingGroup\ =\ parser.add\_mutually\_exclusive\_group(required=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00265}00265\ \ \ \ \ loggingGroup.add\_argument(}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00266}00266\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}-\/v"{}},\ \textcolor{stringliteral}{"{}-\/-\/verbose"{}},\ action=\textcolor{stringliteral}{"{}store\_true"{}},\ help=\textcolor{stringliteral}{"{}Run\ more\ verbosely."{}}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00267}00267\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00268}00268\ \ \ \ \ loggingGroup.add\_argument(}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00269}00269\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}-\/q"{}},\ \textcolor{stringliteral}{"{}-\/-\/quiet"{}},\ action=\textcolor{stringliteral}{"{}store\_true"{}},\ help=\textcolor{stringliteral}{"{}Turn\ verbosity\ off."{}}}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00270}00270\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00271}00271\ \ \ \ \ options\ =\ parser.parse\_args(args)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00272}00272\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00273}00273\ \ \ \ \ \textcolor{keyword}{from}\ fontTools\ \textcolor{keyword}{import}\ configLogger}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00274}00274\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00275}00275\ \ \ \ \ configLogger(}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00276}00276\ \ \ \ \ \ \ \ \ level=(\textcolor{stringliteral}{"{}DEBUG"{}}\ \textcolor{keywordflow}{if}\ options.verbose\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}ERROR"{}}\ \textcolor{keywordflow}{if}\ options.quiet\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}INFO"{}})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00277}00277\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00278}00278\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00279}00279\ \ \ \ \ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00280}00280\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00281}00281\ \ \ \ \ infile\ =\ options.input}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00282}00282\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ os.path.isfile(infile):}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00283}00283\ \ \ \ \ \ \ \ \ parser.error(\textcolor{stringliteral}{"{}No\ such\ file\ '\{\}'"{}}.format(infile))}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00284}00284\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00285}00285\ \ \ \ \ outfile\ =\ (}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00286}00286\ \ \ \ \ \ \ \ \ makeOutputFileName(infile,\ overWrite=\textcolor{keyword}{True},\ suffix=\textcolor{stringliteral}{"{}-\/CFF2"{}})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00287}00287\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ options.output}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00288}00288\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ options.output}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00289}00289\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00290}00290\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00291}00291\ \ \ \ \ font\ =\ \mbox{\hyperlink{classfontTools_1_1ttLib_1_1ttFont_1_1TTFont}{TTFont}}(infile,\ recalcTimestamp=options.recalc\_timestamp,\ recalcBBoxes=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00292}00292\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00293}00293\ \ \ \ \ convertCFFToCFF2(font)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00294}00294\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00295}00295\ \ \ \ \ log.info(}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00296}00296\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Saving\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00297}00297\ \ \ \ \ \ \ \ \ outfile,}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00298}00298\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00299}00299\ \ \ \ \ font.save(outfile)}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00300}00300\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00301}00301\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00302}00302\ \textcolor{keywordflow}{if}\ \_\_name\_\_\ ==\ \textcolor{stringliteral}{"{}\_\_main\_\_"{}}:}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00303}00303\ \ \ \ \ \textcolor{keyword}{import}\ sys}
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00304}00304\ }
\DoxyCodeLine{\Hypertarget{CFFToCFF2_8py_source_l00305}00305\ \ \ \ \ sys.exit(\mbox{\hyperlink{namespacemain}{main}}(sys.argv[1:]))}

\end{DoxyCode}
