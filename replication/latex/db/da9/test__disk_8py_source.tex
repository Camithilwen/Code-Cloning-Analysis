\doxysection{test\+\_\+disk.\+py}
\hypertarget{test__disk_8py_source}{}\label{test__disk_8py_source}\index{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/joblib/test/test\_disk.py@{/home/jam/Research/IRES-\/2025/dev/src/llm-\/scripts/testing/hypothesis-\/testing/hyp-\/env/lib/python3.12/site-\/packages/joblib/test/test\_disk.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00001}\mbox{\hyperlink{namespacejoblib_1_1test_1_1test__disk}{00001}}\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00002}00002\ \textcolor{stringliteral}{Unit\ tests\ for\ the\ disk\ utilities.}}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00003}00003\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00005}00005\ \textcolor{comment}{\#\ Authors:\ Gael\ Varoquaux\ <gael\ dot\ varoquaux\ at\ normalesup\ dot\ org>}}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00006}00006\ \textcolor{comment}{\#\ \ \ \ \ \ \ \ \ \ Lars\ Buitinck}}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00007}00007\ \textcolor{comment}{\#\ Copyright\ (c)\ 2010\ Gael\ Varoquaux}}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00008}00008\ \textcolor{comment}{\#\ License:\ BSD\ Style,\ 3\ clauses.}}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00010}00010\ \textcolor{keyword}{from}\ \_\_future\_\_\ \textcolor{keyword}{import}\ with\_statement}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00012}00012\ \textcolor{keyword}{import}\ array}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00013}00013\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00015}00015\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacejoblib_1_1disk}{joblib.disk}}\ \textcolor{keyword}{import}\ disk\_used,\ memstr\_to\_bytes,\ mkdirp,\ rm\_subdirs}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00016}00016\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacejoblib_1_1testing}{joblib.testing}}\ \textcolor{keyword}{import}\ parametrize,\ raises}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00020}00020\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00021}00021\ \textcolor{keyword}{def\ }test\_disk\_used(tmpdir):}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00022}00022\ \ \ \ \ cachedir\ =\ tmpdir.strpath}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00023}00023\ \ \ \ \ \textcolor{comment}{\#\ Not\ write\ a\ file\ that\ is\ 1M\ big\ in\ this\ directory,\ and\ check\ the}}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00024}00024\ \ \ \ \ \textcolor{comment}{\#\ size.\ The\ reason\ we\ use\ such\ a\ big\ file\ is\ that\ it\ makes\ us\ robust}}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00025}00025\ \ \ \ \ \textcolor{comment}{\#\ to\ errors\ due\ to\ block\ allocation.}}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00026}00026\ \ \ \ \ a\ =\ array.array(\textcolor{stringliteral}{"{}i"{}})}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00027}00027\ \ \ \ \ sizeof\_i\ =\ a.itemsize}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00028}00028\ \ \ \ \ target\_size\ =\ 1024}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00029}00029\ \ \ \ \ n\ =\ int(target\_size\ *\ 1024\ /\ sizeof\_i)}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00030}00030\ \ \ \ \ a\ =\ array.array(\textcolor{stringliteral}{"{}i"{}},\ n\ *\ (1,))}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00031}00031\ \ \ \ \ \textcolor{keyword}{with}\ open(os.path.join(cachedir,\ \textcolor{stringliteral}{"{}test"{}}),\ \textcolor{stringliteral}{"{}wb"{}})\ \textcolor{keyword}{as}\ output:}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00032}00032\ \ \ \ \ \ \ \ \ a.tofile(output)}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00033}00033\ \ \ \ \ \textcolor{keyword}{assert}\ disk\_used(cachedir)\ >=\ target\_size}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00034}00034\ \ \ \ \ \textcolor{keyword}{assert}\ disk\_used(cachedir)\ <\ target\_size\ +\ 12}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00037}00037\ \textcolor{preprocessor}{@parametrize}(}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00038}00038\ \ \ \ \ \textcolor{stringliteral}{"{}text,value"{}},}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00039}00039\ \ \ \ \ [}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00040}00040\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}80G"{}},\ 80\ *\ 1024**3),}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00041}00041\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}1.4M"{}},\ int(1.4\ *\ 1024**2)),}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00042}00042\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}120M"{}},\ 120\ *\ 1024**2),}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00043}00043\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}53K"{}},\ 53\ *\ 1024),}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00044}00044\ \ \ \ \ ],}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00045}00045\ )}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00046}00046\ \textcolor{keyword}{def\ }test\_memstr\_to\_bytes(text,\ value):}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00047}00047\ \ \ \ \ \textcolor{keyword}{assert}\ memstr\_to\_bytes(text)\ ==\ value}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00048}00048\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00050}00050\ \textcolor{preprocessor}{@parametrize}(}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00051}00051\ \ \ \ \ \textcolor{stringliteral}{"{}text,exception,regex"{}},}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00052}00052\ \ \ \ \ [}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00053}00053\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}fooG"{}},\ ValueError,\ \textcolor{stringliteral}{r"{}Invalid\ literal\ for\ size.*fooG.*"{}}),}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00054}00054\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}1.4N"{}},\ ValueError,\ \textcolor{stringliteral}{r"{}Invalid\ literal\ for\ size.*1.4N.*"{}}),}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00055}00055\ \ \ \ \ ],}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00056}00056\ )}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00057}00057\ \textcolor{keyword}{def\ }test\_memstr\_to\_bytes\_exception(text,\ exception,\ regex):}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00058}00058\ \ \ \ \ \textcolor{keyword}{with}\ raises(exception)\ \textcolor{keyword}{as}\ excinfo:}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00059}00059\ \ \ \ \ \ \ \ \ memstr\_to\_bytes(text)}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00060}00060\ \ \ \ \ \textcolor{keyword}{assert}\ excinfo.match(regex)}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00061}00061\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00063}00063\ \textcolor{keyword}{def\ }test\_mkdirp(tmpdir):}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00064}00064\ \ \ \ \ mkdirp(os.path.join(tmpdir.strpath,\ \textcolor{stringliteral}{"{}ham"{}}))}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00065}00065\ \ \ \ \ mkdirp(os.path.join(tmpdir.strpath,\ \textcolor{stringliteral}{"{}ham"{}}))}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00066}00066\ \ \ \ \ mkdirp(os.path.join(tmpdir.strpath,\ \textcolor{stringliteral}{"{}spam"{}},\ \textcolor{stringliteral}{"{}spam"{}}))}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00067}00067\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00068}00068\ \ \ \ \ \textcolor{comment}{\#\ Not\ all\ OSErrors\ are\ ignored}}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00069}00069\ \ \ \ \ \textcolor{keyword}{with}\ raises(OSError):}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ mkdirp(\textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00071}00071\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00073}00073\ \textcolor{keyword}{def\ }test\_rm\_subdirs(tmpdir):}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00074}00074\ \ \ \ \ sub\_path\ =\ os.path.join(tmpdir.strpath,\ \textcolor{stringliteral}{"{}subdir\_one"{}},\ \textcolor{stringliteral}{"{}subdir\_two"{}})}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00075}00075\ \ \ \ \ full\_path\ =\ os.path.join(sub\_path,\ \textcolor{stringliteral}{"{}subdir\_three"{}})}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00076}00076\ \ \ \ \ mkdirp(os.path.join(full\_path))}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00077}00077\ }
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00078}00078\ \ \ \ \ rm\_subdirs(sub\_path)}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00079}00079\ \ \ \ \ \textcolor{keyword}{assert}\ os.path.exists(sub\_path)}
\DoxyCodeLine{\Hypertarget{test__disk_8py_source_l00080}00080\ \ \ \ \ \textcolor{keyword}{assert}\ \textcolor{keywordflow}{not}\ os.path.exists(full\_path)}

\end{DoxyCode}
